<style>
  .main-header {
    background-color: #2c3e50; /* Темно-серый/синий фон, как на скриншоте */
    color: #ffffff;
    padding: 8px 15px;
    display: flex;
    align-items: center;
    border-bottom: 2px solid #34495e; /* Чуть более темная граница снизу */
  }
  .main-header .logo-container {
    margin-right: 20px;
  }
  .main-header .logo-container img {
    height: 38px; /* Размер логотипа */
    width: 38px;
    display: block; /* Убирает лишний отступ под картинкой */
    border-radius: 3px; /* Небольшое скругление краев, как у поля поиска */
  }
  .main-header .search-bar {
    flex-grow: 0; /* Не растягивать поле поиска сильно */
    margin-right: 25px;
    display: flex; /* Для позиционирования иконки внутри */
    align-items: center;
  }
  .main-header .search-bar input[type="search"] {
    padding: 8px 12px 8px 35px; /* Отступ слева для иконки */
    border-radius: 4px;
    border: 1px solid #cccccc;    /* Светло-серая граница */
    background-color: #ffffff; /* Белый фон */
    color: #333333;           /* Темный цвет текста */
    min-width: 220px; /* Минимальная ширина поля поиска */
    font-size: 0.9rem;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23555555' class='bi bi-search' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: 10px center; /* Позиционирование иконки */
  }
  .main-header .search-bar input[type="search"]::placeholder {
    color: #777777; /* Средне-серый цвет для плейсхолдера */
  }
  .main-header nav {
    display: flex;
    align-items: center;
    flex: 1; /* Занимает оставшееся пространство */
  }
  .main-header nav a {
    color: #ecf0f1; /* Светлый цвет текста для ссылок */
    text-decoration: none;
    margin-left: 12px;
    padding: 8px 12px;
    font-size: 0.95rem;
    border-radius: 4px;
    transition: background-color 0.2s ease;
    line-height: 1; /* Добавляем для центрирования текста посередине */
  }
  .main-header nav a:hover,
  .main-header nav a.active { /* Стиль для активной кнопки */
    background-color: #3498db; /* Синий фон при наведении/активности */
    color: #ffffff;
  }
  /* Убираем стандартные стили списка, если nav обернут в ul/li */
  .main-header nav ul {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    align-items: center; /* Выравниваем все элементы по центру */
  }
  .main-header nav li {
    margin: 0;
  }
  .modal {
    display: none;
    position: fixed;
    z-index: 1050;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.6);
  }
  .modal-content {
    background-color: #fefefe;
    margin: 10% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
    max-width: 800px;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    max-height: 80vh;
  }
  .modal-header {
    padding: 10px 15px;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
  }
  .modal-body {
      padding: 15px;
      overflow-y: auto;
  }
  .modal-footer {
    padding: 15px;
    border-top: 1px solid #dee2e6;
    text-align: right;
  }

  .close-btn {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
  }
  .close-btn:hover,
  .close-btn:focus {
    color: black;
    text-decoration: none;
  }
  .table {
      width: 100%;
      border-collapse: collapse;
  }
  .table th, .table td {
      border: 1px solid #dee2e6;
      padding: 8px;
      text-align: left;
  }
  .table th {
      background-color: #f2f2f2;
  }
  .btn {
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
  }
  .btn-primary {
      background-color: #007bff;
      color: white;
  }
  .btn-sm {
      padding: 5px 10px;
      font-size: 0.875em;
  }
  .form-group {
      margin-bottom: 1rem;
  }
  .form-group label {
      display: block;
      margin-bottom: .5rem;
  }
  .form-group input[type="text"], .form-group textarea {
      width: 100%;
      padding: .375rem .75rem;
      border: 1px solid #ced4da;
      border-radius: .25rem;
      box-sizing: border-box;
  }
</style>

<header class="main-header">
  <div class="logo-container">
    <a href="/admin/dashboard"> <!-- Логотип тоже может быть ссылкой на дашборд -->
      <img src="/tmpl_static/img/IMG_0486.jpg" alt="Логотип">
    </a>
  </div>
  <div class="search-bar">
    <input type="search" placeholder="Поиск...">
  </div>
  <nav>
    <ul style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
      <div style="display: flex; align-items: center;">
        <li><a href="/admin/dashboard">Монитор</a></li>
        <li><a href="/admin/enterprises">Компании</a></li>
        <li><a href="#" id="openSipModalBtn">SIP</a></li>
        <li><a href="#" id="openMobileModalBtn">Mobile</a></li>
        <li><a href="#" id="openServiceModalBtn">Service</a></li>
      </div>
      <div style="display: flex; align-items: center;">
        <li><span id="total-reboots" style="color: darkorange; font-weight: bold; margin-left: 12px; padding: 8px 12px; border-radius: 4px; font-size: 0.95rem; vertical-align: middle; display: inline-block;">R: 0</span></li>
      </div>
    </ul>
  </nav>
</header> 

<!-- Модальное окно для Mobile операторов -->
<div id="mobileOperatorsModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeMobileModalBtn">&times;</span>
        <h2>Мобильные операторы</h2>
        <div class="modal-body">
            <table id="mobile-operators-table" class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Имя</th>
                        <th>Шаблон</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody id="mobile-operators-list">
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <button id="addMobileOperatorBtn" class="btn btn-primary">Добавить оператора</button>
        </div>
    </div>
</div>

<!-- Модальное окно для формы добавления/редактирования Mobile оператора -->
<div id="mobileOperatorFormModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeMobileFormModalBtn">&times;</span>
        <h2 id="mobile-form-title">Добавить мобильного оператора</h2>
        <form id="mobile-operator-form">
            <input type="hidden" id="mobile-operator-id">
            <div class="form-group">
                <label for="mobile-operator-name">Имя:</label>
                <input type="text" id="mobile-operator-name" required>
            </div>
            <div class="form-group">
                <label for="mobile-operator-shablon">Шаблон:</label>
                <input type="text" id="mobile-operator-shablon">
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Сохранить</button>
            </div>
        </form>
    </div>
</div>

<!-- Модальное окно для SIP операторов -->
<div id="sipOperatorsModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeSipModalBtn">&times;</span>
        <h2>SIP Операторы</h2>
        <div class="modal-body">
            <table id="sip-operators-table" class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Имя</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody id="sip-operators-list">
                </tbody>
            </table>
        </div>
        <div class="modal-footer">
            <button id="addSipOperatorBtn" class="btn btn-primary">Добавить оператора</button>
        </div>
    </div>
</div>

<!-- Модальное окно для формы добавления/редактирования SIP оператора -->
<div id="sipOperatorFormModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeSipFormModalBtn">&times;</span>
        <h2 id="sip-form-title">Добавить SIP оператора</h2>
        <form id="sip-operator-form">
            <input type="hidden" id="sip-operator-id">
            <div class="form-group">
                <label for="sip-operator-name">Имя:</label>
                <input type="text" id="sip-operator-name" required>
            </div>
            <div class="form-group">
                <label for="sip-operator-shablon">Шаблон:</label>
                <textarea id="sip-operator-shablon" rows="20"></textarea>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Сохранить</button>
            </div>
        </form>
    </div>
</div>

<!-- Модальное окно для Service -->
<div id="serviceModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" id="closeServiceModalBtn">&times;</span>
        <h2>🚧 Сервисы системы</h2>
        <div class="modal-body">
            <!-- Блок баланса WebSMS -->
            <div style="background: #fff; border: 1px solid #dee2e6; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                <h4 style="margin: 0 0 0.5rem 0; color: #495057; display: flex; align-items: center;">
                    <span style="margin-right: 0.5rem;">💰</span>
                    <span id="websmsBalanceTitle">Баланс WebSMS.by</span>
                </h4>
                <div id="websmsBalanceContent" style="font-size: 1.1rem;">
                    <span style="color: #6c757d;">🔄 Загрузка...</span>
                </div>
            </div>
            
            <!-- Таблица управления сервисами -->
            <div style="background: #fff; border: 1px solid #dee2e6; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                <h4 style="margin: 0 0 1rem 0; color: #495057; display: flex; align-items: center;">
                    <span style="margin-right: 0.5rem;">⚙️</span>
                    <span>Управление сервисами</span>
                    <button id="refreshServicesBtn" style="margin-left: auto; padding: 0.25rem 0.5rem; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">🔄 Обновить</button>
                </h4>
                <div id="servicesTableContainer">
                    <div style="text-align: center; padding: 2rem; color: #6c757d;">
                        🔄 Загрузка сервисов...
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- Логика для Mobile операторов ---
    const openMobileModalBtn = document.getElementById('openMobileModalBtn');
    if (openMobileModalBtn) {
        const mobileOperatorsModal = document.getElementById('mobileOperatorsModal');
        const closeMobileModalBtn = document.getElementById('closeMobileModalBtn');
        const mobileOperatorsList = document.getElementById('mobile-operators-list');
        const addMobileOperatorBtn = document.getElementById('addMobileOperatorBtn');
        const mobileOperatorFormModal = document.getElementById('mobileOperatorFormModal');
        const closeMobileFormModalBtn = document.getElementById('closeMobileFormModalBtn');
        const mobileOperatorForm = document.getElementById('mobile-operator-form');
        const mobileFormTitle = document.getElementById('mobile-form-title');
        const mobileOperatorId = document.getElementById('mobile-operator-id');
        const mobileOperatorName = document.getElementById('mobile-operator-name');
        const mobileOperatorShablon = document.getElementById('mobile-operator-shablon');

        function renderMobileOperators(operators) {
            mobileOperatorsList.innerHTML = '';
            operators.forEach(op => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${op.id}</td>
                    <td>${op.name}</td>
                    <td>${op.shablon || ''}</td>
                    <td>
                        <button class="btn btn-sm btn-edit-mobile" data-id="${op.id}" data-name="${op.name}" data-shablon="${op.shablon || ''}">✏️</button>
                        <button class="btn btn-sm btn-delete-mobile" data-id="${op.id}">🗑️</button>
                    </td>
                `;
                mobileOperatorsList.appendChild(tr);
            });
        }

        openMobileModalBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                const response = await fetch('/admin/mobile/operators');
                if (!response.ok) throw new Error('Network response was not ok');
                const operators = await response.json();
                renderMobileOperators(operators);
                mobileOperatorsModal.style.display = 'block';
            } catch (error) {
                console.error("Error loading mobile operators:", error);
                alert("Error loading mobile operators.");
            }
        });

        closeMobileModalBtn.addEventListener('click', () => mobileOperatorsModal.style.display = 'none');
        closeMobileFormModalBtn.addEventListener('click', () => mobileOperatorFormModal.style.display = 'none');
        
        addMobileOperatorBtn.addEventListener('click', () => {
            mobileOperatorForm.reset();
            mobileOperatorId.value = '';
            mobileFormTitle.textContent = 'Добавить мобильного оператора';
            mobileOperatorFormModal.style.display = 'block';
        });

        mobileOperatorsList.addEventListener('click', async (event) => {
            const target = event.target.closest('button');
            if (!target) return;

            if (target.classList.contains('btn-edit-mobile')) {
                mobileOperatorId.value = target.dataset.id;
                mobileOperatorName.value = target.dataset.name;
                mobileOperatorShablon.value = target.dataset.shablon;
                mobileFormTitle.textContent = 'Редактировать мобильного оператора';
                mobileOperatorFormModal.style.display = 'block';
            }

            if (target.classList.contains('btn-delete-mobile')) {
                const id = target.dataset.id;
                if (confirm('Вы уверены?')) {
                    try {
                        const response = await fetch(`/admin/mobile/operators/${id}`, { method: 'DELETE' });
                        if (!response.ok) throw new Error('Failed to delete');
                        const operatorsResponse = await fetch('/admin/mobile/operators');
                        const operators = await operatorsResponse.json();
                        renderMobileOperators(operators);
                    } catch (error) {
                        alert("Failed to delete operator.");
                    }
                }
            }
        });

        mobileOperatorForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const id = mobileOperatorId.value;
            const name = mobileOperatorName.value;
            const shablon = mobileOperatorShablon.value;
            const url = id ? `/admin/mobile/operators/${id}` : '/admin/mobile/operators';
            const method = id ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, shablon })
                });
                if (!response.ok) {
                     const errorData = await response.json();
                     throw new Error(errorData.detail || 'Failed to save');
                }
                mobileOperatorFormModal.style.display = 'none';
                const operatorsResponse = await fetch('/admin/mobile/operators');
                const operators = await operatorsResponse.json();
                renderMobileOperators(operators);
            } catch (error) {
                alert(`Could not save operator: ${error.message}`);
            }
        });
    }

    // --- Логика для SIP операторов ---
    const openSipModalBtn = document.getElementById('openSipModalBtn');
    if (openSipModalBtn) {
        const sipOperatorsModal = document.getElementById('sipOperatorsModal');
        const closeSipModalBtn = document.getElementById('closeSipModalBtn');
        const sipOperatorsList = document.getElementById('sip-operators-list');
        const addSipOperatorBtn = document.getElementById('addSipOperatorBtn');
        const sipOperatorFormModal = document.getElementById('sipOperatorFormModal');
        const closeSipFormModalBtn = document.getElementById('closeSipFormModalBtn');
        const sipOperatorForm = document.getElementById('sip-operator-form');
        const sipFormTitle = document.getElementById('sip-form-title');
        const sipOperatorId = document.getElementById('sip-operator-id');
        const sipOperatorName = document.getElementById('sip-operator-name');
        const sipOperatorShablon = document.getElementById('sip-operator-shablon');

        function renderSipOperators(operators) {
            sipOperatorsList.innerHTML = '';
            operators.forEach(op => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${op.id}</td>
                    <td>${op.name}</td>
                    <td>
                        <button class="btn btn-sm btn-edit-sip" data-id="${op.id}" data-name="${op.name}" data-shablon="${op.shablon || ''}">✏️</button>
                        <button class="btn btn-sm btn-delete-sip" data-id="${op.id}">🗑️</button>
                    </td>
                `;
                sipOperatorsList.appendChild(tr);
            });
        }

        openSipModalBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            try {
                const response = await fetch('/admin/sip/operators');
                if (!response.ok) throw new Error('Network response was not ok');
                const operators = await response.json();
                renderSipOperators(operators);
                sipOperatorsModal.style.display = 'block';
            } catch (error) {
                console.error("Error loading SIP operators:", error);
                alert("Error loading SIP operators.");
            }
        });

        closeSipModalBtn.addEventListener('click', () => sipOperatorsModal.style.display = 'none');
        closeSipFormModalBtn.addEventListener('click', () => sipOperatorFormModal.style.display = 'none');
        
        addSipOperatorBtn.addEventListener('click', () => {
            sipOperatorForm.reset();
            sipOperatorId.value = '';
            sipFormTitle.textContent = 'Добавить SIP оператора';
            sipOperatorFormModal.style.display = 'block';
        });

        sipOperatorsList.addEventListener('click', async (event) => {
            const target = event.target.closest('button');
            if (!target) return;

            if (target.classList.contains('btn-edit-sip')) {
                sipOperatorId.value = target.dataset.id;
                sipOperatorName.value = target.dataset.name;
                sipOperatorShablon.value = target.dataset.shablon;
                sipFormTitle.textContent = 'Редактировать SIP оператора';
                sipOperatorFormModal.style.display = 'block';
            }

            if (target.classList.contains('btn-delete-sip')) {
                const id = target.dataset.id;
                if (confirm('Вы уверены?')) {
                    try {
                        const response = await fetch(`/admin/sip/operators/${id}`, { method: 'DELETE' });
                        if (!response.ok) throw new Error('Failed to delete');
                        const operatorsResponse = await fetch('/admin/sip/operators');
                        const operators = await operatorsResponse.json();
                        renderSipOperators(operators);
                    } catch (error) {
                        alert("Failed to delete operator.");
                    }
                }
            }
        });

        sipOperatorForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const id = sipOperatorId.value;
            const name = sipOperatorName.value;
            const shablon = sipOperatorShablon.value;
            const url = id ? `/admin/sip/operators/${id}` : '/admin/sip/operators';
            const method = id ? 'PUT' : 'POST';

            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, shablon })
                });
                if (!response.ok) {
                     const errorData = await response.json();
                     throw new Error(errorData.detail || 'Failed to save');
                }
                sipOperatorFormModal.style.display = 'none';
                const operatorsResponse = await fetch('/admin/sip/operators');
                const operators = await operatorsResponse.json();
                renderSipOperators(operators);
            } catch (error) {
                alert(`Could not save operator: ${error.message}`);
            }
        });
    }

    // --- Логика для Service модалки ---
    const openServiceModalBtn = document.getElementById('openServiceModalBtn');
    if (openServiceModalBtn) {
        const serviceModal = document.getElementById('serviceModal');
        const closeServiceModalBtn = document.getElementById('closeServiceModalBtn');

        // Функция загрузки баланса WebSMS
        async function loadWebSMSBalance() {
            const balanceContent = document.getElementById('websmsBalanceContent');
            
            try {
                // Показываем индикатор загрузки
                balanceContent.innerHTML = '<span style="color: #6c757d;">🔄 Загрузка...</span>';
                
                // Запрос к SMS сервису на порту 8013
                const response = await fetch('/admin/proxy-balance', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.balance && typeof data.balance.sms === 'number') {
                    const smsBalance = data.balance.sms.toFixed(2);
                    balanceContent.innerHTML = `
                        <span style="color: #28a745; font-weight: 600; font-size: 1.2rem;">${smsBalance} BYN</span>
                        <span style="color: #6c757d; margin-left: 0.5rem; font-size: 0.9rem;">(SMS)</span>
                    `;
                } else {
                    throw new Error('Неверный формат ответа');
                }
                
            } catch (error) {
                console.error('Ошибка загрузки баланса WebSMS:', error);
                balanceContent.innerHTML = `
                    <span style="color: #dc3545;">❌ Недоступно</span>
                    <span style="color: #6c757d; margin-left: 0.5rem; font-size: 0.9rem;">(сервис недоступен)</span>
                `;
            }
        }

        // Функция загрузки списка сервисов
        async function loadServicesList() {
            const container = document.getElementById('servicesTableContainer');
            
            try {
                // Показываем индикатор загрузки
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #6c757d;">🔄 Загрузка сервисов...</div>';
                
                // Запрос к эндпоинту сервисов
                const response = await fetch('/admin/services', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.services) {
                    container.innerHTML = renderServicesTable(data.services);
                    attachServiceButtons();
                } else {
                    throw new Error('Неверный формат ответа');
                }
                
            } catch (error) {
                console.error('Ошибка загрузки сервисов:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: #dc3545;">
                        ❌ Ошибка загрузки сервисов<br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        // Функция рендеринга таблицы сервисов
        function renderServicesTable(services) {
            let tableHTML = `
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                        <thead>
                            <tr style="background: #f8f9fa;">
                                <th style="padding: 0.75rem; border: 1px solid #dee2e6; text-align: left;">Сервис</th>
                                <th style="padding: 0.75rem; border: 1px solid #dee2e6; text-align: left;">Скрипт</th>
                                <th style="padding: 0.75rem; border: 1px solid #dee2e6; text-align: center;">Порт</th>
                                <th style="padding: 0.75rem; border: 1px solid #dee2e6; text-align: center;">Статус</th>
                                <th style="padding: 0.75rem; border: 1px solid #dee2e6; text-align: center;">Действия</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            services.forEach(service => {
                const statusIcon = getStatusIcon(service.status);
                const statusColor = getStatusColor(service.status);
                const portDisplay = service.port ? service.port : '-';
                
                tableHTML += `
                    <tr>
                        <td style="padding: 0.75rem; border: 1px solid #dee2e6;">
                            <strong>${service.name}</strong><br>
                            <small style="color: #6c757d;">${service.app}</small>
                        </td>
                        <td style="padding: 0.75rem; border: 1px solid #dee2e6; font-family: monospace;">
                            ${service.script}
                        </td>
                        <td style="padding: 0.75rem; border: 1px solid #dee2e6; text-align: center; font-family: monospace;">
                            ${portDisplay}
                        </td>
                        <td style="padding: 0.75rem; border: 1px solid #dee2e6; text-align: center;">
                            <span style="color: ${statusColor};">${statusIcon}</span>
                        </td>
                        <td style="padding: 0.75rem; border: 1px solid #dee2e6; text-align: center;">
                            ${renderActionButtons(service)}
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            return tableHTML;
        }

        // Функция получения иконки статуса
        function getStatusIcon(status) {
            switch (status) {
                case 'running': return '✅';
                case 'stopped': return '❌';
                case 'error': return '⚠️';
                default: return '❓';
            }
        }

        // Функция получения цвета статуса
        function getStatusColor(status) {
            switch (status) {
                case 'running': return '#28a745';
                case 'stopped': return '#dc3545';
                case 'error': return '#ffc107';
                default: return '#6c757d';
            }
        }

        // Функция рендеринга кнопок действий
        function renderActionButtons(service) {
            // Все сервисы теперь имеют кнопки управления
            return `
                <button 
                    class="service-btn stop-btn" 
                    data-service="${service.name}" 
                    data-action="stop"
                    style="padding: 0.25rem 0.5rem; margin: 0.1rem; background: #dc3545; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 0.75rem;">
                    ⏹ Stop
                </button>
                <button 
                    class="service-btn restart-btn" 
                    data-service="${service.name}" 
                    data-action="restart"
                    style="padding: 0.25rem 0.5rem; margin: 0.1rem; background: #28a745; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 0.75rem;">
                    🔄 Restart
                </button>
            `;
        }

        // Функция прикрепления обработчиков событий к кнопкам
        function attachServiceButtons() {
            const serviceButtons = document.querySelectorAll('.service-btn');
            
            serviceButtons.forEach(button => {
                button.addEventListener('click', async (e) => {
                    const serviceName = e.target.dataset.service;
                    const action = e.target.dataset.action;
                    
                    await controlService(serviceName, action, e.target);
                });
            });
        }

        // Функция управления сервисом
        async function controlService(serviceName, action, buttonElement) {
            try {
                // Просто выполняем команду
                const response = await fetch(`/admin/services/${serviceName}/action`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ action: action })
                });
                
                const data = await response.json();
                
                // Всегда обновляем таблицу после выполнения
                setTimeout(() => {
                    loadServicesList();
                }, 1000);
                
            } catch (error) {
                console.error('Ошибка управления сервисом:', error);
                
                // Обновляем таблицу даже при ошибке
                setTimeout(() => {
                    loadServicesList();
                }, 1000);
            }
        }

        openServiceModalBtn.addEventListener('click', (e) => {
            e.preventDefault();
            serviceModal.style.display = 'block';
            // Загружаем баланс и список сервисов при открытии модалки
            loadWebSMSBalance();
            loadServicesList();
        });

        closeServiceModalBtn.addEventListener('click', () => {
            serviceModal.style.display = 'none';
        });

        // Обработчик кнопки обновления сервисов
        const refreshServicesBtn = document.getElementById('refreshServicesBtn');
        if (refreshServicesBtn) {
            refreshServicesBtn.addEventListener('click', () => {
                loadServicesList();
            });
        }
    }

    window.addEventListener('click', (event) => {
        const mobileOperatorsModal = document.getElementById('mobileOperatorsModal');
        const mobileOperatorFormModal = document.getElementById('mobileOperatorFormModal');
        const sipOperatorsModal = document.getElementById('sipOperatorsModal');
        const sipOperatorFormModal = document.getElementById('sipOperatorFormModal');
        const serviceModal = document.getElementById('serviceModal');
        if (event.target == mobileOperatorsModal) mobileOperatorsModal.style.display = 'none';
        if (event.target == mobileOperatorFormModal) mobileOperatorFormModal.style.display = 'none';
        if (event.target == sipOperatorsModal) sipOperatorsModal.style.display = 'none';
        if (event.target == sipOperatorFormModal) sipOperatorFormModal.style.display = 'none';
        if (event.target == serviceModal) serviceModal.style.display = 'none';
    });
});
</script> 