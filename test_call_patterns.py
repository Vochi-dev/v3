#!/usr/bin/env python3
"""
ะัััััะน ัะตัั ะฒัะตั ะฟะฐััะตัะฝะพะฒ ะทะฒะพะฝะบะพะฒ ะดะปั Telegram ะฑะพัะฐ 0367
"""

import asyncio
import time
from telegram import Bot

def format_phone_display(phone: str) -> str:
    """ะคะพัะผะฐัะธััะตั ะฝะพะผะตั ัะตะปะตัะพะฝะฐ ะดะปั ะพัะพะฑัะฐะถะตะฝะธั ะฟะพ ะผะตะถะดัะฝะฐัะพะดะฝะพะผั ััะฐะฝะดะฐััั"""
    if not phone:
        return "ะะตะธะทะฒะตััะฝัะน"
    
    # ะฃะดะฐะปัะตะผ ะฒัะต ะฝะต-ัะธััะพะฒัะต ัะธะผะฒะพะปั
    digits = ''.join(filter(str.isdigit, phone))
    
    if len(digits) == 12 and digits.startswith('375'):
        # ะะตะปะพััััะบะธะน ะฝะพะผะตั: +375 (29) 123-45-67
        return f"+375 ({digits[3:5]}) {digits[5:8]}-{digits[8:10]}-{digits[10:12]}"
    elif len(digits) == 11 and digits.startswith('7'):
        # ะะพััะธะนัะบะธะน ะฝะพะผะตั: +7 (999) 123-45-67
        return f"+7 ({digits[1:4]}) {digits[4:7]}-{digits[7:9]}-{digits[9:11]}"
    else:
        return phone

# ะะพะฝัะธะณััะฐัะธั ะดะปั ะฟัะตะดะฟัะธััะธั 0367  
BOT_TOKEN = "7280164925:AAHPPXH4Muq07RFMI_J5DyUhZXEo73l7LWI"
CHAT_ID = 374573193  # ะัะฐะฒะธะปัะฝัะน enterprise_chat_id ะธะท ะะ

async def test_call_pattern(bot: Bot, call_type: str, messages: list, delay: float = 2.0):
    """ะขะตััะธััะตั ัะฒะพะปััะธั ะพะดะฝะพะณะพ ัะพะพะฑัะตะฝะธั ัะตัะตะท ะฝะตัะบะพะปัะบะพ ััะฐะฟะพะฒ"""
    call_id = f"test_{call_type}_{int(time.time())}"
    
    try:
        print(f"\n๐ฑ ะขะตััะธััะตะผ {call_type}...")
        
        # ะัะฟัะฐะฒะปัะตะผ ะฟะตัะฒะพะต ัะพะพะฑัะตะฝะธะต
        message = await bot.send_message(
            chat_id=CHAT_ID,
            text=f"๐งช ะขะะกะข {call_type} - ะญะขะะ 1\n\n{messages[0]}",
            parse_mode="HTML"
        )
        message_id = message.message_id
        print(f"   โ ะญัะฐะฟ 1 ะพัะฟัะฐะฒะปะตะฝ (Message ID: {message_id})")
        
        # ะะตะดะฐะบัะธััะตะผ ัะพะพะฑัะตะฝะธะต ัะตัะตะท ะบะฐะถะดัะต delay ัะตะบัะฝะด
        for i, msg in enumerate(messages[1:], 2):
            await asyncio.sleep(delay)
            
            await bot.edit_message_text(
                chat_id=CHAT_ID,
                message_id=message_id,
                text=f"๐งช ะขะะกะข {call_type} - ะญะขะะ {i}\n\n{msg}",
                parse_mode="HTML"
            )
            print(f"   โ๏ธ ะญัะฐะฟ {i} ะพััะตะดะฐะบัะธัะพะฒะฐะฝ")
        
        print(f"   ๐ฏ ะขะตัั {call_type} ะทะฐะฒะตััะตะฝ! ะคะธะฝะฐะปัะฝัะน Message ID: {message_id}")
        return True
        
    except Exception as e:
        print(f"   โ ะัะธะฑะบะฐ ะฒ ัะตััะต {call_type}: {e}")
        return False

async def run_all_tests():
    """ะะฐะฟััะบะฐะตั ะฒัะต ัะตััั ะฟะพ ะพัะตัะตะดะธ"""
    bot = Bot(token=BOT_TOKEN)
    
    # ะัะฟัะฐะฒะปัะตะผ ะทะฐะณะพะปะพะฒะพะบ
    await bot.send_message(
        chat_id=CHAT_ID,
        text="๐ <b>ะะะงะะะ ะขะะกะขะะะะะะะะฏ ะะกะะฅ ะขะะะะ ะะะะะะะ</b>\n\nะะฐะถะดะพะต ัะพะพะฑัะตะฝะธะต ะฑัะดะตั ัะฒะพะปััะธะพะฝะธัะพะฒะฐัั ัะตัะตะท edit_message_text()",
        parse_mode="HTML"
    )
    
    tests = [
        ("1-1", [
            f"โ๏ธ152 โก๏ธ ๐ฐ{format_phone_display('375296123456')}\nะะธะฝะธั: ะะขะก-1",
            f"โ๏ธ152 ๐โก๏ธ ๐ฐ{format_phone_display('375296123456')}๐",
            f"โ ะฃัะฟะตัะฝัะน ะธััะพะดััะธะน ะทะฒะพะฝะพะบ\n๐ฐ{format_phone_display('375296123456')}\nโ๏ธ152\nโ ะะปะธัะตะปัะฝะพััั: 03:45\n๐ค ะะฒะฐะฝะพะฒ ะะตัั ะะตััะพะฒะธั\n๐ะะฐะฟะธัั ัะฐะทะณะพะฒะพัะฐ"
        ]),
        
        ("2-1", [
            f"๐ฐ{format_phone_display('375447034448')} โก๏ธ ะัะธะฒะตัััะฒะธะต\n๐กะะขะก ะะปะฐะฒะฝัะน ะพัะธั",
            f"๐ฐ{format_phone_display('375447034448')} โก๏ธ ะะพะฑ.150,151,152\n๐กะะขะก ะะปะฐะฒะฝัะน ะพัะธั\nะะฒะพะฝะธะป: 3 ัะฐะทะฐ, ะะพัะปะตะดะฝะธะน: 15.09.2025",
            f"โ๏ธะะฒะฐะฝะพะฒ ะ.ะ. ๐โก๏ธ ๐ฐ{format_phone_display('375447034448')}๐",
            f"โ ะฃัะฟะตัะฝัะน ะฒัะพะดััะธะน ะทะฒะพะฝะพะบ\n๐ฐ{format_phone_display('375447034448')}\nโ๏ธะะฒะฐะฝะพะฒ ะ.ะ.\n๐กะะขะก ะะปะฐะฒะฝัะน ะพัะธั\nโฐะะฐัะฐะปะพ ะทะฒะพะฝะบะฐ 14:25\nโ ะะปะธัะตะปัะฝะพััั: 03:45\n๐ค ะะตััะพะฒ ะกะตัะณะตะน ะะธะบะพะปะฐะตะฒะธั\n๐ะะฐะฟะธัั ัะฐะทะณะพะฒะพัะฐ"
        ]),
        
        ("2-18", [
            f"๐ฐ{format_phone_display('375447034448')} โก๏ธ ะัะธะฒะตัััะฒะธะต\n๐กะะขะก ะะปะฐะฒะฝัะน ะพัะธั",
            f"๐ฐ{format_phone_display('375447034448')} โก๏ธ ะะพะฑ.150,151,152\n๐กะะขะก ะะปะฐะฒะฝัะน ะพัะธั",
            f"โ๏ธะะฒะฐะฝะพะฒ ะ.ะ. ๐โก๏ธ ๐ฐ{format_phone_display('375447034448')}๐",
            f"โ๏ธะะตััะพะฒ ะ.ะ. ๐โก๏ธ ๐ฐ{format_phone_display('375447034448')}๐ (ะฟะตัะตะฒะตะดะตะฝ ะพั ะะฒะฐะฝะพะฒะฐ)",
            f"โ๏ธะกะธะดะพัะพะฒ ะก.ะก. ๐โก๏ธ ๐ฐ{format_phone_display('375447034448')}๐ (ะฟะตัะตะฒะตะดะตะฝ ะพั ะะตััะพะฒะฐ)",
            f"โ ะฃัะฟะตัะฝัะน ะฒัะพะดััะธะน ะทะฒะพะฝะพะบ\n๐ฐ{format_phone_display('375447034448')}\nโ๏ธะกะธะดะพัะพะฒ ะก.ะก. [3 ะฟะตัะตะฒะพะดะฐ: ะะฒะฐะฝะพะฒโะะตััะพะฒโะกะธะดะพัะพะฒ]\n๐กะะขะก ะะปะฐะฒะฝัะน ะพัะธั\nโฐะะฐัะฐะปะพ ะทะฒะพะฝะบะฐ 14:25\nโ ะะปะธัะตะปัะฝะพััั: 08:30\n๐ค ะัะทะฝะตัะพะฒ ะะปะตะบัะตะน ะะปะฐะดะธะผะธัะพะฒะธั\n๐ะะฐะฟะธัั ัะฐะทะณะพะฒะพัะฐ"
        ]),
        
        ("2-23", [
            f"๐ฐ{format_phone_display('375447034448')} โก๏ธ ะะพะฑ.150 [FollowMe]\n๐กะะขะก ะะปะฐะฒะฝัะน ะพัะธั",
            f"โ ะฃัะฟะตัะฝัะน ะฒัะพะดััะธะน ะทะฒะพะฝะพะบ [FollowMe]\n๐ฐ{format_phone_display('375447034448')}\n๐ะัะธะฝัั ะฝะฐ: ะผะพะฑะธะปัะฝัะน {format_phone_display('375296254070')}\n๐กะะขะก ะะปะฐะฒะฝัะน ะพัะธั\nโฐะะฐัะฐะปะพ ะทะฒะพะฝะบะฐ 14:25\nโ ะะปะธัะตะปัะฝะพััั: 04:15\n๐ะะฐะฟะธัั ัะฐะทะณะพะฒะพัะฐ"
        ]),
        
        ("3-1", [
            "โ๏ธ152 ๐โก๏ธ โ๏ธ185๐",
            "โ ะฃัะฟะตัะฝัะน ะฒะฝัััะตะฝะฝะธะน ะทะฒะพะฝะพะบ\nโ๏ธ152โก๏ธ\nโ๏ธ185\nโ ะะปะธัะตะปัะฝะพััั: 01:30"
        ]),
        
        ("1-9", [
            f"โ๏ธ151 โก๏ธ ๐ฐ{format_phone_display('375296254070')}\nะะธะฝะธั: ะะขะก-1 โ๏ธะะะะฏะขะ โ ัะตะทะตัะฒ ะะขะก-2",
            f"โ๏ธ151 ๐โก๏ธ ๐ฐ{format_phone_display('375296254070')}๐",
            f"โ ะฃัะฟะตัะฝัะน ะธััะพะดััะธะน ะทะฒะพะฝะพะบ\n๐ฐ{format_phone_display('375296254070')}\nโ๏ธ151\n๐ก ะะธะฝะธั: ะะขะก-2 [ัะตะทะตัะฒ]\nโ ะะปะธัะตะปัะฝะพััั: 03:20\n๐ค ะะตััะพะฒ ะะฝะดัะตะน ะกะตัะณะตะตะฒะธั\n๐ะะฐะฟะธัั ัะฐะทะณะพะฒะพัะฐ"
        ]),
        
        ("1-10", [
            f"โ๏ธ151 โก๏ธ ๐ฐ{format_phone_display('375296254070')}\nะะธะฝะธั: ะะขะก-1 โ๏ธะะะะฏะขะ",
            f"โ ะััะพะดััะธะน ะทะฒะพะฝะพะบ ะฝะต ัะดะฐะปัั\n๐ฐ{format_phone_display('375296254070')}\nโ๏ธ151\n๐ก ะะขะก-1 ะทะฐะฝััะฐ, ัะตะทะตัะฒ ะฝะตะดะพัััะฟะตะฝ\nโ ะะปะธัะตะปัะฝะพััั: 00:05"
        ]),
        
        ("1-11", [
            f"๐ซ ะะฐะฟัะฐะฒะปะตะฝะธะต ะทะฐะฟัะตัะตะฝะพ\n๐ฐ{format_phone_display('74957776644')}\nโ๏ธ151\nโ ะะฐะทัะตัะตะฝั ัะพะปัะบะพ ะทะฒะพะฝะบะธ ะฝะฐ +375\nโ ะะปะธัะตะปัะฝะพััั: 00:01"
        ])
    ]
    
    success_count = 0
    total_tests = len(tests)
    
    for call_type, messages in tests:
        success = await test_call_pattern(bot, call_type, messages, delay=2.5)
        if success:
            success_count += 1
        
        # ะะฐัะทะฐ ะผะตะถะดั ัะตััะฐะผะธ
        await asyncio.sleep(3)
    
    # ะัะฟัะฐะฒะปัะตะผ ะธัะพะณะธ
    await bot.send_message(
        chat_id=CHAT_ID,
        text=f"๐ <b>ะะขะะะ ะขะะกะขะะะะะะะะฏ</b>\n\nะฃัะฟะตัะฝะพ: {success_count}/{total_tests}\n\n{'โ ะัะต ัะตััั ะฟัะพะนะดะตะฝั!' if success_count == total_tests else 'โ๏ธ ะััั ะพัะธะฑะบะธ ะฒ ัะตััะฐั'}",
        parse_mode="HTML"
    )
    
    print(f"\n๐ ะะขะะะ: {success_count}/{total_tests} ัะตััะพะฒ ััะฟะตัะฝะพ")

if __name__ == "__main__":
    print("๐งช ะะฐะฟััะบ ัะตััะธัะพะฒะฐะฝะธั ะฒัะตั ะฟะฐััะตัะฝะพะฒ ะทะฒะพะฝะบะพะฒ...")
    asyncio.run(run_all_tests())
    print("๐ ะขะตััะธัะพะฒะฐะฝะธะต ะทะฐะฒะตััะตะฝะพ!")
