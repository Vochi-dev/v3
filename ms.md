# –ú–æ–π–°–∫–ª–∞–¥ (MySklad) Integration Service
## üì¶ –°–µ—Ä–≤–∏—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ú–æ–π–°–∫–ª–∞–¥

–°–µ—Ä–≤–∏—Å –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã —Ç–µ–ª–µ—Ñ–æ–Ω–∏–∏ —Å –ú–æ–π–°–∫–ª–∞–¥ (1C:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ).
–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∫–ª–∏–µ–Ω—Ç–æ–≤, –∑–∞–∫–∞–∑–æ–≤ –∏ –∑–≤–æ–Ω–∫–æ–≤ —á–µ—Ä–µ–∑ API v1.2.

### üìã –û–±–∑–æ—Ä

**–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞:** `ms.py` (MoySklad)  
**–ü–æ—Ä—Ç:** `8023`  
**–í–µ—Ä—Å–∏—è API:** Remap 1.2  
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API:** [https://dev.moysklad.ru/doc/api/remap/1.2/#mojsklad-json-api](https://dev.moysklad.ru/doc/api/remap/1.2/#mojsklad-json-api)

### üîß –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤** - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
- **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –∏–∑ –∑–≤–æ–Ω–∫–æ–≤
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–≤–æ–Ω–∫–æ–≤** - —Ñ–∏–∫—Å–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∏–µ–π** - —Å–≤—è–∑—å —Å Asterisk

### üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
./ms.sh start

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
./ms.sh status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
./ms.sh logs

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
./ms.sh restart
```

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

#### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **Login** - –ª–æ–≥–∏–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ú–æ–π–°–∫–ª–∞–¥
- **Password** - –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ú–æ–π–°–∫–ª–∞–¥
- **Base URL** - –±–∞–∑–æ–≤—ã–π URL API (–æ–±—ã—á–Ω–æ `https://api.moysklad.ru/api/remap/1.2`)

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–≤–æ–Ω–∫–∞—Ö** - –≤–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Ö–æ–¥—è—â–∏—Ö** - –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏—Å—Ö–æ–¥—è—â–∏—Ö** - –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
- **–ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–∏ –∑–≤–æ–Ω–∫–∞—Ö
- **–°—Ç–∞—Ç—É—Å –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤** - —Å—Ç–∞—Ç—É—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–∫–∞–∑–æ–≤** - –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

### üì° API Endpoints

#### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

```
GET  /ms/                    - –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω–∫–∏
GET  /ms-admin/config/{enterprise_number} - –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
PUT  /ms-admin/config/{enterprise_number} - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
POST /ms-admin/test/{enterprise_number}    - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
GET  /ms-admin/journal                    - –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

```
POST /ms/notify-incoming     - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—Ö–æ–¥—è—â–µ–º –∑–≤–æ–Ω–∫–µ
POST /ms/log-call           - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
POST /ms/customer-by-phone  - –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
POST /ms/responsible-extension - –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
```

### üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è
```json
{
  "enabled": true,
  "login": "user@example.com",
  "password": "password123",
  "api_url": "https://api.moysklad.ru/api/remap/1.2",
  "notifications": {
    "call_notify_mode": "during",
    "notify_incoming": true,
    "notify_outgoing": false
  },
  "incoming_call_actions": {
    "create_order": true,
    "order_status": "–ù–æ–≤—ã–π",
    "order_source": "–¢–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –∑–≤–æ–Ω–æ–∫"
  }
}
```

#### –î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
```json
{
  "id": "uuid-client-id",
  "name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
  "phone": "+375291234567",
  "email": "ivanov@example.com",
  "tags": ["VIP", "–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç"],
  "manager": {
    "id": "uuid-manager-id",
    "name": "–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á"
  }
}
```

### üîÑ –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

#### 1. –í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞ —á–µ—Ä–µ–∑ Asterisk
2. –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ú–æ–π–°–∫–ª–∞–¥ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
3. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–∞–π–¥–µ–Ω - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –§–ò–û –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
4. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω - –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ
5. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
6. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–º—É –º–µ–Ω–µ–¥–∂–µ—Ä—É

#### 2. –ò—Å—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –∑–≤–æ–Ω–∫–µ
2. –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ú–æ–π–°–∫–ª–∞–¥
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
4. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### üêõ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

#### –§–∞–π–ª—ã –ª–æ–≥–æ–≤
- `/root/asterisk-webhook/logs/ms.log` - –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ —Å–µ—Ä–≤–∏—Å–∞
- `/root/asterisk-webhook/logs/integration_cache.log` - –ª–æ–≥–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

#### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `INFO` - –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ
- `WARNING` - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- `ERROR` - –æ—à–∏–±–∫–∏
- `DEBUG` - –¥–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ

#### Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
–î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ: `http://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä:8023/ms/`

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ú–æ–π–°–∫–ª–∞–¥
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–≤–æ–Ω–∫–æ–≤
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
# –ß–µ—Ä–µ–∑ web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
curl http://localhost:8023/ms-admin/test/0367

# –ß–µ—Ä–µ–∑ API
curl -X POST http://localhost:8023/ms-admin/test/0367
```

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API –ú–æ–π–°–∫–ª–∞–¥
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤

#### –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π
–í—Å–µ —Å–æ–±—ã—Ç–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `integration_logs`:
```sql
SELECT * FROM integration_logs
WHERE integration_type = 'ms'
ORDER BY created_at DESC
LIMIT 50;
```

### üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

#### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
```
–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
```

**2. –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**
```
–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å api.moysklad.ru
```

**3. –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞**
```
–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ú–æ–π–°–∫–ª–∞–¥
```

#### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–∞
./ms.sh status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ—à–∏–±–æ–∫
./ms.sh logs | tail -20

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
curl -X POST http://localhost:8023/ms-admin/test/0367
```

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –í–µ—Ä—Å–∏–∏
- **v1.0** - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ú–æ–π–°–∫–ª–∞–¥
- **v1.1** - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–∞–∫–∞–∑–æ–≤
- **v1.2** - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- –ú–æ–π–°–∫–ª–∞–¥ API v1.2+
- Python 3.8+
- FastAPI
- PostgreSQL

---

## üèóÔ∏è TO-DO: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –ú–æ–π–°–∫–ª–∞–¥ Phone API

### **üìã –ê–ù–ê–õ–ò–ó –¢–†–ï–ë–û–í–ê–ù–ò–ô:**

#### **1. –ü–æ–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ:**
- ‚úÖ **–ú–æ–π–°–∫–ª–∞–¥ Phone API URL** - `https://api.moysklad.ru/api/phone/1.0` (–º–æ–∂–Ω–æ –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å)
- ‚úÖ **–ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –æ—Ç –ú–æ–π–°–∫–ª–∞–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —é–Ω–∏—Ç–∞
- ‚úÖ **Webhook URL** - —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∫–æ–ø–∏–ø–∞—Å—Ç–∞ –≤ –ú–æ–π–°–∫–ª–∞–¥

#### **2. Webhook —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –ú–æ–π–°–∫–ª–∞–¥:**

**–ò—Å—Ö–æ–¥—è—â–∏–π (–¥–ª—è copy-paste –≤ –ú–æ–π–°–∫–ª–∞–¥):**
```
https://bot.vochi.by/ms/webhook/{enterprise_number}
```

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ (–¥–ª—è integration_cache):**
```
POST /internal/ms/call-event        - —Å–æ–±—ã—Ç–∏—è dial/hangup
POST /internal/ms/notify-incoming   - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
POST /internal/ms/log-call         - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤
```

### **üìù –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò:**

#### **–≠—Ç–∞–ø 1: –ê–¥–º–∏–Ω–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
- [ ] **ms-admin.html** - UI –∞–¥–º–∏–Ω–∫–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å RetailCRM/UON
- [ ] **–ü–æ–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
  - [ ] Phone API URL (–∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å `https://api.moysklad.ru/api/phone/1.0`)
  - [ ] –ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (input field)
  - [ ] –í–∫–ª—é—á–µ–Ω/–æ—Ç–∫–ª—é—á–µ–Ω (checkbox)
- [ ] **Webhook URL –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - `https://bot.vochi.by/ms/webhook/{enterprise_number}`
- [ ] **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Phone API

#### **–≠—Ç–∞–ø 2: Webhook —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**
- [ ] **POST /ms/webhook/{enterprise_number}** - –ø—Ä–∏–µ–º webhook –æ—Ç –ú–æ–π–°–∫–ª–∞–¥
- [ ] **POST /internal/ms/call-event** - –¥–ª—è integration_cache (dial/hangup)
- [ ] **POST /internal/ms/notify-incoming** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- [ ] **POST /internal/ms/log-call** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ú–æ–π–°–∫–ª–∞–¥

#### **–≠—Ç–∞–ø 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Phone API**
- [ ] **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - Basic Auth —á–µ—Ä–µ–∑ login/password
- [ ] **–ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤** - –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- [ ] **–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤** - –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
- [ ] **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤** - –≤ –∏—Å—Ç–æ—Ä–∏–∏ –ú–æ–π–°–∫–ª–∞–¥

#### **–≠—Ç–∞–ø 4: Integration Cache**
- [ ] **–î–æ–±–∞–≤–∏—Ç—å ms –≤ –∫—ç—à** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [ ] **–†–æ—É—Ç–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π** - dispatch –≤ ms.py –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- [ ] **Primary integration** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ú–æ–π–°–∫–ª–∞–¥ –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π

#### **–≠—Ç–∞–ø 5: Smart Redirect**
- [ ] **customer-by-phone** - –ø–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ú–æ–π–°–∫–ª–∞–¥
- [ ] **responsible-extension** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- [ ] **algorithm="ms"** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ smart.py

### **üîó WEBHOOK URL –°–¢–†–£–ö–¢–£–†–ê:**

**–ê–Ω–∞–ª–æ–≥–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏:**
```
RetailCRM: GET  /retailcrm/make-call?clientId={token}&...
U-ON:      POST /uon/webhook
–ú–æ–π–°–∫–ª–∞–¥:  POST /ms/webhook/{enterprise_number}
```

**–ü—Ä–∏–º–µ—Ä —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ URL –¥–ª—è –∫–æ–ø–∏–ø–∞—Å—Ç–∞:**
```
https://bot.vochi.by/ms/webhook/0367
```

### **üíæ –ë–ê–ó–ê –î–ê–ù–ù–´–•:**

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `enterprises.integrations_config`:**
```json
{
  "ms": {
    "enabled": true,
    "phone_api_url": "https://api.moysklad.ru/api/phone/1.0",
    "integration_code": "165e3202-66ea-46e5-ab4f-3c65ad41d9ab",
    "login": "user@example.com", 
    "password": "password123"
  }
}
```

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: 2025-01-31*  
*–ê–≤—Ç–æ—Ä: AI Assistant*  
*–í–µ—Ä—Å–∏—è: 1.0*  
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-09-02 - –¥–æ–±–∞–≤–ª–µ–Ω –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏*
