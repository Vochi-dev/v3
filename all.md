# üìã –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å–µ—Ä–≤–∏—Å–∞–º–∏

---

# üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–Ø: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

> **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –æ—Ç SSH-—Å–µ—Å—Å–∏–∏**. 
> –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –ù–ï –¥–æ–ª–∂–Ω–∞ –≤–ª–∏—è—Ç—å –Ω–∞ —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

---

## üìå –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `setsid nohup` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. **–í–°–ï–ì–î–ê** –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–π—Ç–µ stdout/stderr –≤ –ª–æ–≥-—Ñ–∞–π–ª
3. **–í–°–ï–ì–î–ê** —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ PID –≤ —Ñ–∞–π–ª –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
4. **–ù–ò–ö–û–ì–î–ê** –Ω–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `&` –±–µ–∑ `setsid nohup`

---

## üìÅ –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ .sh —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞

### –®–∞–±–ª–æ–Ω –¥–ª—è uvicorn-—Å–µ—Ä–≤–∏—Å–∞ (FastAPI/Starlette):

```bash
#!/usr/bin/env bash
# {service_name}.sh ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º {service_name}: start|stop|restart
set -euo pipefail

APP_MODULE="{python_module}:app"    # –ù–∞–ø—Ä–∏–º–µ—Ä: "my_service:app"
HOST="0.0.0.0"
PORT="{port}"                        # –ù–∞–ø—Ä–∏–º–µ—Ä: 8030
PID_FILE=".{service_name}.pid"
LOG_FILE="logs/{service_name}.log"

case "${1:-start}" in
  start)
    cd "$(dirname "$0")"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ —Å–µ—Ä–≤–∏—Å
    if [[ -f "$PID_FILE" ]]; then
      OLD_PID=$(<"$PID_FILE")
      if ps -p "$OLD_PID" > /dev/null 2>&1; then
        echo "‚ö†Ô∏è –°–µ—Ä–≤–∏—Å —É–∂–µ –∑–∞–ø—É—â–µ–Ω (PID=$OLD_PID)"
        exit 0
      else
        echo "‚ö†Ô∏è PID —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –ø—Ä–æ—Ü–µ—Å—Å $OLD_PID –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–¥–∞–ª—è–µ–º."
        rm -f "$PID_FILE"
      fi
    fi
    
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º {service_name} –Ω–∞ –ø–æ—Ä—Ç—É $PORT..."
    
    # ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: setsid nohup –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞!
    setsid nohup uvicorn "$APP_MODULE" \
      --host "$HOST" \
      --port "$PORT" \
      --log-level info \
      >> "$LOG_FILE" 2>&1 &
    
    PID=$!
    echo "$PID" > "$PID_FILE"
    echo "‚úÖ {service_name} –∑–∞–ø—É—â–µ–Ω (PID=$PID)"
    ;;

  stop)
    cd "$(dirname "$0")"
    if [[ -f "$PID_FILE" ]]; then
      PID=$(<"$PID_FILE")
      echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º {service_name} (PID=$PID)..."
      kill -TERM -"$PID" 2>/dev/null || kill -TERM "$PID" 2>/dev/null || true
      rm -f "$PID_FILE"
      echo "‚úÖ {service_name} –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
      echo "‚ö†Ô∏è PID —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
    fi
    
    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ–º –ø–æ—Ä—Ç
    echo "üßπ –ß–∏—Å—Ç–∏–º –ø–æ—Ä—Ç $PORT..."
    fuser -k "$PORT"/tcp 2>/dev/null || true
    echo "‚úÖ –ü–æ—Ä—Ç $PORT —Å–≤–æ–±–æ–¥–µ–Ω"
    ;;

  restart)
    "$0" stop
    sleep 1
    "$0" start
    ;;

  *)
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 {start|stop|restart}"
    exit 1
    ;;
esac
```

### –®–∞–±–ª–æ–Ω –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ Python-—Å–∫—Ä–∏–ø—Ç–∞ (–Ω–µ uvicorn):

```bash
#!/usr/bin/env bash
# {service_name}.sh ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º {service_name}: start|stop|restart
set -euo pipefail

PYTHON_SCRIPT="{script_name}.py"     # –ù–∞–ø—Ä–∏–º–µ—Ä: "my_worker.py"
PORT="{port}"                         # –ü–æ—Ä—Ç, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (–∏–ª–∏ —É–±—Ä–∞—Ç—å)
PID_FILE=".{service_name}.pid"
LOG_FILE="logs/{service_name}.log"

case "${1:-start}" in
  start)
    cd "$(dirname "$0")"
    
    if [[ -f "$PID_FILE" ]]; then
      OLD_PID=$(<"$PID_FILE")
      if ps -p "$OLD_PID" > /dev/null 2>&1; then
        echo "‚ö†Ô∏è –°–µ—Ä–≤–∏—Å —É–∂–µ –∑–∞–ø—É—â–µ–Ω (PID=$OLD_PID)"
        exit 0
      else
        rm -f "$PID_FILE"
      fi
    fi
    
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º $PYTHON_SCRIPT..."
    
    # ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: setsid nohup!
    setsid nohup python3 "$PYTHON_SCRIPT" >> "$LOG_FILE" 2>&1 &
    
    PID=$!
    echo "$PID" > "$PID_FILE"
    echo "‚úÖ $PYTHON_SCRIPT –∑–∞–ø—É—â–µ–Ω (PID=$PID)"
    ;;

  stop)
    cd "$(dirname "$0")"
    if [[ -f "$PID_FILE" ]]; then
      PID=$(<"$PID_FILE")
      echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º $PYTHON_SCRIPT (PID=$PID)..."
      kill "$PID" 2>/dev/null || true
      rm -f "$PID_FILE"
      echo "‚úÖ $PYTHON_SCRIPT –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
      pkill -f "$PYTHON_SCRIPT" || true
      echo "‚ö†Ô∏è –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —á–µ—Ä–µ–∑ pkill"
    fi
    ;;

  restart)
    "$0" stop
    sleep 1
    "$0" start
    ;;

  *)
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 {start|stop|restart}"
    exit 1
    ;;
esac
```

---

## üìÅ –®–∞–≥ 2: –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º

```bash
chmod +x {service_name}.sh
```

---

## üìÅ –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å –≤ all.sh

### –í —Å–µ–∫—Ü–∏—é `start)`:

```bash
    # –ó–∞–ø—É—Å–∫ {service_name} (–ø–æ—Ä—Ç {port})
    echo "   ‚ñ∂ –ó–∞–ø—É—Å–∫–∞–µ–º {service_name}.sh (–ø–æ—Ä—Ç {port})..."
    if ./{service_name}.sh start; then
      echo "   ‚úÖ {service_name} –∑–∞–ø—É—â–µ–Ω"
    else
      echo "   ‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ {service_name}"
    fi
```

### –í —Å–µ–∫—Ü–∏—é `stop)`:

```bash
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ {service_name}
    echo "   ‚ñ∂ –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º {service_name}.sh..."
    ./{service_name}.sh stop || true
```

---

## üìÅ –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å –≤ –∞–¥–º–∏–Ω–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–í —Ñ–∞–π–ª–µ `app/routers/admin.py` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `get_services_status()` –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–ª–æ–≤–∞—Ä—å `services_info`:

```python
"{service_name}": {"port": {port}, "script": "{service_name}.sh", "app": "{python_module}"},
```

---

## ‚ö†Ô∏è –ß–ê–°–¢–´–ï –û–®–ò–ë–ö–ò (–ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö!)

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:

```bash
# –ü—Ä–æ—Ü–µ—Å—Å —É–º—Ä—ë—Ç –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞!
python3 my_service.py &

# nohup –±–µ–∑ setsid ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å SIGHUP
nohup python3 my_service.py &

# setsid –±–µ–∑ nohup ‚Äî stdout/stderr –º–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
setsid python3 my_service.py &

# –ó–∞–ø—É—Å–∫ –Ω–∞–ø—Ä—è–º—É—é –≤ all.sh –±–µ–∑ —Å–∫—Ä–∏–ø—Ç–∞
nohup uvicorn my_service:app --port 8030 &
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:

```bash
# –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
setsid nohup python3 my_service.py >> logs/my_service.log 2>&1 &
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–µ—Ä–≤–∏—Å –Ω–µ–∑–∞–≤–∏—Å–∏–º –æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# TTY –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "?" (–Ω–µ pts/X)
ps aux | grep {service_name} | grep -v grep | awk '{print "PID:", $2, "TTY:", $7}'
```

–ï—Å–ª–∏ TTY –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `pts/0`, `pts/1` –∏ —Ç.–¥. ‚Äî —Å–µ—Ä–≤–∏—Å **–ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É** –∏ —É–º—Ä—ë—Ç –ø—Ä–∏ –µ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏–∏!

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

- [ ] –°–æ–∑–¥–∞–Ω `{service_name}.sh` —Å `setsid nohup`
- [ ] –°–∫—Ä–∏–ø—Ç —Å–¥–µ–ª–∞–Ω –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º (`chmod +x`)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –≤ `all.sh` —Å–µ–∫—Ü–∏—é `start)`
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –≤ `all.sh` —Å–µ–∫—Ü–∏—é `stop)`
- [ ] –î–æ–±–∞–≤–ª–µ–Ω –≤ `admin.py` (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –≤ –∞–¥–º–∏–Ω–∫–µ)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω TTY –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `?`)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

---
---

# üìã –ü–ª–∞–Ω –º–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ (–∞—Ä—Ö–∏–≤)

## üéØ –¶–µ–ª—å

–°–¥–µ–ª–∞—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –æ—Ç SSH-—Å–µ—Å—Å–∏–∏**, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –Ω–µ –≤–ª–∏—è–ª–∞ –Ω–∞ —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

---

## üìä –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è (–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ 2025-11-26)

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | TTY | –°—Ç–∞—Ç—É—Å |
|-----------|------------|-----|--------|
| üî¥ –ü—Ä–∏–≤—è–∑–∞–Ω—ã –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É (pts/5) | **97** | pts/5 | –£–º—Ä—É—Ç –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ SSH |
| üü¢ –î–µ–º–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã | **17** | ? | –í—ã–∂–∏–≤—É—Ç |

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (–ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ SSH):

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –°–∫—Ä–∏–ø—Ç | –ü—Ä–æ–±–ª–µ–º–∞ |
|--------|------|--------|----------|
| **78 Telegram-–±–æ—Ç–æ–≤** | - | start_bots.sh | `nohup` –±–µ–∑ `setsid` |
| integration_cache | 8020 | integration_cache.sh | –ù–µ—Ç `nohup`, –Ω–µ—Ç `setsid` |
| enterprise_admin_service | 8004 | admin.sh | ? |
| goip_sms_service | 8002 | sms.sh | –ó–∞–ø—É—Å–∫ –≤ all.sh –Ω–∞–ø—Ä—è–º—É—é |
| send_service_sms | - | sms_send.sh | ? |
| send_user_sms | - | send_user_sms.sh | ? |
| auth | 8015 | auth.sh | ? |
| goip_service | 8008 | goip.sh | ? |
| miniapp_service | - | miniapp.sh | ? |
| retailcrm | 8019 | retailcrm.sh | `nohup` –µ—Å—Ç—å, –Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω |
| uon | 8022 | uon.sh | `nohup` –µ—Å—Ç—å, –Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω |
| ms | 8023 | ms.sh | `nohup` –µ—Å—Ç—å, –Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω |
| 24.py | - | 24.sh | `nohup` –µ—Å—Ç—å, –Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω |
| call_tester | 8025 | test.sh | ? |
| logger | 8026 | logger.sh | `nohup` –µ—Å—Ç—å, –Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω |
| reboot.py | 8009 | all.sh (–Ω–∞–ø—Ä—è–º—É—é) | –ù–µ—Ç —Å–∫—Ä–∏–ø—Ç–∞ |
| ewelink_api | 8010 | all.sh (–Ω–∞–ø—Ä—è–º—É—é) | –ù–µ—Ç —Å–∫—Ä–∏–ø—Ç–∞ |

### –†–∞–±–æ—Ç–∞—é—â–∏–µ —Å–µ—Ä–≤–∏—Å—ã (–¥–µ–º–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ):

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –°–∫—Ä–∏–ø—Ç | –ü–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç |
|--------|------|--------|-----------------|
| main | 8000 | 111.sh | ? |
| dial_service | 8005 | dial.sh | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `setsid` ‚úÖ |
| plan | 8006 | plan.sh | ? |
| smart | 8021 | smart.sh | ? |
| telegram_auth_service | 8016 | telegram.sh | ? |
| download | 8007 | download.sh | ? |
| desk | 8011 | desk.sh | ? |
| call_download | 8012 | call.sh | ? |
| asterisk | 8018 | asterisk.sh | ? |

---

## üîç –≠—Ç–∞–ø 1: –ê—É–¥–∏—Ç –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ ‚úÖ –ó–ê–í–ï–†–®–Å–ù

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–∞ (2025-11-26):

### ‚úÖ –°–∫—Ä–∏–ø—Ç—ã —Å `setsid` (—Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ) - 10 —à—Ç:

| –°–∫—Ä–∏–ø—Ç | –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –°–ø–æ—Å–æ–± –∑–∞–ø—É—Å–∫–∞ |
|--------|--------|------|----------------|
| 111.sh | main | 8000 | `setsid uvicorn` |
| dial.sh | dial_service | 8005 | `setsid uvicorn` |
| plan.sh | plan | 8006 | `nohup setsid uvicorn` |
| download.sh | download | 8007 | `setsid uvicorn` |
| desk.sh | desk | 8011 | `setsid uvicorn` |
| call.sh | call_download | 8012 | `setsid uvicorn` |
| telegram.sh | telegram_auth_service | 8016 | `setsid uvicorn` |
| asterisk.sh | asterisk | 8018 | `setsid uvicorn` |
| smart.sh | smart | 8021 | `nohup setsid uvicorn` |

### ‚ö†Ô∏è –°–∫—Ä–∏–ø—Ç—ã —Å `nohup` –ë–ï–ó `setsid` (–Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å) - 14 —à—Ç:

| –°–∫—Ä–∏–ø—Ç | –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –¢–µ–∫—É—â–∏–π —Å–ø–æ—Å–æ–± | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
|--------|--------|------|----------------|-------------|
| admin.sh | enterprise_admin_service | 8004 | `nohup uvicorn ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| goip.sh | goip_service | 8008 | `nohup uvicorn ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| reboot.sh | reboot.py | 8009 | `nohup python3 ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| ewelink.sh | ewelink_api | 8010 | `nohup python3 ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| auth.sh | auth | 8015 | `nohup uvicorn ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| retailcrm.sh | retailcrm | 8019 | `nohup python -m uvicorn ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| uon.sh | uon | 8022 | `nohup uvicorn ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| ms.sh | ms | 8023 | `nohup python -m uvicorn ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| test.sh | call_tester | 8025 | `nohup uvicorn ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| logger.sh | logger | 8026 | `nohup uvicorn ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| 24.sh | 24.py | - | `nohup python3 ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| sms_send.sh | send_service_sms | - | `nohup python3 ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| send_user_sms.sh | send_user_sms | - | `nohup python3 ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |
| miniapp.sh | miniapp_service | - | `nohup python3 ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |

### ‚ùå –°–∫—Ä–∏–ø—Ç—ã –ë–ï–ó `nohup` –∏ `setsid` (–∫—Ä–∏—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å) - 2 —à—Ç:

| –°–∫—Ä–∏–ø—Ç | –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –¢–µ–∫—É—â–∏–π —Å–ø–æ—Å–æ–± | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
|--------|--------|------|----------------|-------------|
| integration_cache.sh | integration_cache | 8020 | `python3 ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid nohup` |
| sms.sh | goip_sms_service | 8002 | –ù–µ –Ω–∞–π–¥–µ–Ω–æ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å/–∏—Å–ø—Ä–∞–≤–∏—Ç—å |

### ‚ö†Ô∏è –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π - start_bots.sh (78 –±–æ—Ç–æ–≤):

| –°–∫—Ä–∏–ø—Ç | –°–µ—Ä–≤–∏—Å—ã | –¢–µ–∫—É—â–∏–π —Å–ø–æ—Å–æ–± | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
|--------|---------|----------------|-------------|
| start_bots.sh | 78 Telegram-–±–æ—Ç–æ–≤ | `nohup python3 ... &` | –î–æ–±–∞–≤–∏—Ç—å `setsid` |

---

### üìä –°–≤–æ–¥–∫–∞:

| –°—Ç–∞—Ç—É—Å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|--------|------------|---------|
| ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (setsid) | 10 | 38% |
| ‚ö†Ô∏è –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å setsid | 14 | 54% |
| ‚ùå –ö—Ä–∏—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å | 2 | 8% |
| **–ò—Ç–æ–≥–æ** | **26** | 100% |

**+ start_bots.sh** (–∑–∞–ø—É—Å–∫–∞–µ—Ç 78 –±–æ—Ç–æ–≤) - –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `setsid`

---

## üõ†Ô∏è –≠—Ç–∞–ø 2: –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∂–¥—ã–π —Å–∫—Ä–∏–ø—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ

**–ü–ª—é—Å—ã:**
- –¢–æ—á–µ—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫

**–ú–∏–Ω—É—Å—ã:**
- –ú–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –†–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```bash
# –ó–∞–º–µ–Ω–∏—Ç—å –≤–æ –≤—Å–µ—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö:
# –ë–´–õ–û:
nohup python3 script.py > log.log 2>&1 &

# –°–¢–ê–õ–û:
setsid nohup python3 script.py > log.log 2>&1 &
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å systemd

**–ü–ª—é—Å—ã:**
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥ Linux
- –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ journald

**–ú–∏–Ω—É—Å—ã:**
- –ù—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å unit-—Ñ–∞–π–ª—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
- –ë–æ–ª—å—à–µ —Ä–∞–±–æ—Ç—ã –Ω–∞ –Ω–∞—á–∞–ª—å–Ω–æ–º —ç—Ç–∞–ø–µ

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```ini
# /etc/systemd/system/asterisk-main.service
[Unit]
Description=Asterisk Webhook Main Service
After=network.target postgresql.service

[Service]
Type=simple
User=root
WorkingDirectory=/root/asterisk-webhook
ExecStart=/usr/bin/python3 /usr/local/bin/uvicorn main:app --host 0.0.0.0 --port 8000
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

### –í–∞—Ä–∏–∞–Ω—Ç C: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å screen/tmux

**–ü–ª—é—Å—ã:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—ã–≤–æ–¥

**–ú–∏–Ω—É—Å—ã:**
- –ù–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
- –ú–µ–Ω–µ–µ –Ω–∞–¥—ë–∂–Ω–æ

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ screen
screen -dmS services ./all.sh start
```

### –í–∞—Ä–∏–∞–Ω—Ç D: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥

**–ò–¥–µ—è:**
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º `setsid`
2. –°–æ–∑–¥–∞—Ç—å systemd unit –¥–ª—è `all.sh` (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫)

---

## üìù –≠—Ç–∞–ø 3: –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥: –î–æ–±–∞–≤–∏—Ç—å `setsid` –≤–æ –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã

#### –®–∞–≥ 1: –ê—É–¥–∏—Ç ‚úÖ –ó–ê–í–ï–†–®–Å–ù
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ `.sh` —Å–∫—Ä–∏–ø—Ç—ã
- ‚úÖ –ó–∞–ø–æ–ª–Ω–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ —Å–ø–æ—Å–æ–±–æ–≤ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ: 10 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö, 16 —Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ (16 —Ñ–∞–π–ª–æ–≤)

**–ü–æ—Ä—è–¥–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**

1. **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–±–µ–∑ nohup):**
   - [ ] `integration_cache.sh` - –¥–æ–±–∞–≤–∏—Ç—å `setsid nohup`
   - [ ] `sms.sh` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

2. **–° nohup, –Ω–æ –±–µ–∑ setsid:**
   - [ ] `admin.sh`
   - [ ] `goip.sh`
   - [ ] `reboot.sh`
   - [ ] `ewelink.sh`
   - [ ] `auth.sh`
   - [ ] `retailcrm.sh`
   - [ ] `uon.sh`
   - [ ] `ms.sh`
   - [ ] `test.sh`
   - [ ] `logger.sh`
   - [ ] `24.sh`
   - [ ] `sms_send.sh`
   - [ ] `send_user_sms.sh`
   - [ ] `miniapp.sh`

3. **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª—É—á–∞–π:**
   - [ ] `start_bots.sh` - –¥–æ–±–∞–≤–∏—Ç—å `setsid` –¥–ª—è –≤—Å–µ—Ö 78 –±–æ—Ç–æ–≤

#### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã: `./all.sh stop`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã: `./all.sh start`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ–º–æ–Ω–∏–∑–∞—Ü–∏—é:
  ```bash
  ps aux | grep -E "(python|uvicorn)" | grep "pts/" | wc -l
  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: 0
  ```
- [ ] –ó–∞–∫—Ä—ã—Ç—å SSH-—Å–µ—Å—Å–∏—é (–ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª)
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç

#### –®–∞–≥ 4: Systemd unit (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω–∞ –±—É–¥—É—â–µ–µ)
- [ ] –°–æ–∑–¥–∞—Ç—å `/etc/systemd/system/asterisk-webhook.service`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

---

## üìã –≠—Ç–∞–ø 4: –®–∞–±–ª–æ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

### –≠—Ç–∞–ª–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (–Ω–∞ –æ—Å–Ω–æ–≤–µ dial.sh):

```bash
#!/usr/bin/env bash
# service_name.sh ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º: start|stop|restart
set -euo pipefail

SERVICE_NAME="service_name"
APP_MODULE="service_name:app"  # –∏–ª–∏ PYTHON_FILE="service_name.py"
HOST="0.0.0.0"
PORT="8XXX"
PID_FILE=".${SERVICE_NAME}.pid"
LOG_FILE="logs/${SERVICE_NAME}.log"

# –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p logs

case "${1:-start}" in
  start)
    cd "$(dirname "$0")"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ —É–∂–µ
    if [[ -f "$PID_FILE" ]]; then
      PID=$(<"$PID_FILE")
      if ps -p "$PID" > /dev/null 2>&1; then
        echo "‚ö†Ô∏è $SERVICE_NAME —É–∂–µ –∑–∞–ø—É—â–µ–Ω (PID=$PID)"
        exit 1
      else
        rm -f "$PID_FILE"
      fi
    fi
    
    echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º $SERVICE_NAME..."
    
    # ‚úÖ –ö–õ–Æ–ß–ï–í–û–ï: setsid —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é, –æ—Ç–≤—è–∑—ã–≤–∞—è –æ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
    setsid nohup uvicorn "$APP_MODULE" \
      --host "$HOST" \
      --port "$PORT" \
      --log-level info \
      > "$LOG_FILE" 2>&1 &
    
    PID=$!
    echo "$PID" > "$PID_FILE"
    
    sleep 2
    if ps -p "$PID" > /dev/null 2>&1; then
      echo "‚úÖ $SERVICE_NAME –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É $PORT (PID=$PID)"
    else
      echo "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ $SERVICE_NAME"
      rm -f "$PID_FILE"
      exit 1
    fi
    ;;

  stop)
    cd "$(dirname "$0")"
    
    if [[ -f "$PID_FILE" ]]; then
      PID=$(<"$PID_FILE")
      echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º $SERVICE_NAME (PID=$PID)..."
      
      # –ü—ã—Ç–∞–µ–º—Å—è —É–±–∏—Ç—å –≥—Ä—É–ø–ø—É –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
      kill -TERM -"$PID" 2>/dev/null || kill -TERM "$PID" 2>/dev/null || true
      
      sleep 2
      
      # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –µ—Å–ª–∏ –Ω–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è
      if ps -p "$PID" > /dev/null 2>&1; then
        kill -KILL "$PID" 2>/dev/null || true
      fi
      
      rm -f "$PID_FILE"
      echo "‚úÖ $SERVICE_NAME –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
      echo "‚ö†Ô∏è PID —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å..."
      pkill -f "$APP_MODULE" || true
    fi
    
    # –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–æ—Ä—Ç
    fuser -k "$PORT"/tcp 2>/dev/null || true
    ;;

  restart)
    "$0" stop
    sleep 2
    "$0" start
    ;;

  status)
    if [[ -f "$PID_FILE" ]]; then
      PID=$(<"$PID_FILE")
      if ps -p "$PID" > /dev/null 2>&1; then
        echo "‚úÖ $SERVICE_NAME —Ä–∞–±–æ—Ç–∞–µ—Ç (PID=$PID)"
      else
        echo "‚ùå $SERVICE_NAME –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (PID —Ñ–∞–π–ª —É—Å—Ç–∞—Ä–µ–ª)"
      fi
    else
      echo "‚ùì –°—Ç–∞—Ç—É—Å –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω (–Ω–µ—Ç PID —Ñ–∞–π–ª–∞)"
    fi
    ;;

  *)
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 {start|stop|restart|status}"
    exit 1
    ;;
esac
```

---

## üìã –≠—Ç–∞–ø 5: –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–ª—É—á–∞–∏

### 5.1 Telegram-–±–æ—Ç—ã (start_bots.sh)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è 78 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ö–∞–∂–¥—ã–π –±–æ—Ç –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å–µ—Å—Å–∏–∏
for number in $enterprise_numbers; do
  setsid nohup python3 "$BOT_SCRIPT" --enterprise "$number" >> "$LOG_FILE" 2>&1 &
done
```

### 5.2 –°–µ—Ä–≤–∏—Å—ã –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ (reboot.py, ewelink_api)

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ `all.sh`

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ `.sh` —Å–∫—Ä–∏–ø—Ç—ã –ø–æ —à–∞–±–ª–æ–Ω—É.

### 5.3 –°–µ—Ä–≤–∏—Å—ã —Å workers (main, logger)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** `--workers 4` —Å–æ–∑–¥–∞—ë—Ç –¥–æ—á–µ—Ä–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã.

**–†–µ—à–µ–Ω–∏–µ:** `setsid` –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ—Ö –¥–µ—Ç–µ–π.

---

## ‚úÖ –≠—Ç–∞–ø 6: –ß–µ–∫-–ª–∏—Å—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:

- [ ] –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã: `./all.sh stop`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã: `./all.sh start`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–µ–º–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:
  ```bash
  ps aux | grep -E "(python|uvicorn)" | grep -v grep | awk '{print $7}' | sort | uniq -c
  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: –≤—Å–µ "?" –∏ –Ω–æ–ª—å "pts/X"
  ```
- [ ] –ó–∞–∫—Ä—ã—Ç—å SSH-—Å–µ—Å—Å–∏—é (–Ω–µ `./all.sh stop`, –∞ –ø—Ä–æ—Å—Ç–æ –∑–∞–∫—Ä—ã—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª)
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ –ø–æ SSH
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç:
  ```bash
  curl http://localhost:8000/health  # main
  curl http://localhost:8026/health  # logger
  # –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ...
  ```
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–æ—Ç—ã –æ—Ç–≤–µ—á–∞—é—Ç –≤ Telegram

---

## üìÖ –í—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|----------|
| –ê—É–¥–∏—Ç —Å–∫—Ä–∏–ø—Ç–æ–≤ | 30 –º–∏–Ω | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ .sh —Ñ–∞–π–ª—ã |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ | 1-2 —á–∞—Å–∞ | –î–æ–±–∞–≤–∏—Ç—å setsid –≤–µ–∑–¥–µ |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 30 –º–∏–Ω | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | 15 –º–∏–Ω | –û–±–Ω–æ–≤–∏—Ç—å README |
| **–ò—Ç–æ–≥–æ** | **~3 —á–∞—Å–∞** | |

---

## üö® –†–∏—Å–∫–∏ –∏ –æ—Ç–∫–∞—Ç

### –†–∏—Å–∫–∏:
1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
2. –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `setsid` –º–µ–Ω—è–µ—Ç—Å—è —Å–ø–æ—Å–æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (–Ω—É–∂–Ω–æ —É–±–∏–≤–∞—Ç—å –≥—Ä—É–ø–ø—É)

### –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞:
1. –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Å–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø –≤—Å–µ—Ö `.sh` —Ñ–∞–π–ª–æ–≤:
   ```bash
   mkdir -p backup_scripts
   cp *.sh backup_scripts/
   ```
2. –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
   ```bash
   cp backup_scripts/*.sh ./
   ```

---

## üìù –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –≠—Ç–∞–ø | –°—Ç–∞—Ç—É—Å | –î–∞—Ç–∞ | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|------|--------|------|------------|
| –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2025-11-26 | 97 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ SSH |
| –ü–ª–∞–Ω | ‚úÖ –°–æ–∑–¥–∞–Ω | 2025-11-26 | –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç |
| –ê—É–¥–∏—Ç —Å–∫—Ä–∏–ø—Ç–æ–≤ | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2025-11-26 | 10 –û–ö, 16 —Ç—Ä–µ–±—É—é—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ | ‚è≥ –û–∂–∏–¥–∞–µ—Ç | - | 16 —Ñ–∞–π–ª–æ–≤ + start_bots.sh |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚è≥ –û–∂–∏–¥–∞–µ—Ç | - | - |
| –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ | ‚è≥ –û–∂–∏–¥–∞–µ—Ç | - | - |

---

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞

### 1. integration_cache.sh (–ö–†–ò–¢–ò–ß–ù–û)

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
python3 -u "$PYTHON_FILE" > "$LOG_FILE" 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup python3 -u "$PYTHON_FILE" > "$LOG_FILE" 2>&1 &
```

---

### 2. admin.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup $UVICORN_PATH $APP_MODULE --host $HOST --port $PORT >> $LOG_FILE 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup $UVICORN_PATH $APP_MODULE --host $HOST --port $PORT >> $LOG_FILE 2>&1 &
```

---

### 3. goip.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup $UVICORN_PATH $APP_MODULE --host $HOST --port $PORT >> $LOG_FILE 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup $UVICORN_PATH $APP_MODULE --host $HOST --port $PORT >> $LOG_FILE 2>&1 &
```

---

### 4. reboot.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup $PYTHON_BIN $APP >> "$LOG_FILE" 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup $PYTHON_BIN $APP >> "$LOG_FILE" 2>&1 &
```

---

### 5. ewelink.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup $PYTHON_BIN $APP >> "$LOG_FILE" 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup $PYTHON_BIN $APP >> "$LOG_FILE" 2>&1 &
```

---

### 6. auth.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup $UVICORN_PATH $APP_MODULE --host $HOST --port $PORT >> $LOG_FILE 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup $UVICORN_PATH $APP_MODULE --host $HOST --port $PORT >> $LOG_FILE 2>&1 &
```

---

### 7. retailcrm.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup /root/asterisk-webhook/venv/bin/python -m uvicorn "$APP_MODULE" \
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup /root/asterisk-webhook/venv/bin/python -m uvicorn "$APP_MODULE" \
```

---

### 8. uon.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup uvicorn uon:app --host 0.0.0.0 --port ${PORT} > "$LOG_FILE" 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup uvicorn uon:app --host 0.0.0.0 --port ${PORT} > "$LOG_FILE" 2>&1 &
```

---

### 9. ms.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup /root/asterisk-webhook/venv/bin/python -m uvicorn "$APP_MODULE" \
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup /root/asterisk-webhook/venv/bin/python -m uvicorn "$APP_MODULE" \
```

---

### 10. test.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup uvicorn call_tester:app --host $HOST --port $PORT > $LOG_FILE 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup uvicorn call_tester:app --host $HOST --port $PORT > $LOG_FILE 2>&1 &
```

---

### 11. logger.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup /usr/bin/python3 /usr/local/bin/uvicorn $SERVICE_NAME:app \
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup /usr/bin/python3 /usr/local/bin/uvicorn $SERVICE_NAME:app \
```

---

### 12. 24.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup python3 "$SERVICE_FILE" > "$LOG_FILE" 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup python3 "$SERVICE_FILE" > "$LOG_FILE" 2>&1 &
```

---

### 13. sms_send.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup python3 "$PYTHON_SCRIPT" > "$LOG_FILE" 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup python3 "$PYTHON_SCRIPT" > "$LOG_FILE" 2>&1 &
```

---

### 14. send_user_sms.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup python3 "$PYTHON_SCRIPT" > "$LOG_FILE" 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup python3 "$PYTHON_SCRIPT" > "$LOG_FILE" 2>&1 &
```

---

### 15. miniapp.sh

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup python3 $SERVICE_FILE > $LOG_FILE 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup python3 $SERVICE_FILE > $LOG_FILE 2>&1 &
```

---

### 16. start_bots.sh (78 –±–æ—Ç–æ–≤)

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞:**
```bash
nohup env PYTHONPATH=/root/asterisk-webhook python3 "$BOT_SCRIPT" --enterprise "$number" >> "$LOG_FILE" 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup env PYTHONPATH=/root/asterisk-webhook python3 "$BOT_SCRIPT" --enterprise "$number" >> "$LOG_FILE" 2>&1 &
```

---

### 17. sms.sh ‚Üí all.sh (–æ—Å–æ–±—ã–π —Å–ª—É—á–∞–π)

**–°–∏—Ç—É–∞—Ü–∏—è:** `sms.sh` –∑–∞–ø—É—Å–∫–∞–µ—Ç uvicorn –≤ foreground (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏).  
–í `all.sh` —Å–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–Ω–∞–ø—Ä—è–º—É—é**, –º–∏–Ω—É—è `sms.sh`.

**–¢–µ–∫—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ all.sh:**
```bash
nohup uvicorn goip_sms_service:app --host 0.0.0.0 --port 8002 > logs/goip_service.log 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup uvicorn goip_sms_service:app --host 0.0.0.0 --port 8002 > logs/goip_service.log 2>&1 &
```

---

### 18. all.sh - reboot.py –∏ ewelink_api (–∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é)

**–¢–µ–∫—É—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ all.sh:**
```bash
nohup python3 reboot.py > reboot_service.log 2>&1 &
nohup uvicorn ewelink_api:app --host 0.0.0.0 --port 8010 > ewelink_service.log 2>&1 &
```

**–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞:**
```bash
setsid nohup python3 reboot.py > reboot_service.log 2>&1 &
setsid nohup uvicorn ewelink_api:app --host 0.0.0.0 --port 8010 > ewelink_service.log 2>&1 &
```

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 2025-11-26  
**–ê–≤—Ç–æ—Ä:** –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

