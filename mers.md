# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –¥–ª—è —Ö–æ—Å—Ç–∞ 10.88.10.116 (Mercedes Master / Mers Academy)

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø—Ä–∞–≤–∫–∞—Ö –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –¥–∏–∞–ª–ø–ª–∞–Ω–µ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ SIP –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å AmoCRM –∏ —Å—Ç–∞—Ä—ã–º —Å–µ—Ä–≤–∏—Å–æ–º.

**–í–ê–ñ–ù–û:** –§–∞–π–ª—ã `extensions.conf` –∏ `sip_addproviders.conf` —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —Å—Ç–∞—Ä—ã–º —Å–µ—Ä–≤–∏—Å–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ü—Ä–∏ –∏—Ö –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—Ä—É—á–Ω—É—é –≤–Ω–µ—Å—Ç–∏ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –Ω–∏–∂–µ –ø—Ä–∞–≤–∫–∏.

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç 13.11.2025

### **–ü—Ä–æ–±–ª–µ–º–∞:**
–î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 163 –ú–∞–∫—Å–∏–º –†–æ–º–∞–Ω–æ–≤) –∑–≤–æ–Ω–∫–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏ –∑–∞–ø–∏—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –≤ AmoCRM. 

**–ü—Ä–∏—á–∏–Ω–∞:** 
–¢—Ä–∞–Ω–∫–∏ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π `fromusername` –≤ `sip_addproviders.conf` (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç—Ä–∞–Ω–∫ 3880995) –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–ª–∏ CallerID –ø—Ä–∏ –∏—Å—Ö–æ–¥—è—â–µ–º –∑–≤–æ–Ω–∫–µ. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤ —Å–æ–±—ã—Ç–∏–∏ `outcallEnd` –≤–º–µ—Å—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –Ω–æ–º–µ—Ä–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (163) –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –Ω–æ–º–µ—Ä —Ç—Ä–∞–Ω–∫–∞ (3880995), –∏ —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–∏—Å –Ω–µ –º–æ–≥ –Ω–∞–π—Ç–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ AmoCRM.

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –î–û —Ç–æ–≥–æ, –∫–∞–∫ —Ç—Ä–∞–Ω–∫ –µ–≥–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç, –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏—è hangup.

---

## üîß –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∫–∏ –≤ extensions_custom.conf

### **–§–∞–π–ª:** `/etc/asterisk/extensions_custom.conf`

### 1Ô∏è‚É£ –ú–∞–∫—Ä–æ—Å `[macro-outcall_dial]` (—Å—Ç—Ä–æ–∫–∞ ~377)

**–î–æ–±–∞–≤–∏—Ç—å** –ø–æ—Å–ª–µ `exten => s,1,Set(LisAMI_CallType=out)`:

```asterisk
[macro-outcall_dial]
exten => s,1,Set(LisAMI_CallType=out)
same => n,Set(OriginalExtension=${CALLERID(num)})           ‚Üê –î–û–ë–ê–í–ò–¢–¨ –≠–¢–£ –°–¢–†–û–ö–£!
same => n,Set(CallStartDT=${STRFTIME(${EPOCH},,%Y-%m-%d %H:%M:%S)})
same => n,Set(PhoneTo=${ARG2})
same => n,Set(LisAMI_DialNum=${ARG2})
same => n,Set(LisAMI_Trunk=${ARG1})
same => n,Set(Trunk=${ARG1})
same => n,Set(LisAMI_PhoneTo=${ARG2})
same => n,Set(LisAMI_EventData=outcallDial_${ARG2}_${CALLERID(num)}_${ARG1})
same => n,Macroexit
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `OriginalExtension` –î–û —Ç–æ–≥–æ, –∫–∞–∫ —Ç—Ä–∞–Ω–∫ –µ–≥–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç.

---

### 2Ô∏è‚É£ –ú–∞–∫—Ä–æ—Å `[macro-outcall_end]` (—Å—Ç—Ä–æ–∫–∞ ~464)

**–ó–∞–º–µ–Ω–∏—Ç—å** –≤ —Å—Ç—Ä–æ–∫–µ —Å `LisAMI_EventData`:
- **–ë–´–õ–û:** `${CALLERID(num)}`
- **–°–¢–ê–õ–û:** `${OriginalExtension}`

```asterisk
[macro-outcall_end]
exten => s,1,Set(LisAMI_EventData=outcallEnd_${PhoneTo}_${OriginalExtension}_${CDR(start)}_${CallStartDT}_${STRFTIME(${EPOCH},,%Y-%m-%d %H:%M:%S)}_${ARG1}_${DIALSTATUS})
                                                          ^^^^^^^^^^^^^^^^^^^
                                                          –í–ú–ï–°–¢–û ${CALLERID(num)}
same => n,Macroexit
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–∞–Ω–∫–æ–º CallerID.

---

## üîÑ –ü–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∏–∞–ª–ø–ª–∞–Ω:

```bash
asterisk -rx "dialplan reload"
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞–∫—Ä–æ—Å–æ–≤:

```bash
asterisk -rx "dialplan show macro-outcall_dial" | head -10
asterisk -rx "dialplan show macro-outcall_end" | head -5
```

---

## ‚úÖ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### **–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
–í SQLite –ª–æ–≥–µ `/var/log/asterisk/Listen_AMI_YYYY-MM-DD.db` –≤ —Ç–∞–±–ª–∏—Ü–µ `APIlogs`:

```sql
SELECT event, request FROM APIlogs WHERE Uniqueid = 'UNIQUEID_–ó–í–û–ù–ö–ê';
```

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è hangup:**
```json
{
  "Extensions": ["3880995"],  ‚Üê –ù–û–ú–ï–† –¢–†–ê–ù–ö–ê –≤–º–µ—Å—Ç–æ –Ω–æ–º–µ—Ä–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞!
  "Phone": "79261634513",
  "UniqueId": "...",
  ...
}
```

### **–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```json
{
  "Extensions": ["163"],      ‚Üê –ü–†–ê–í–ò–õ–¨–ù–´–ô –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞!
  "Phone": "79261634513",
  "UniqueId": "...",
  ...
}
```

---

## üìä –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞ | –ê–≤—Ç–æ—Ä | –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|------|-------|-----------|--------|
| 13.11.2025 | AI Assistant | –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ OriginalExtension –≤ macro-outcall_dial –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ macro-outcall_end | ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ |

---

## üö® –í–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å

1. **–ë—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:** –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é `extensions_custom.conf` –ø–µ—Ä–µ–¥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–≤–æ–Ω–∫–∏ –≤—Å–µ—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ —Ç–µ—Ö, —É –∫–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç—Ä–∞–Ω–∫–∏ —Å `fromusername`
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SQLite –ª–æ–≥–∏ –∏ —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–∏—Å –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏–π –≤ AmoCRM

---

## üìû –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Ç—Ä–∞–Ω–∫–∏ (—Å fromusername)

–°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç CallerID:

- **3880995** (BelTeleCom) - fromusername=3880995, fromdomain=213.184.241.3

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∫–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `fromusername` –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `/etc/asterisk/extensions.conf` - –æ—Å–Ω–æ–≤–Ω–æ–π –¥–∏–∞–ª–ø–ª–∞–Ω (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `/etc/asterisk/extensions_custom.conf` - **–≠–¢–û–¢ –§–ê–ô–õ –†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–∞–∫—Ä–æ—Å—ã)
- `/etc/asterisk/sip_addproviders.conf` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SIP —Ç—Ä–∞–Ω–∫–æ–≤ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- `/var/lib/asterisk/agi-bin/listen_AMI_python/listen_AMI_python.py` - Python —Å–∫—Ä–∏–ø—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ AMI —Å–æ–±—ã—Ç–∏–π
- `/var/log/asterisk/Listen_AMI_YYYY-MM-DD.db` - SQLite –ª–æ–≥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (—Ç–∞–±–ª–∏—Ü–∞ APIlogs)
