<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="version" content="v2.1.{{ timestamp }}">
    <title>{{ enterprise_name }} —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/static/apple-touch-icon.png">
    <link rel="manifest" href="/static/site.webmanifest">
    <meta name="theme-color" content="#2563eb">
    <meta name="msapplication-TileColor" content="#2563eb">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/20.3.0/css/intlTelInput.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-top: 20px;
            padding: 30px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e0e6ed;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .btn {
            border-radius: 10px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .btn-success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            border: none;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .result-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #667eea;
            display: none;
        }
        .result-panel.show {
            display: block;
            animation: slideIn 0.5s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .icon-input {
            position: relative;
        }
        .icon-input i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
        .icon-input input, .icon-input select {
            padding-left: 45px;
        }
        .loading {
            display: none;
        }
        .loading.show {
            display: inline-block;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Å–µ–≥–¥–∞ */
        [data-field="duration"] {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="row">
                    <!-- –ü–æ–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∏–ø–∞ –∑–≤–æ–Ω–∫–∞ -->
                    <div class="col-md-4">
                        <div class="main-container" style="min-height: 500px;">
                            <h5><i class="fas fa-info-circle"></i> –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞ –∑–≤–æ–Ω–∫–∞</h5>
                            <div id="call-type-description" style="background: #f8f9fa; border-radius: 10px; padding: 15px; min-height: 300px; border: 2px dashed #dee2e6;">
                                <p class="text-muted text-center" style="margin-top: 100px;">
                                    <i class="fas fa-arrow-right fa-2x"></i><br><br>
                                    –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–≤–æ–Ω–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–ø–∏—Å–∞–Ω–∏—è
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
                    <div class="col-md-8">
                        <div class="main-container">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                    <div class="header">
                        <h1><i class="fas fa-phone-alt"></i> –¢–µ—Å—Ç–µ—Ä –∑–≤–æ–Ω–∫–æ–≤</h1>
                        <h3 class="text-muted">{{ enterprise_name }} ({{ enterprise_number }})</h3>
                        <p class="text-muted">–≠–º—É–ª—è—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –∑–≤–æ–Ω–∫–∞ —Å –æ–±–æ–≥–∞—â–µ–Ω–∏–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏</p>
                    </div>

                    <!-- –§–æ—Ä–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
                    <form id="testForm">
                        <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –Ω–æ–º–µ—Ä–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è -->
                        <input type="hidden" name="enterprise" id="enterpriseInput" value="{{ enterprise_number }}">
                        
                        <div class="row">
                            <!-- –¢–∏–ø –∑–≤–æ–Ω–∫–∞ -->
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-phone-volume"></i> –¢–∏–ø –∑–≤–æ–Ω–∫–∞
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-list"></i>
                                        <select class="form-select" name="call_type" id="call_type" required>
                                            {% for ct in call_types %}
                                            <option value="{{ ct.id }}">{{ ct.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="row">
                            <!-- –í–Ω–µ—à–Ω–∏–π –Ω–æ–º–µ—Ä -->
                            <div class="col-md-12" data-field="external_phone">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-mobile-alt"></i> –í–Ω–µ—à–Ω–∏–π –Ω–æ–º–µ—Ä
                                    </label>
                                    <div class="icon-input" style="width: 100%;">
                                        <input type="tel" id="external_phone_input" class="form-control" name="external_phone" 
                                               value="" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–Ω–µ—à–Ω–∏–π –Ω–æ–º–µ—Ä" required 
                                               title="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ E.164 (–Ω–∞–ø—Ä–∏–º–µ—Ä: +375296254070)"
                                               style="font-size: 18px; padding: 12px 15px; height: 50px; width: 100%; max-width: none; min-width: 500px; box-sizing: border-box;">
                                    </div>
                                    
                                    <!-- –ë—ã—Å—Ç—Ä—ã–µ —Ñ–ª–∞–≥–∏ —Å—Ç—Ä–∞–Ω -->
                                    <div class="mt-3">
                                        <small class="text-muted">–ë—ã—Å—Ç—Ä–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤:</small>
                                        <div class="d-flex flex-wrap gap-2 mt-2" id="countryFlags">
                                            <button type="button" class="country-flag" data-country="by" title="–ë–µ–ª–∞—Ä—É—Å—å" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üáßüáæ</button>
                                            <button type="button" class="country-flag" data-country="ru" title="–†–æ—Å—Å–∏—è" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá∑üá∫</button>
                                            <button type="button" class="country-flag" data-country="pl" title="–ü–æ–ª—å—à–∞" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üáµüá±</button>
                                            <button type="button" class="country-flag" data-country="lt" title="–õ–∏—Ç–≤–∞" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá±üáπ</button>
                                            <button type="button" class="country-flag" data-country="lv" title="–õ–∞—Ç–≤–∏—è" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá±üáª</button>
                                            <button type="button" class="country-flag" data-country="us" title="–°–®–ê" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá∫üá∏</button>
                                            <button type="button" class="country-flag" data-country="ee" title="–≠—Å—Ç–æ–Ω–∏—è" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá™üá™</button>
                                            <button type="button" class="country-flag" data-country="jp" title="–Ø–ø–æ–Ω–∏—è" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üáØüáµ</button>
                                            <button type="button" class="country-flag" data-country="fr" title="–§—Ä–∞–Ω—Ü–∏—è" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá´üá∑</button>
                                            <button type="button" class="country-flag" data-country="it" title="–ò—Ç–∞–ª–∏—è" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üáÆüáπ</button>
                                            <button type="button" class="country-flag" data-country="es" title="–ò—Å–ø–∞–Ω–∏—è" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá™üá∏</button>
                                            <button type="button" class="country-flag" data-country="md" title="–ú–æ–ª–¥–æ–≤–∞" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá≤üá©</button>
                                            <button type="button" class="country-flag" data-country="kz" title="–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá∞üáø</button>
                                            <button type="button" class="country-flag" data-country="ar" title="–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá¶üá∑</button>
                                            <button type="button" class="country-flag" data-country="am" title="–ê—Ä–º–µ–Ω–∏—è" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá¶üá≤</button>
                                            <button type="button" class="country-flag" data-country="ge" title="–ì—Ä—É–∑–∏—è" style="border: none; background: transparent; padding: 2px; font-size: 32px; cursor: pointer; border-radius: 4px;">üá¨üá™</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
                            <div class="col-md-6" data-field="duration">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-clock"></i> –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω)
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-hourglass-half"></i>
                                        <input type="number" class="form-control" name="duration_minutes" 
                                               value="3" min="1" max="60" required>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- –ú–µ–Ω–µ–¥–∂–µ—Ä -->
                            <div class="col-md-6" data-field="manager">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-user"></i> –ú–µ–Ω–µ–¥–∂–µ—Ä
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-headset"></i>
                                        <select class="form-select" name="internal_phone" id="internal_phone" required>
                                            {% for manager in managers %}
                                            <option value="{{ manager.phone }}">{{ manager.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- –õ–∏–Ω–∏—è -->
                            <div class="col-md-6" data-field="line">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-signal"></i> –õ–∏–Ω–∏—è
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-broadcast-tower"></i>
                                        <select class="form-select" name="line_id" id="line_id" required>
                                            {% for line in lines %}
                                            <option value="{{ line.id }}">{{ line.id }} - {{ line.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- –í—Ç–æ—Ä–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä -->
                            <div class="col-md-6" data-field="second_manager">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-user-plus"></i> –í—Ç–æ—Ä–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä (–∫–æ–º—É)
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-headset"></i>
                                        <select class="form-select" name="second_internal_phone">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                            {% for manager in managers %}
                                            <option value="{{ manager.phone }}">{{ manager.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- –†–µ–∑–µ—Ä–≤–Ω–∞—è –ª–∏–Ω–∏—è -->
                            <div class="col-md-6" data-field="backup_line">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-sync-alt"></i> –†–µ–∑–µ—Ä–≤–Ω–∞—è –ª–∏–Ω–∏—è
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-broadcast-tower"></i>
                                        <select class="form-select" name="backup_line_id">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –ª–∏–Ω–∏—é</option>
                                            {% for line in lines %}
                                            <option value="{{ line.id }}">{{ line.id }} - {{ line.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- –ì—Ä—É–ø–ø–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ (2-1 –∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ) -->
                            <div class="col-md-6" data-field="internal_group_1">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-users"></i> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä 1 (–≥—Ä—É–ø–ø–∞)
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-phone"></i>
                                        <select class="form-select" name="internal_group_1" id="internal_group_1">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–≤—ã–π –Ω–æ–º–µ—Ä –≥—Ä—É–ø–ø—ã</option>
                                            {% for manager in managers %}
                                            <option value="{{ manager.phone }}">{{ manager.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6" data-field="internal_group_2">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-users"></i> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä 2 (–≥—Ä—É–ø–ø–∞)
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-phone"></i>
                                        <select class="form-select" name="internal_group_2" id="internal_group_2">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Ç–æ—Ä–æ–π –Ω–æ–º–µ—Ä –≥—Ä—É–ø–ø—ã</option>
                                            {% for manager in managers %}
                                            <option value="{{ manager.phone }}">{{ manager.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6" data-field="internal_group_3">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-users"></i> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä 3 (–≥—Ä—É–ø–ø–∞)
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-phone"></i>
                                        <select class="form-select" name="internal_group_3" id="internal_group_3">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ—Ç–∏–π –Ω–æ–º–µ—Ä –≥—Ä—É–ø–ø—ã</option>
                                            {% for manager in managers %}
                                            <option value="{{ manager.phone }}">{{ manager.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6" data-field="internal_group_4">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-users"></i> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä 4 (–≥—Ä—É–ø–ø–∞)
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-phone"></i>
                                        <select class="form-select" name="internal_group_4" id="internal_group_4">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —á–µ—Ç–≤–µ—Ä—Ç—ã–π –Ω–æ–º–µ—Ä –≥—Ä—É–ø–ø—ã</option>
                                            {% for manager in managers %}
                                            <option value="{{ manager.phone }}">{{ manager.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- –ù–∞ –∫–æ–≥–æ –ø–µ—Ä–µ–≤–µ–ª–∏ -->
                            <div class="col-md-6" data-field="transfer_to_manager">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-share"></i> –ù–∞ –∫–æ–≥–æ –ø–µ—Ä–µ–≤–µ–ª–∏
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-user-friends"></i>
                                        <select class="form-select" name="transfer_to_manager" id="transfer_to_manager">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞</option>
                                            {% for manager in managers %}
                                            <option value="{{ manager.phone }}">{{ manager.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- –ú–µ–Ω–µ–¥–∂–µ—Ä —Å –º–æ–±–∏–ª—å–Ω—ã–º -->
                            <div class="col-md-6" data-field="mobile_manager">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-mobile-alt"></i> –ú–µ–Ω–µ–¥–∂–µ—Ä —Å –º–æ–±–∏–ª—å–Ω—ã–º
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-phone-volume"></i>
                                        <select class="form-select" name="mobile_manager" id="mobile_manager">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å –º–æ–±–∏–ª—å–Ω—ã–º</option>
                                            {% for manager in managers %}
                                            <option value="{{ manager.phone }}" data-mobile="{{ manager.personal_phone or '' }}">{{ manager.clean_name }}{% if manager.personal_phone %} ({{ manager.personal_phone }}){% endif %}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- –ò—Å—Ö–æ–¥—è—â–∞—è –ª–∏–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ -->
                            <div class="col-md-6" data-field="mobile_outgoing_line">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-phone-square"></i> –ò—Å—Ö–æ–¥—è—â–∞—è –ª–∏–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-share-square"></i>
                                        <select class="form-select" name="mobile_outgoing_line" id="mobile_outgoing_line">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ö–æ–¥—è—â—É—é –ª–∏–Ω–∏—é</option>
                                            {% for line in lines %}
                                            <option value="{{ line.id }}">{{ line.id }} - {{ line.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
                            <div class="col-md-6" data-field="forbidden_direction">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-ban"></i> –ó–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        <select class="form-select" name="forbidden_direction">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</option>
                                            <option value="+7">+7 (–†–æ—Å—Å–∏—è)</option>
                                            <option value="+1">+1 (–°–®–ê/–ö–∞–Ω–∞–¥–∞)</option>
                                            <option value="+49">+49 (–ì–µ—Ä–º–∞–Ω–∏—è)</option>
                                            <option value="+33">+33 (–§—Ä–∞–Ω—Ü–∏—è)</option>
                                            <option value="+44">+44 (–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è)</option>
                                            <option value="+380">+380 (–£–∫—Ä–∞–∏–Ω–∞)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
                            <div class="col-md-6" data-field="greeting">
                                <div class="form-group">
                                    <label class="form-label fw-bold">
                                        <i class="fas fa-volume-up"></i> –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                                    </label>
                                    <div class="icon-input">
                                        <i class="fas fa-play-circle"></i>
                                        <select class="form-select" name="greeting">
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</option>
                                            <option value="main">–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</option>
                                            <option value="day">–î–Ω–µ–≤–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</option>
                                            <option value="night">–ù–æ—á–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</option>
                                            <option value="holiday">–ü—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ</option>
                                            <option value="custom1">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ 1</option>
                                            <option value="custom2">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ 2</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–ª—è –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ (—Ç–∏–ø 2-18) -->
                        <div class="card mt-3" data-field="simple_internal_group">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="fas fa-users"></i> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–æ–º–µ—Ä–∞</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4" data-field="simple_internal_1">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä 1</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="simple_internal_1" id="simple_internal_1">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4" data-field="simple_internal_2">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä 2</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="simple_internal_2" id="simple_internal_2">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4" data-field="simple_internal_3">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä 3</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="simple_internal_3" id="simple_internal_3">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–ª—è –¥–ª—è 2 –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ (—Ç–∏–ø—ã 2-19 –¥–æ 2-22) -->
                        <div class="card mt-3" data-field="simple_internal_2_group">
                            <div class="card-header bg-secondary text-white">
                                <h6 class="mb-0"><i class="fas fa-users"></i> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ (2 –º–µ–Ω–µ–¥–∂–µ—Ä–∞)</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6" data-field="simple_internal_2_1">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä 1 (–∫—Ç–æ –ø—Ä–∏–Ω—è–ª)</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="simple_internal_2_1" id="simple_internal_2_1">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" data-field="simple_internal_2_2">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä 2 (–∫—É–¥–∞ –ø–µ—Ä–µ–≤–µ–ª–∏)</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="simple_internal_2_2" id="simple_internal_2_2">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Follow Me —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—Ç–∏–ø—ã 2-23, 2-24) -->
                        <div class="card mt-3" data-field="follow_me_group">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0"><i class="fas fa-phone-alt"></i> Follow Me –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6" data-field="follow_me_internal">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω (–∫—Ç–æ –ø—Ä–∏–Ω—è–ª)</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="follow_me_internal" id="follow_me_internal">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" data-field="follow_me_manager">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–ú–µ–Ω–µ–¥–∂–µ—Ä —Å –≤–Ω–µ—à–Ω–∏–º –Ω–æ–º–µ—Ä–æ–º</label>
                                            <div class="icon-input">
                                                <i class="fas fa-mobile-alt"></i>
                                                <select class="form-select" name="follow_me_manager" id="follow_me_manager" data-mobile="true">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å –º–æ–±–∏–ª—å–Ω—ã–º</option>
                                                    {% for manager in managers %}
                                                    {% if manager.personal_phone %}
                                                    <option value="{{ manager.phone }}" data-mobile="{{ manager.personal_phone }}">{{ manager.phone }} - {{ manager.name }} ({{ manager.personal_phone }})</option>
                                                    {% endif %}
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-6" data-field="follow_me_external_line">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–í–Ω–µ—à–Ω—è—è –ª–∏–Ω–∏—è (–¥–ª—è –∑–≤–æ–Ω–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã–π)</label>
                                            <div class="icon-input">
                                                <i class="fas fa-phone"></i>
                                                <select class="form-select" name="follow_me_external_line" id="follow_me_external_line">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–Ω–µ—à–Ω—é—é –ª–∏–Ω–∏—é</option>
                                                    {% for line in lines %}
                                                    <option value="{{ line.phone }}">{{ line.phone }} - {{ line.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–≤–æ–Ω–∫–∏ (—Ç–∏–ø—ã 3-1, 3-2) -->
                        <div class="card mt-3" data-field="internal_call_group">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-phone-alt"></i> –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∑–≤–æ–Ω–æ–∫</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6" data-field="internal_caller">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–ö—Ç–æ –∑–≤–æ–Ω–∏—Ç (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä)</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="internal_caller" id="internal_caller">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" data-field="internal_callee">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–ö–æ–º—É –∑–≤–æ–Ω—è—Ç (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä)</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="internal_callee" id="internal_callee">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ó–≤–æ–Ω–∫–∏ –Ω–∞ –æ—Ç–¥–µ–ª (—Ç–∏–ø—ã 3-3, 3-4) -->
                        <div class="card mt-3" data-field="department_call_group">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="fas fa-users"></i> –ó–≤–æ–Ω–æ–∫ –Ω–∞ –æ—Ç–¥–µ–ª</h6>
                            </div>
                            <div class="card-body">
                                <!-- –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä –∑–≤–æ–Ω–∫–∞ -->
                                <div class="row">
                                    <div class="col-md-6" data-field="department_caller">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–ö—Ç–æ –∑–≤–æ–Ω–∏—Ç (–∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä)</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="department_caller" id="department_caller">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- –û—Ç–¥–µ–ª (4 –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ª–∏–Ω–∏–∏) -->
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <hr>
                                        <h6 class="text-primary"><i class="fas fa-building"></i> –û—Ç–¥–µ–ª (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ª–∏–Ω–∏–∏)</h6>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3" data-field="department_member_1">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–ß–ª–µ–Ω –æ—Ç–¥–µ–ª–∞ 1</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="department_member_1" id="department_member_1">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="department_member_2">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–ß–ª–µ–Ω –æ—Ç–¥–µ–ª–∞ 2</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="department_member_2" id="department_member_2">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="department_member_3">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–ß–ª–µ–Ω –æ—Ç–¥–µ–ª–∞ 3</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="department_member_3" id="department_member_3">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="department_member_4">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">–ß–ª–µ–Ω –æ—Ç–¥–µ–ª–∞ 4</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="department_member_4" id="department_member_4">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ü–æ—ç—Ç–∞–ø–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è —Ç–∏–ø–∞ 2-12 -->
                        <div class="card mt-3" data-field="step1_group">
                            <div class="card-header bg-primary text-white">
                                <h6 class="mb-0"><i class="fas fa-step-forward"></i> –®–∞–≥ 1: –ü–µ—Ä–≤—ã–π –∑–≤–æ–Ω–æ–∫</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3" data-field="step1_manager_1">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 1</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step1_manager_1" id="step1_manager_1">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="step1_manager_2">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 2</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step1_manager_2" id="step1_manager_2">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="step1_manager_3">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 3</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step1_manager_3" id="step1_manager_3">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="step1_manager_4">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 4</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step1_manager_4" id="step1_manager_4">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-3" data-field="step2_group">
                            <div class="card-header bg-info text-white">
                                <h6 class="mb-0"><i class="fas fa-step-forward"></i> –®–∞–≥ 2: –î–æ–±–∞–≤–∏–ª–∏ –µ—â–µ –∞–±–æ–Ω–µ–Ω—Ç–æ–≤</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3" data-field="step2_manager_1">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 1</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step2_manager_1" id="step2_manager_1">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="step2_manager_2">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 2</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step2_manager_2" id="step2_manager_2">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="step2_manager_3">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 3</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step2_manager_3" id="step2_manager_3">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="step2_manager_4">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 4</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step2_manager_4" id="step2_manager_4">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card mt-3" data-field="step3_group">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-step-forward"></i> –®–∞–≥ 3: –§–∏–Ω–∞–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3" data-field="step3_manager_1">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 1</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step3_manager_1" id="step3_manager_1">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="step3_manager_2">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 2</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step3_manager_2" id="step3_manager_2">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="step3_manager_3">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 3</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step3_manager_3" id="step3_manager_3">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3" data-field="step3_manager_4">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä 4</label>
                                            <div class="icon-input">
                                                <i class="fas fa-user"></i>
                                                <select class="form-select" name="step3_manager_4" id="step3_manager_4">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Ç–∏–ø–∞ 2-13: –º–æ–±–∏–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä -->
                                <div class="row mt-3" data-field="step3_mobile_section">
                                    <div class="col-12">
                                        <hr>
                                        <h6 class="text-success"><i class="fas fa-mobile-alt"></i> –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ú–æ–±–∏–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä</h6>
                                    </div>
                                </div>
                                <div class="row" data-field="step3_mobile_section">
                                    <div class="col-md-6" data-field="step3_mobile_manager">
                                        <div class="form-group">
                                            <label class="form-label">–ú–µ–Ω–µ–¥–∂–µ—Ä —Å –º–æ–±–∏–ª—å–Ω—ã–º</label>
                                            <div class="icon-input">
                                                <i class="fas fa-mobile-alt"></i>
                                                <select class="form-select" name="step3_mobile_manager" id="step3_mobile_manager">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å –º–æ–±–∏–ª—å–Ω—ã–º</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}" data-mobile="{{ manager.personal_phone or '' }}">{{ manager.clean_name }}{% if manager.personal_phone %} ({{ manager.personal_phone }}){% endif %}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6" data-field="step3_mobile_line">
                                        <div class="form-group">
                                            <label class="form-label">–õ–∏–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ</label>
                                            <div class="icon-input">
                                                <i class="fas fa-phone-square"></i>
                                                <select class="form-select" name="step3_mobile_line" id="step3_mobile_line">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏–Ω–∏—é –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ</option>
                                                    {% for line in lines %}
                                                    <option value="{{ line.id }}">{{ line.id }} - {{ line.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –∫—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª -->
                        <div class="card mt-4" data-field="answered_manager_final">
                            <div class="card-header bg-warning text-dark">
                                <h6 class="mb-0"><i class="fas fa-phone-volume"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–≤–æ–Ω–∫–∞</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6" data-field="answered_manager">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">
                                                <i class="fas fa-user-check"></i> –ö—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª –≤ –∏—Ç–æ–≥–µ
                                            </label>
                                            <div class="icon-input">
                                                <i class="fas fa-phone-volume"></i>
                                                <select class="form-select" name="answered_manager" id="answered_manager">
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª –≤ –∏—Ç–æ–≥–µ</option>
                                                    {% for manager in managers %}
                                                    <option value="{{ manager.phone }}">{{ manager.phone }} - {{ manager.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ -->
                        <div class="card mt-4" data-field="answered_manager_final_mobile">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0"><i class="fas fa-mobile-alt"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–≤–æ–Ω–∫–∞ - –º–æ–±–∏–ª—å–Ω—ã–π</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-8">
                                        <div class="form-group">
                                            <label class="form-label fw-bold">
                                                <i class="fas fa-user-check"></i> –ö—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º
                                            </label>
                                            <div class="alert alert-success mt-2" id="mobile_answer_display">
                                                <i class="fas fa-mobile-alt me-2"></i>
                                                <span id="mobile_answer_text">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ –®–∞–≥–µ 3</span>
                                            </div>
                                            <!-- –°–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö -->
                                            <input type="hidden" name="answered_manager" id="answered_manager_mobile" value="">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç–º—É–ª—è—Ç–æ—Ä–æ–º -->
                        <div class="text-center mt-4">
                            <div class="btn-group me-3" role="group">
                                <button type="button" id="autoEmulateBtn" class="btn btn-primary btn-lg" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">
                                    <i class="fas fa-play"></i> –ê–≤—Ç–æ
                                </button>
                                <button type="button" id="manualEmulateBtn" class="btn btn-warning btn-lg" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border: none; box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);">
                                    <i class="fas fa-step-forward"></i> –†—É—á–Ω–∞—è
                                </button>
                                <button type="button" id="resetEmulateBtn" class="btn btn-secondary btn-lg" style="background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%); border: none; box-shadow: 0 4px 15px rgba(116, 185, 255, 0.4);">
                                    <i class="fas fa-undo"></i> –°–±—Ä–æ—Å
                                </button>
                            </div>
                            <button type="button" class="btn btn-success btn-lg" onclick="previewTelegram()">
                                <i class="fab fa-telegram"></i> –ü—Ä–µ–≤—å—é Telegram
                            </button>
                        </div>

                        <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏—è —ç–º—É–ª—è—Ç–æ—Ä–∞ -->
                        <div class="text-center mt-3">
                            <div id="emulatorStatus" class="alert alert-info" style="display: none;">
                                <i class="fas fa-info-circle"></i> <span id="statusText">–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ</span>
                            </div>
                        </div>
                    </form>

                    <!-- –û–±–ª–∞—Å—Ç—å —Å–æ–±—ã—Ç–∏–π —ç–º—É–ª—è—Ç–æ—Ä–∞ - –ø–æ–¥ —Ñ–æ—Ä–º–æ–π -->
                    <div id="eventsPanel" style="display: none; margin-top: 20px;">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="fas fa-list"></i> –°–æ–±—ã—Ç–∏—è —ç–º—É–ª—è—Ü–∏–∏</h5>
                                <div id="eventsLog" style="background: #ffffff; color: #000000; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; font-size: 16px; padding: 20px; min-height: 400px; border: 1px solid #e9ecef; border-radius: 8px;">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

                    <!-- –ü–∞–Ω–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
                    <div class="result-panel" id="resultPanel">
                        <h5><i class="fas fa-chart-line"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h5>
                        <div id="resultContent">
                            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–µ–≤—å—é -->
    <div class="modal fade" id="telegramModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fab fa-telegram"></i> –ü—Ä–µ–≤—å—é Telegram —Å–æ–æ–±—â–µ–Ω–∏—è
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="telegram-preview" id="telegramPreview">
                        <!-- –ü—Ä–µ–≤—å—é –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –î–∞–Ω–Ω—ã–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞
        const managers = {{ managers|tojson }};
        const lines = {{ lines|tojson }};
        const callTypes = {{ call_types|tojson }};
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–∏–ø–∞ –∑–≤–æ–Ω–∫–∞
        function updateCallTypeDescription(callTypeId) {
            const descriptionDiv = document.getElementById('call-type-description');
            const callType = callTypes.find(ct => ct.id == callTypeId);
            
            if (callType) {
                const description = callType.description.replace(/\\n/g, '<br>');
                descriptionDiv.innerHTML = `
                    <h6 class="fw-bold text-primary">
                        <i class="fas fa-phone"></i> ${callType.name}
                    </h6>
                    <div class="mt-3" style="line-height: 1.6; font-size: 0.95em;">
                        ${description}
                    </div>
                `;
            } else {
                descriptionDiv.innerHTML = `
                    <p class="text-muted text-center" style="margin-top: 100px;">
                        <i class="fas fa-arrow-right fa-2x"></i><br><br>
                        –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–≤–æ–Ω–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–ø–∏—Å–∞–Ω–∏—è
                    </p>
                `;
            }
        }
        
        // –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–≤–æ–Ω–∫–∞
        const callTypeFieldMapping = {
            "1": {
                fields: ["external_phone", "manager", "line"],
                required: ["external_phone", "manager", "line"],
                description: "–ü—Ä—è–º–æ–π –Ω–∞–±–æ—Ä –Ω–æ–º–µ—Ä–∞ - –∞–±–æ–Ω–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "2": {
                fields: ["external_phone", "manager", "line"],
                required: ["external_phone", "manager", "line"],
                description: "–ù–∞–±–æ—Ä –Ω–æ–º–µ—Ä–∞ —Å –≤–Ω–µ—à–Ω–µ–π –∏–Ω–∏—Ü–∏–∞—Ü–∏–µ–π (–∏–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã, CRM) - –∑–≤–æ–Ω–æ–∫ –æ—Ç–≤–µ—á–µ–Ω",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "3": {
                fields: ["external_phone", "manager", "line", "second_manager"],
                required: ["external_phone", "manager", "line", "second_manager"],
                description: "–ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º - –≤—ã–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º - —Ä–∞–∑–≥–æ–≤–æ—Ä –æ—Ç–∫–ª–æ–Ω–µ–Ω",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "4": {
                fields: ["external_phone", "manager", "line", "second_manager"],
                required: ["external_phone", "manager", "line", "second_manager"],
                description: "–ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º - –≤—ã–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º - –æ–Ω —Å–æ–≥–ª–∞—Å–∏–ª—Å—è –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "5": {
                fields: ["external_phone", "manager", "line", "second_manager"],
                required: ["external_phone", "manager", "line", "second_manager"],
                description: "–ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º - –≤—ã–∑–æ–≤ –Ω–µ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º (–Ω–µ—Ç –Ω–∞ –º–µ—Å—Ç–µ)",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "6": {
                fields: ["external_phone", "manager", "line", "second_manager"],
                required: ["external_phone", "manager", "line", "second_manager"],
                description: "–ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ - –≤—ã–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "7": {
                fields: ["external_phone", "manager", "line", "second_manager"],
                required: ["external_phone", "manager", "line", "second_manager"],
                description: "–ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ - –≤—ã–∑–æ–≤ –Ω–µ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "8": {
                fields: ["external_phone", "manager", "line"],
                required: ["external_phone", "manager", "line"],
                description: "–ü—Ä—è–º–æ–π –Ω–∞–±–æ—Ä –Ω–æ–º–µ—Ä–∞ - –∞–±–æ–Ω–µ–Ω—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª",
                defaultDuration: 3,
                defaultResult: "noanswer"
            },
            "9": {
                fields: ["external_phone", "manager", "line", "backup_line"],
                required: ["external_phone", "manager", "line", "backup_line"],
                description: "–ü—Ä—è–º–æ–π –Ω–∞–±–æ—Ä –Ω–æ–º–µ—Ä–∞ - 151 –∑–≤–æ–Ω–∏—Ç –∞–±–æ–Ω–µ–Ω—Ç—É +375296254070, —Å–∏—Å—Ç–µ–º–∞ —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –¥–∏–∞–ª–ø–ª–∞–Ω—É –Ω–∞–±—Ä–∞—Ç—å –Ω–æ–º–µ—Ä —Å –ª–∏–Ω–∏–∏ 0001363, –Ω–æ –æ–Ω–∞ –æ–∫–∞–∑–∞–ª–∞—Å—å –∑–∞–Ω—è—Ç–∞ –¥—Ä—É–≥–∏–º —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–º, –∏ –∑–≤–æ–Ω–æ–∫ —Å–æ–≥–ª–∞—Å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ—à–µ–ª —Å —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –ª–∏–Ω–∏–∏ 0001366, —Ç—Ä—É–±–∫—É –ø–æ–¥–Ω—è–ª–∏",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "10": {
                fields: ["external_phone", "manager", "line"],
                required: ["external_phone", "manager", "line"],
                description: "–ü—Ä—è–º–æ–π –Ω–∞–±–æ—Ä –Ω–æ–º–µ—Ä–∞ - 151 –∑–≤–æ–Ω–∏—Ç –∞–±–æ–Ω–µ–Ω—Ç—É +375296254070, —Å–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ –¥–∏–∞–ª–ø–ª–∞–Ω—É —Å–¥–µ–ª–∞—Ç—å –∑–≤–æ–Ω–æ–∫ —Å –ª–∏–Ω–∏–∏ 0001363, –Ω–æ –æ–Ω–∞ –∑–∞–Ω—è—Ç–∞ –¥—Ä—É–≥–∏–º —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–º, –∞ –∏–Ω—ã—Ö —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –ª–∏–Ω–∏–π –¥–ª—è –∞–±–æ–Ω–µ–Ω—Ç–∞ 151 –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–æ, –∏ –∑–≤–æ–Ω–æ–∫ –ø—Ä–µ—Ä–≤–∞–ª—Å—è",
                defaultDuration: 3,
                defaultResult: "cancelled"
            },
            "11": {
                fields: ["external_phone", "manager", "forbidden_direction"],
                required: ["external_phone", "manager", "forbidden_direction"],
                description: "151-–π –∞–±–æ–Ω–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –≤—ã–∑–æ–≤ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é (+7), –∫—É–¥–∞ –≤—ã–∑–æ–≤—ã –µ–º—É –∑–∞–ø—Ä–µ—â–µ–Ω—ã (–µ–º—É —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ +375), –∏ –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–∫–∞–∑ –≤ –Ω–∞–±–æ—Ä–µ –Ω–æ–º–µ—Ä–∞ +74957776644",
                defaultDuration: 3,
                defaultResult: "forbidden"
            },
            "12": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "answered_manager"],
                required: ["external_phone", "line", "internal_group_1", "answered_manager"],
                description: "–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –Ω–∞–±–æ—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ - –æ—Ç–≤–µ—Ç",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "13": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4"],
                required: ["external_phone", "line", "internal_group_1"],
                description: "–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è, –Ω–∞–±–æ—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ - –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞",
                defaultDuration: 3,
                defaultResult: "noanswer"
            },
            "14": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "answered_manager"],
                required: ["external_phone", "line", "internal_group_1", "answered_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ –±–µ–∑ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è - –Ω–∞–±–æ—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ - –æ—Ç–≤–µ—Ç",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "15": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4"],
                required: ["external_phone", "line", "internal_group_1"],
                description: "–ó–≤–æ–Ω–æ–∫ –±–µ–∑ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è - –Ω–∞–±–æ—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ - –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞",
                defaultDuration: 3,
                defaultResult: "noanswer"
            },
            "16": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "mobile_manager", "mobile_outgoing_line"],
                required: ["external_phone", "line", "internal_group_1", "mobile_manager", "mobile_outgoing_line"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –≥—Ä—É–ø–ø—É –∞–±–æ–Ω–µ–Ω—Ç–æ–≤ + –º–æ–±–∏–ª—å–Ω—ã–π = –ø–æ–¥–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "17": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "answered_manager", "mobile_manager", "mobile_outgoing_line"],
                required: ["external_phone", "line", "internal_group_1", "answered_manager", "mobile_manager", "mobile_outgoing_line"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –≥—Ä—É–ø–ø—É –∞–±–æ–Ω–µ–Ω—Ç–æ–≤ + –º–æ–±–∏–ª—å–Ω—ã–π = –ø–æ–¥–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "18": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "answered_manager", "transfer_to_manager"],
                required: ["external_phone", "line", "internal_group_1", "answered_manager", "transfer_to_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –≥—Ä—É–ø–ø—É –∞–±–æ–Ω–µ–Ω—Ç–æ–≤ - –ø–æ–¥–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É - –ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º - –≤—ã–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º - —Ä–∞–∑–≥–æ–≤–æ—Ä –æ—Ç–∫–ª–æ–Ω–µ–Ω",
                defaultDuration: 3,
                defaultResult: "rejected"
            },
            "19": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "answered_manager", "transfer_to_manager"],
                required: ["external_phone", "line", "internal_group_1", "answered_manager", "transfer_to_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –≥—Ä—É–ø–ø—É –∞–±–æ–Ω–µ–Ω—Ç–æ–≤ - –ø–æ–¥–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É - –ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º - –≤—ã–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º - —Ä–∞–∑–≥–æ–≤–æ—Ä —Å–æ—Å—Ç–æ—è–ª—Å—è",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "20": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "answered_manager", "transfer_to_manager"],
                required: ["external_phone", "line", "internal_group_1", "answered_manager", "transfer_to_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –≥—Ä—É–ø–ø—É –∞–±–æ–Ω–µ–Ω—Ç–æ–≤ - –ø–æ–¥–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É - –ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ —Å –∑–∞–ø—Ä–æ—Å–æ–º - –≤—ã–∑–æ–≤ –Ω–µ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º (–Ω–µ—Ç –Ω–∞ –º–µ—Å—Ç–µ)",
                defaultDuration: 2,
                defaultResult: "no_answer"
            },
            "21": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "answered_manager", "transfer_to_manager"],
                required: ["external_phone", "line", "internal_group_1", "answered_manager", "transfer_to_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –≥—Ä—É–ø–ø—É –∞–±–æ–Ω–µ–Ω—Ç–æ–≤ - –ø–æ–¥–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É - –ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ - –≤—ã–∑–æ–≤ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "22": {
                fields: ["external_phone", "line", "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "answered_manager", "transfer_to_manager"],
                required: ["external_phone", "line", "internal_group_1", "answered_manager", "transfer_to_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –≥—Ä—É–ø–ø—É –∞–±–æ–Ω–µ–Ω—Ç–æ–≤ - –ø–æ–¥–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É - –ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ - –≤—ã–∑–æ–≤ –Ω–µ –ø—Ä–∏–Ω—è—Ç –¥—Ä—É–≥–∏–º –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º",
                defaultDuration: 2,
                defaultResult: "no_answer"
            },
            "23": {
                fields: ["external_phone", "line", "step1_group", "step2_group", "step3_group", "step1_manager_1", "step1_manager_2", "step1_manager_3", "step1_manager_4", "step2_manager_1", "step2_manager_2", "step2_manager_3", "step2_manager_4", "step3_manager_1", "step3_manager_2", "step3_manager_3", "step3_manager_4", "answered_manager_final", "answered_manager"],
                required: ["external_phone", "line", "step1_manager_1", "answered_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –æ–¥–Ω–æ–≥–æ –∞–±–æ–Ω–µ–Ω—Ç–∞, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–ª—Å—è –µ—â–µ –æ–¥–∏–Ω –∞–±–æ–Ω–µ–Ω—Ç - —Ç—Ä—É–±–∫—É –ø–æ–¥–Ω—è–ª–∏",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "24": {
                fields: ["external_phone", "line", "step1_group", "step2_group", "step3_group", "step1_manager_1", "step1_manager_2", "step1_manager_3", "step1_manager_4", "step2_manager_1", "step2_manager_2", "step2_manager_3", "step2_manager_4", "step3_manager_1", "step3_manager_2", "step3_manager_3", "step3_manager_4", "step3_mobile_section", "step3_mobile_manager", "step3_mobile_line", "answered_manager_final", "answered_manager"],
                required: ["external_phone", "line", "step1_manager_1", "answered_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –æ–¥–Ω–æ–≥–æ –∞–±–æ–Ω–µ–Ω—Ç–∞, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–ª—Å—è –µ—â–µ –æ–¥–∏–Ω –∞–±–æ–Ω–µ–Ω—Ç, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–ª—Å—è –º–æ–±–∏–ª—å–Ω–∏–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ - —Ç—Ä—É–±–∫—É –ø–æ–¥–Ω—è–ª–∏ –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "25": {
                fields: ["external_phone", "line", "step1_group", "step2_group", "step3_group", "step1_manager_1", "step1_manager_2", "step1_manager_3", "step1_manager_4", "step2_manager_1", "step2_manager_2", "step2_manager_3", "step2_manager_4", "step3_manager_1", "step3_manager_2", "step3_manager_3", "step3_manager_4", "step3_mobile_section", "step3_mobile_manager", "step3_mobile_line", "answered_manager_final_mobile"],
                required: ["external_phone", "line", "step1_manager_1", "step3_mobile_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –æ–¥–Ω–æ–≥–æ –∞–±–æ–Ω–µ–Ω—Ç–∞, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–ª—Å—è –µ—â–µ –æ–¥–∏–Ω –∞–±–æ–Ω–µ–Ω—Ç, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–ª—Å—è –º–æ–±–∏–ª—å–Ω–∏–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ - —Ç—Ä—É–±–∫—É –ø–æ–¥–Ω—è–ª–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "26": {
                fields: ["external_phone", "line", "step1_group", "step2_group", "step3_group", "step1_manager_1", "step1_manager_2", "step1_manager_3", "step1_manager_4", "step2_manager_1", "step2_manager_2", "step2_manager_3", "step2_manager_4", "step3_manager_1", "step3_manager_2", "step3_manager_3", "step3_manager_4", "step3_mobile_section", "step3_mobile_manager", "step3_mobile_line"],
                required: ["external_phone", "line", "step1_manager_1"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –æ–¥–Ω–æ–≥–æ –∞–±–æ–Ω–µ–Ω—Ç–∞, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–ª—Å—è –µ—â–µ –æ–¥–∏–Ω –∞–±–æ–Ω–µ–Ω—Ç, –ø–æ—Ç–æ–º –¥–æ–±–∞–≤–∏–ª—Å—è –º–æ–±–∏–ª—å–Ω–∏–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ - —Ç—Ä—É–±–∫—É –Ω–µ –ø–æ–¥–Ω—è–ª–∏ –Ω–∏–≥–¥–µ",
                defaultDuration: 2,
                defaultResult: "no_answer"
            },
            "27": {
                fields: ["external_phone", "line", "step1_group", "step2_group", "step3_group", "step1_manager_1", "step1_manager_2", "step1_manager_3", "step1_manager_4", "step2_manager_1", "step2_manager_2", "step2_manager_3", "step2_manager_4", "step3_manager_1", "step3_manager_2", "step3_manager_3", "step3_manager_4", "step3_mobile_section", "step3_mobile_manager", "step3_mobile_line", "answered_manager_final", "answered_manager"],
                required: ["external_phone", "line", "step1_manager_1", "answered_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ - –∑–≤–æ–Ω–æ–∫ –Ω–∞ –æ–¥–Ω–æ–≥–æ - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ - –∑–≤–æ–Ω–æ–∫ –Ω–∞ –¥–≤—É—Ö - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ - –∑–≤–æ–Ω–æ–∫ –Ω–∞ 2-—Ö + –º–æ–±–∏–ª—å–Ω—ã–π - –æ—Ç–≤–µ—Ç –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "28": {
                fields: ["external_phone", "line", "step1_group", "step2_group", "step3_group", "step1_manager_1", "step1_manager_2", "step1_manager_3", "step1_manager_4", "step2_manager_1", "step2_manager_2", "step2_manager_3", "step2_manager_4", "step3_manager_1", "step3_manager_2", "step3_manager_3", "step3_manager_4", "step3_mobile_section", "step3_mobile_manager", "step3_mobile_line", "answered_manager_final_mobile"],
                required: ["external_phone", "line", "step1_manager_1", "step3_mobile_manager"],
                description: "–ó–≤–æ–Ω–æ–∫ - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ - –∑–≤–æ–Ω–æ–∫ –Ω–∞ –æ–¥–Ω–æ–≥–æ - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ - –∑–≤–æ–Ω–æ–∫ –Ω–∞ –¥–≤—É—Ö - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ - –∑–≤–æ–Ω–æ–∫ –Ω–∞ 2-—Ö + –º–æ–±–∏–ª—å–Ω—ã–π - –æ—Ç–≤–µ—Ç –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "29": {
                fields: ["external_phone", "line", "simple_internal_group", "simple_internal_1", "simple_internal_2", "simple_internal_3"],
                required: ["external_phone", "line", "simple_internal_1", "simple_internal_2", "simple_internal_3"],
                description: "–í–Ω–µ—à–Ω–∏–π –∑–≤–æ–Ω–æ–∫ ‚Üí –æ—Ç–≤–µ—á–∞–µ—Ç 151-–π 2. 151 –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –Ω–∞ 152-–≥–æ (—Å –∑–∞–ø—Ä–æ—Å–æ–º) 3. 152 –ø—Ä–∏–Ω–∏–º–∞–µ—Ç, –Ω–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –¥–∞–ª—å—à–µ –Ω–∞ 150-–≥–æ 4. 150 —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–µ—Ç —Å –∫–ª–∏–µ–Ω—Ç–æ–º",
                defaultDuration: 4,
                defaultResult: "answered"
            },
            "30": {
                fields: ["external_phone", "line", "simple_internal_2_group", "simple_internal_2_1", "simple_internal_2_2"],
                required: ["external_phone", "line", "simple_internal_2_1", "simple_internal_2_2"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - 151-–π –ø–æ–¥–Ω—è–ª —Ç—Ä—É–±–∫—É, –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–≤–æ–Ω–æ–∫ —Å –±–µ–∑—É—Å–ª–æ–≤–Ω–æ–π –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–µ–π 152-–º—É, –Ω–æ 152-–π –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Å–∞–º —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–ª (–±—ã–ª –∑–∞–Ω—è—Ç) (—Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —É–º–µ–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ)",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "31": {
                fields: ["external_phone", "line", "simple_internal_2_group", "simple_internal_2_1", "simple_internal_2_2"],
                required: ["external_phone", "line", "simple_internal_2_1", "simple_internal_2_2"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - 151-–π –ø–æ–¥–Ω—è–ª —Ç—Ä—É–±–∫—É, –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–≤–æ–Ω–æ–∫ —Å —É—Å–ª–æ–≤–Ω–æ–π –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–µ–π 152-–º—É, –Ω–æ 152-–π –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Å–∞–º —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–ª (–±—ã–ª –∑–∞–Ω—è—Ç) (—Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —É–º–µ–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ)",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "32": {
                fields: ["external_phone", "line", "simple_internal_2_group", "simple_internal_2_1", "simple_internal_2_2"],
                required: ["external_phone", "line", "simple_internal_2_1", "simple_internal_2_2"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - 151-–π –ø–æ–¥–Ω—è–ª —Ç—Ä—É–±–∫—É, –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–≤–æ–Ω–æ–∫ —Å –±–µ–∑—É—Å–ª–æ–≤–Ω–æ–π –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–µ–π 152-–º—É, –Ω–æ 152-–π –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Å–∞–º —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–ª (–±—ã–ª –∑–∞–Ω—è—Ç) (—Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –Ω–µ —É–º–µ–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ)",
                defaultDuration: 2,
                defaultResult: "no_answer"
            },
            "33": {
                fields: ["external_phone", "line", "simple_internal_2_group", "simple_internal_2_1", "simple_internal_2_2"],
                required: ["external_phone", "line", "simple_internal_2_1", "simple_internal_2_2"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - 151-–π –ø–æ–¥–Ω—è–ª —Ç—Ä—É–±–∫—É, –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–≤–æ–Ω–æ–∫ —Å —É—Å–ª–æ–≤–Ω–æ–π –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–µ–π 152-–º—É, –Ω–æ 152-–π –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç —Å–∞–º —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–ª (–±—ã–ª –∑–∞–Ω—è—Ç) (—Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã–π –∞–ø–ø–∞—Ä–∞—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –Ω–µ —É–º–µ–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ)",
                defaultDuration: 2,
                defaultResult: "no_answer"
            },
            "34": {
                fields: ["external_phone", "line", "follow_me_group", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                required: ["external_phone", "line", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - –ø–æ–¥–Ω—è–ª 151, –∏ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –Ω–æ–º–µ—Ä 300 (FollowMe –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞) - –∑–≤–æ–Ω–æ–∫ –ø–æ—à–µ–ª —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ 150, –ø–æ—Ç–æ–º –Ω–∞ 150 –∏ +375296254070, –ø–æ–¥–Ω—è–ª–∏ –Ω–∞ +375296254070 –∏ —Å–æ–≥–ª–∞—Å–∏–ª–∏—Å—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å",
                defaultDuration: 4,
                defaultResult: "answered"
            },
            "35": {
                fields: ["external_phone", "line", "follow_me_group", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                required: ["external_phone", "line", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - –ø–æ–¥–Ω—è–ª 151, –∏ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –Ω–æ–º–µ—Ä 300 (FollowMe –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞) - –∑–≤–æ–Ω–æ–∫ –ø–æ—à–µ–ª —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ 150, –ø–æ—Ç–æ–º –Ω–∞ 150 –∏ +375296254070, –ø–æ–¥–Ω—è–ª–∏ –Ω–∞ +375296254070 –∏ –Ω–µ —Å–æ–≥–ª–∞—Å–∏–ª–∏—Å—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å",
                defaultDuration: 3,
                defaultResult: "no_answer"
            },
            "36": {
                fields: ["external_phone", "line", "follow_me_group", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                required: ["external_phone", "line", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - –ø–æ–¥–Ω—è–ª 151, –∏ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –Ω–æ–º–µ—Ä 300 (FollowMe –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞) - –∑–≤–æ–Ω–æ–∫ –ø–æ—à–µ–ª —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ 150, –ø–æ—Ç–æ–º –Ω–∞ 150 –∏ +375296254070, –ø–æ–¥–Ω—è–ª–∏ –Ω–∞ 150 –∏ —Å–æ–≥–ª–∞—Å–∏–ª–∏—Å—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å",
                defaultDuration: 4,
                defaultResult: "answered"
            },
            "37": {
                fields: ["external_phone", "line", "follow_me_group", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                required: ["external_phone", "line", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - –ø–æ–¥–Ω—è–ª 151, –∏ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –Ω–æ–º–µ—Ä 300 (FollowMe –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞) - –∑–≤–æ–Ω–æ–∫ –ø–æ—à–µ–ª —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ 150, –ø–æ—Ç–æ–º –Ω–∞ 150 –∏ +375296254070, –ø–æ–¥–Ω—è–ª–∏ –Ω–∞ 150 –∏ –Ω–µ —Å–æ–≥–ª–∞—Å–∏–ª–∏—Å—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å",
                defaultDuration: 3,
                defaultResult: "no_answer"
            },
            "38": {
                fields: ["external_phone", "line", "follow_me_group", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                required: ["external_phone", "line", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - –ø–æ–¥–Ω—è–ª 151, –∏ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –Ω–æ–º–µ—Ä 300 (FollowMe –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞) - –∑–≤–æ–Ω–æ–∫ –ø–æ—à–µ–ª —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ 150, –ø–æ—Ç–æ–º –Ω–∞ 150 –∏ +375296254070, –ø–æ–¥–Ω—è–ª–∏ –Ω–∞ 150 –∏ –ø–æ–≥–æ–≤–æ—Ä–∏–ª–∏",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "39": {
                fields: ["external_phone", "line", "follow_me_group", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                required: ["external_phone", "line", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - –ø–æ–¥–Ω—è–ª 151, –∏ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –Ω–æ–º–µ—Ä 300 (FollowMe –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞) - –∑–≤–æ–Ω–æ–∫ –ø–æ—à–µ–ª —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ 150, –ø–æ—Ç–æ–º –Ω–∞ 150 –∏ +375296254070, –ø–æ–¥–Ω—è–ª–∏ –Ω–∞ +375296254070 –∏ –ø–æ–≥–æ–≤–æ—Ä–∏–ª–∏",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "40": {
                fields: ["external_phone", "line", "follow_me_group", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                required: ["external_phone", "line", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - –ø–æ–¥–Ω—è–ª 151, –∏ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é –±–µ–∑ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –Ω–æ–º–µ—Ä 300 (FollowMe –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞) - –∑–≤–æ–Ω–æ–∫ –ø–æ—à–µ–ª —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ 150, –ø–æ—Ç–æ–º –Ω–∞ 150 –∏ +375296254070, –Ω–∏–≥–¥–µ —Ç—Ä—É–±–∫—É –Ω–µ –ø–æ–¥–Ω—è–ª–∏",
                defaultDuration: 2,
                defaultResult: "no_answer"
            },
            "41": {
                fields: ["external_phone", "line", "follow_me_group", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                required: ["external_phone", "line", "follow_me_internal", "follow_me_manager", "follow_me_external_line"],
                description: "–ü–æ—Å—Ç—É–ø–∏–ª –∑–≤–æ–Ω–æ–∫ - –ø–æ–¥–Ω—è–ª 151, –∏ —Å–¥–µ–ª–∞–ª –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é —Å –∑–∞–ø—Ä–æ—Å–æ–º –Ω–∞ –Ω–æ–º–µ—Ä 300 (FollowMe –Ω–æ–º–µ—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞) - –∑–≤–æ–Ω–æ–∫ –ø–æ—à–µ–ª —Å–Ω–∞—á–∞–ª–∞ –Ω–∞ 150, –ø–æ—Ç–æ–º –Ω–∞ 150 –∏ +375296254070, –Ω–∏–≥–¥–µ —Ç—Ä—É–±–∫—É –Ω–µ –ø–æ–¥–Ω—è–ª–∏",
                defaultDuration: 2,
                defaultResult: "no_answer"
            },
            "42": {
                fields: ["internal_call_group", "internal_caller", "internal_callee"],
                required: ["internal_caller", "internal_callee"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –∞–±–æ–Ω–µ–Ω—Ç–∞ - –ø–æ–¥–Ω—è–ª —Ç—Ä—É–±–∫—É",
                defaultDuration: 2,
                defaultResult: "answered"
            },
            "43": {
                fields: ["internal_call_group", "internal_caller", "internal_callee"],
                required: ["internal_caller", "internal_callee"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –∞–±–æ–Ω–µ–Ω—Ç–∞ - –Ω–µ –ø–æ–¥–Ω—è–ª —Ç—Ä—É–±–∫—É",
                defaultDuration: 1,
                defaultResult: "no_answer"
            },
            "44": {
                fields: ["department_call_group", "department_caller", "department_member_1", "department_member_2", "department_member_3", "department_member_4"],
                required: ["department_caller", "department_member_1"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –æ—Ç–¥–µ–ª - –ø–æ–¥–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É",
                defaultDuration: 3,
                defaultResult: "answered"
            },
            "45": {
                fields: ["department_call_group", "department_caller", "department_member_1", "department_member_2", "department_member_3", "department_member_4"],
                required: ["department_caller", "department_member_1"],
                description: "–ó–≤–æ–Ω–æ–∫ –Ω–∞ –æ—Ç–¥–µ–ª - –Ω–µ –ø–æ–¥–Ω—è–ª–∏ —Ç—Ä—É–±–∫—É",
                defaultDuration: 2,
                defaultResult: "no_answer"
            }
            // –î–æ–±–∞–≤–∏–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –ø–æ—à—Ç—É—á–Ω–æ
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –ø–æ–ª–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∑–≤–æ–Ω–∫–∞
        function updateFieldsVisibility(callTypeId) {
            const mapping = callTypeFieldMapping[callTypeId];
            if (!mapping) {
                // console.log("–ú–∞–ø–ø–∏–Ω–≥ –¥–ª—è —Ç–∏–ø–∞", callTypeId, "–Ω–µ –Ω–∞–π–¥–µ–Ω");
                return;
            }

            // –í—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–ª—è
            const allFields = [
                "external_phone", "manager", "line", "duration",
                "second_manager", "transfer_type", "follow_me_phone", 
                "backup_line", "department", "greeting", "forbidden_direction",
                "internal_group_1", "internal_group_2", "internal_group_3", "internal_group_4", "answered_manager",
                "transfer_to_manager", "mobile_manager", "mobile_outgoing_line",
                "step1_group", "step2_group", "step3_group",
                "step1_manager_1", "step1_manager_2", "step1_manager_3", "step1_manager_4",
                "step2_manager_1", "step2_manager_2", "step2_manager_3", "step2_manager_4",
                "step3_manager_1", "step3_manager_2", "step3_manager_3", "step3_manager_4",
                "step3_mobile_section", "step3_mobile_manager", "step3_mobile_line",
                "answered_manager_final", "answered_manager_final_mobile",
                "simple_internal_group", "simple_internal_1", "simple_internal_2", "simple_internal_3",
                "simple_internal_2_group", "simple_internal_2_1", "simple_internal_2_2",
                "follow_me_group", "follow_me_internal", "follow_me_manager", "follow_me_external_line",
                "internal_call_group", "internal_caller", "internal_callee",
                "department_call_group", "department_caller", "department_member_1", "department_member_2", "department_member_3", "department_member_4"
            ];

            // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª–µ duration –≤—Å–µ–≥–¥–∞ (–æ–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
            const hiddenFields = ["duration"];

            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è
            allFields.forEach(fieldName => {
                const container = document.querySelector(`[data-field="${fieldName}"]`);
                if (container) {
                    // –í—Å–µ–≥–¥–∞ —Å–∫—Ä—ã–≤–∞–µ–º duration –∏ result
                    if (hiddenFields.includes(fieldName)) {
                        container.style.display = 'none';
                    } else {
                        container.style.display = 'none';
                    }
                    const input = container.querySelector('input, select');
                    if (input) input.required = false;
                }
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è (–∫—Ä–æ–º–µ –≤—Å–µ–≥–¥–∞ —Å–∫—Ä—ã—Ç—ã—Ö)
            mapping.fields.forEach(fieldName => {
                const container = document.querySelector(`[data-field="${fieldName}"]`);
                if (container && !hiddenFields.includes(fieldName)) {
                    container.style.display = 'block';
                    const input = container.querySelector('input, select');
                    if (input && mapping.required.includes(fieldName)) {
                        input.required = true;
                    }
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏ –ª–∏–Ω–∏–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª–µ–π
            setTimeout(updateManagerAvailability, 50);
            setTimeout(updateLineAvailability, 50);
            setTimeout(updateInternalGroupAvailability, 50);
            setTimeout(updateMobileLineAvailability, 50);
            setTimeout(updateMobileManagerVisibility, 50);
            setTimeout(updateTransferManagerAvailability, 50);
            setTimeout(updateSimpleInternalAvailability, 50);
            setTimeout(updateSimpleInternal2Availability, 50);
            setTimeout(updateFollowMeExternalLineAvailability, 50);
            setTimeout(updateInternalCallAvailability, 50);
            setTimeout(updateDepartmentMembersAvailability, 50);
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –∑–≤–æ–Ω–∫–∞
        document.getElementById('call_type').addEventListener('change', function() {
            updateCallTypeDescription(this.value);
            updateFieldsVisibility(this.value);
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
        function updateManagerAvailability() {
            const firstManager = document.getElementById('internal_phone');
            const secondManager = document.querySelector('select[name="second_internal_phone"]');
            
            if (!firstManager || !secondManager) return;
            
            const selectedFirstManager = firstManager.value;
            
            // –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ –≤–æ –≤—Ç–æ—Ä–æ–º —Å–µ–ª–µ–∫—Ç–µ
            Array.from(secondManager.options).forEach(option => {
                option.disabled = false;
                option.style.color = '';
                option.style.backgroundColor = '';
            });
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤ –ø–µ—Ä–≤–æ–º —Å–µ–ª–µ–∫—Ç–µ
            if (selectedFirstManager) {
                Array.from(secondManager.options).forEach(option => {
                    if (option.value === selectedFirstManager) {
                        option.disabled = true;
                        option.style.color = '#ccc';
                        option.style.backgroundColor = '#f5f5f5';
                    }
                });
                
                // –ï—Å–ª–∏ –≤–æ –≤—Ç–æ—Ä–æ–º —Å–µ–ª–µ–∫—Ç–µ –≤—ã–±—Ä–∞–Ω —Ç–æ—Ç –∂–µ –º–µ–Ω–µ–¥–∂–µ—Ä, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                if (secondManager.value === selectedFirstManager) {
                    secondManager.value = '';
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ª–∏–Ω–∏–π
        function updateLineAvailability() {
            const firstLine = document.getElementById('line_id');
            const backupLine = document.querySelector('select[name="backup_line_id"]');
            
            if (!firstLine || !backupLine) return;
            
            const selectedFirstLine = firstLine.value;
            
            // –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ –≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –ª–∏–Ω–∏–∏
            Array.from(backupLine.options).forEach(option => {
                option.disabled = false;
                option.style.color = '';
                option.style.backgroundColor = '';
            });
            
            // –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–∏–Ω–∏–∏
            if (selectedFirstLine) {
                Array.from(backupLine.options).forEach(option => {
                    if (option.value === selectedFirstLine) {
                        option.disabled = true;
                        option.style.color = '#ccc';
                        option.style.backgroundColor = '#f5f5f5';
                    }
                });
                
                // –ï—Å–ª–∏ –≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –ª–∏–Ω–∏–∏ –≤—ã–±—Ä–∞–Ω–∞ —Ç–∞ –∂–µ, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                if (backupLine.value === selectedFirstLine) {
                    backupLine.value = '';
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤ –≥—Ä—É–ø–ø–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤
        function updateInternalGroupAvailability() {
            const groupSelects = [
                document.getElementById('internal_group_1'),
                document.getElementById('internal_group_2'),
                document.getElementById('internal_group_3'),
                document.getElementById('internal_group_4'),
                document.getElementById('answered_manager')
            ];
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const selectedValues = groupSelects
                .filter(select => select && select.value)
                .map(select => select.value);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π dropdown
            groupSelects.forEach(currentSelect => {
                if (!currentSelect) return;
                
                const options = currentSelect.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value === '') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç–æ–π option
                    
                    const isSelected = selectedValues.includes(option.value);
                    const isCurrentSelection = option.value === currentSelect.value;
                    
                    if (isSelected && !isCurrentSelection) {
                        option.disabled = true;
                        option.style.backgroundColor = '#f8f9fa';
                        option.style.color = '#6c757d';
                    } else {
                        option.disabled = false;
                        option.style.backgroundColor = '';
                        option.style.color = '';
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏—Å—Ö–æ–¥—è—â–µ–π –ª–∏–Ω–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ
        function updateMobileLineAvailability() {
            const incomingLine = document.getElementById('line_id');
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è —Å –∏—Å—Ö–æ–¥—è—â–∏–º–∏ –ª–∏–Ω–∏—è–º–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ
            const mobileOutgoingLines = [
                document.getElementById('mobile_outgoing_line'),
                document.getElementById('step3_mobile_line')
            ];
            
            if (!incomingLine) return;
            
            const selectedIncomingLine = incomingLine.value;
            
            mobileOutgoingLines.forEach(mobileOutgoingLine => {
                if (!mobileOutgoingLine) return;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –≤ –∏—Å—Ö–æ–¥—è—â–µ–π –ª–∏–Ω–∏–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ
                const options = mobileOutgoingLine.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value === '') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç–æ–π option
                    
                    if (option.value === selectedIncomingLine) {
                        option.disabled = true;
                        option.style.backgroundColor = '#f8f9fa';
                        option.style.color = '#6c757d';
                        option.textContent = option.textContent.includes('(–∑–∞–Ω—è—Ç–∞)') ? 
                            option.textContent : option.textContent + ' (–∑–∞–Ω—è—Ç–∞ –≤—Ö–æ–¥—è—â–∏–º)';
                    } else {
                        option.disabled = false;
                        option.style.backgroundColor = '';
                        option.style.color = '';
                        option.textContent = option.textContent.replace(' (–∑–∞–Ω—è—Ç–∞ –≤—Ö–æ–¥—è—â–∏–º)', '');
                    }
                });
                
                // –ï—Å–ª–∏ –≤ –∏—Å—Ö–æ–¥—è—â–µ–π –ª–∏–Ω–∏–∏ –≤—ã–±—Ä–∞–Ω–∞ —Ç–∞ –∂–µ —á—Ç–æ –∏ –≤—Ö–æ–¥—è—â–∞—è, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                if (mobileOutgoingLine.value === selectedIncomingLine) {
                    mobileOutgoingLine.value = '';
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ç–æ–ª—å–∫–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å –º–æ–±–∏–ª—å–Ω—ã–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏
        function updateMobileManagerVisibility() {
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –ø–æ–ª—è —Å –º–æ–±–∏–ª—å–Ω—ã–º–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏
            const mobileManagerSelects = [
                document.getElementById('mobile_manager'),
                document.getElementById('step3_mobile_manager')
            ];
            
            mobileManagerSelects.forEach(mobileManagerSelect => {
                if (!mobileManagerSelect) return;
                
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ –±–µ–∑ personal_phone –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å personal_phone
                const options = mobileManagerSelect.querySelectorAll('option');
                options.forEach(option => {
                    const mobilePhone = option.getAttribute('data-mobile');
                    if (option.value === '') {
                        // –û—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
                        option.style.display = 'block';
                    } else if (!mobilePhone || mobilePhone.trim() === '') {
                        // –°–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –±–µ–∑ –º–æ–±–∏–ª—å–Ω–æ–≥–æ
                        option.style.display = 'none';
                    } else {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å –º–æ–±–∏–ª—å–Ω—ã–º
                        option.style.display = 'block';
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å—Ç—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ (—Ç–∏–ø 2-18)
        function updateSimpleInternalAvailability() {
            const selects = [
                document.getElementById('simple_internal_1'),
                document.getElementById('simple_internal_2'),
                document.getElementById('simple_internal_3')
            ];
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const selectedValues = selects.map(select => select ? select.value : '').filter(val => val !== '');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –≤ –∫–∞–∂–¥–æ–º —Å–µ–ª–µ–∫—Ç–µ
            selects.forEach((select, selectIndex) => {
                if (!select) return;
                
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value === '') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–æ –ª–∏ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö —Å–µ–ª–µ–∫—Ç–∞—Ö
                    const isSelectedElsewhere = selectedValues.includes(option.value) && select.value !== option.value;
                    
                    if (isSelectedElsewhere) {
                        option.disabled = true;
                        option.style.backgroundColor = '#f8f9fa';
                        option.style.color = '#6c757d';
                        option.textContent = option.textContent.includes('(–∑–∞–Ω—è—Ç)') ? 
                            option.textContent : option.textContent + ' (–∑–∞–Ω—è—Ç)';
                    } else {
                        option.disabled = false;
                        option.style.backgroundColor = '';
                        option.style.color = '';
                        option.textContent = option.textContent.replace(' (–∑–∞–Ω—è—Ç)', '');
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–æ—Å—Ç—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ (2 –ø–æ–ª—è –¥–ª—è —Ç–∏–ø–æ–≤ 2-19 –¥–æ 2-22)
        function updateSimpleInternal2Availability() {
            const selects = [
                document.getElementById('simple_internal_2_1'),
                document.getElementById('simple_internal_2_2')
            ];
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const selectedValues = selects.map(select => select ? select.value : '').filter(val => val !== '');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –≤ –∫–∞–∂–¥–æ–º —Å–µ–ª–µ–∫—Ç–µ
            selects.forEach((select, selectIndex) => {
                if (!select) return;
                
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value === '') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–æ –ª–∏ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö —Å–µ–ª–µ–∫—Ç–∞—Ö
                    const isSelectedElsewhere = selectedValues.includes(option.value) && select.value !== option.value;
                    
                    if (isSelectedElsewhere) {
                        option.disabled = true;
                        option.style.backgroundColor = '#f8f9fa';
                        option.style.color = '#6c757d';
                        option.textContent = option.textContent.includes('(–∑–∞–Ω—è—Ç)') ? 
                            option.textContent : option.textContent + ' (–∑–∞–Ω—è—Ç)';
                    } else {
                        option.disabled = false;
                        option.style.backgroundColor = '';
                        option.style.color = '';
                        option.textContent = option.textContent.replace(' (–∑–∞–Ω—è—Ç)', '');
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–µ–π –ª–∏–Ω–∏–∏ Follow Me (–Ω–µ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è —Å –≤—Ö–æ–¥—è—â–µ–π)
        function updateFollowMeExternalLineAvailability() {
            const incomingLine = document.getElementById('line');
            const followMeExternalLine = document.getElementById('follow_me_external_line');
            
            if (!incomingLine || !followMeExternalLine) return;
            
            const incomingLineValue = incomingLine.value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –≤ —Å–µ–ª–µ–∫—Ç–µ –≤–Ω–µ—à–Ω–µ–π –ª–∏–Ω–∏–∏
            const options = followMeExternalLine.querySelectorAll('option');
            options.forEach(option => {
                if (option.value === '') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
                
                if (option.value === incomingLineValue && incomingLineValue !== '') {
                    option.disabled = true;
                    option.style.backgroundColor = '#f8f9fa';
                    option.style.color = '#6c757d';
                    option.textContent = option.textContent.includes('(–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)') ? 
                        option.textContent : option.textContent + ' (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤—Ö–æ–¥—è—â–∞—è)';
                } else {
                    option.disabled = false;
                    option.style.backgroundColor = '';
                    option.style.color = '';
                    option.textContent = option.textContent.replace(' (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –≤—Ö–æ–¥—è—â–∞—è)', '');
                }
            });
            
            // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç, –æ—á–∏—â–∞–µ–º
            if (followMeExternalLine.value === incomingLineValue && incomingLineValue !== '') {
                followMeExternalLine.value = '';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∑–≤–æ–Ω–∫–æ–≤ (–Ω–µ–ª—å–∑—è –∑–≤–æ–Ω–∏—Ç—å —Å–∞–º–æ–º—É —Å–µ–±–µ)
        function updateInternalCallAvailability() {
            const caller = document.getElementById('internal_caller');
            const callee = document.getElementById('internal_callee');
            
            if (!caller || !callee) return;
            
            const callerValue = caller.value;
            const calleeValue = callee.value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –≤ —Å–µ–ª–µ–∫—Ç–µ "–∫–æ–º—É –∑–≤–æ–Ω—è—Ç"
            const calleeOptions = callee.querySelectorAll('option');
            calleeOptions.forEach(option => {
                if (option.value === '') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
                
                if (option.value === callerValue && callerValue !== '') {
                    option.disabled = true;
                    option.style.backgroundColor = '#f8f9fa';
                    option.style.color = '#6c757d';
                    option.textContent = option.textContent.includes('(—Å–µ–±—è)') ? 
                        option.textContent : option.textContent + ' (–Ω–µ–ª—å–∑—è –∑–≤–æ–Ω–∏—Ç—å —Å–µ–±–µ)';
                } else {
                    option.disabled = false;
                    option.style.backgroundColor = '';
                    option.style.color = '';
                    option.textContent = option.textContent.replace(' (–Ω–µ–ª—å–∑—è –∑–≤–æ–Ω–∏—Ç—å —Å–µ–±–µ)', '');
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –≤ —Å–µ–ª–µ–∫—Ç–µ "–∫—Ç–æ –∑–≤–æ–Ω–∏—Ç"
            const callerOptions = caller.querySelectorAll('option');
            callerOptions.forEach(option => {
                if (option.value === '') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
                
                if (option.value === calleeValue && calleeValue !== '') {
                    option.disabled = true;
                    option.style.backgroundColor = '#f8f9fa';
                    option.style.color = '#6c757d';
                    option.textContent = option.textContent.includes('(—Å–µ–±—è)') ? 
                        option.textContent : option.textContent + ' (–Ω–µ–ª—å–∑—è –∑–≤–æ–Ω–∏—Ç—å —Å–µ–±–µ)';
                } else {
                    option.disabled = false;
                    option.style.backgroundColor = '';
                    option.style.color = '';
                    option.textContent = option.textContent.replace(' (–Ω–µ–ª—å–∑—è –∑–≤–æ–Ω–∏—Ç—å —Å–µ–±–µ)', '');
                }
            });
            
            // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –≤—ã–±–æ—Ä –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç, –æ—á–∏—â–∞–µ–º
            if (callerValue === calleeValue && callerValue !== '') {
                if (caller === document.activeElement) {
                    callee.value = '';
                } else {
                    caller.value = '';
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–ª–µ–Ω–æ–≤ –æ—Ç–¥–µ–ª–∞ (–Ω–µ–ª—å–∑—è –≤—ã–±–∏—Ä–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö)
        function updateDepartmentMembersAvailability() {
            const memberSelects = [
                document.getElementById('department_member_1'),
                document.getElementById('department_member_2'),
                document.getElementById('department_member_3'),
                document.getElementById('department_member_4')
            ];
            
            // –°–æ–±–∏—Ä–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            const selectedValues = memberSelects.map(select => select ? select.value : '').filter(val => val !== '');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–π –≤ –∫–∞–∂–¥–æ–º —Å–µ–ª–µ–∫—Ç–µ
            memberSelects.forEach((select, selectIndex) => {
                if (!select) return;
                
                const options = select.querySelectorAll('option');
                options.forEach(option => {
                    if (option.value === '') return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—É—é –æ–ø—Ü–∏—é
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω–æ –ª–∏ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –¥—Ä—É–≥–∏—Ö —Å–µ–ª–µ–∫—Ç–∞—Ö
                    const isSelectedElsewhere = selectedValues.includes(option.value) && select.value !== option.value;
                    
                    if (isSelectedElsewhere) {
                        option.disabled = true;
                        option.style.backgroundColor = '#f8f9fa';
                        option.style.color = '#6c757d';
                        option.textContent = option.textContent.includes('(–∑–∞–Ω—è—Ç)') ? 
                            option.textContent : option.textContent + ' (—É–∂–µ –≤ –æ—Ç–¥–µ–ª–µ)';
                    } else {
                        option.disabled = false;
                        option.style.backgroundColor = '';
                        option.style.color = '';
                        option.textContent = option.textContent.replace(' (—É–∂–µ –≤ –æ—Ç–¥–µ–ª–µ)', '');
                    }
                });
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞
        function updateMobileAnswerDisplay() {
            const step3MobileManager = document.getElementById('step3_mobile_manager');
            const mobileAnswerText = document.getElementById('mobile_answer_text');
            const answeredManagerMobile = document.getElementById('answered_manager_mobile');
            
            if (!step3MobileManager || !mobileAnswerText || !answeredManagerMobile) return;
            
            const selectedOption = step3MobileManager.options[step3MobileManager.selectedIndex];
            
            if (selectedOption && selectedOption.value) {
                const managerName = selectedOption.text;
                const mobilePhone = selectedOption.getAttribute('data-mobile');
                
                if (mobilePhone) {
                    mobileAnswerText.innerHTML = `<strong>${managerName}</strong> –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –º–æ–±–∏–ª—å–Ω–æ–º –Ω–æ–º–µ—Ä–µ: <strong>${mobilePhone}</strong>`;
                    answeredManagerMobile.value = selectedOption.value;
                } else {
                    mobileAnswerText.textContent = '–í—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –Ω–µ –∏–º–µ–µ—Ç –º–æ–±–∏–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞';
                    answeredManagerMobile.value = '';
                }
            } else {
                mobileAnswerText.textContent = '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ –®–∞–≥–µ 3';
                answeredManagerMobile.value = '';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ –ø–æ–ª—è—Ö "–ö—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª" –∏ "–ù–∞ –∫–æ–≥–æ –ø–µ—Ä–µ–≤–µ–ª–∏"
        function updateTransferManagerAvailability() {
            const answeredManager = document.getElementById('answered_manager');
            const transferToManager = document.getElementById('transfer_to_manager');
            
            if (!answeredManager || !transferToManager) return;
            
            const selectedAnsweredManager = answeredManager.value;
            
            // –í–∫–ª—é—á–∞–µ–º –≤—Å–µ –æ–ø—Ü–∏–∏ –≤ "–ù–∞ –∫–æ–≥–æ –ø–µ—Ä–µ–≤–µ–ª–∏"
            Array.from(transferToManager.options).forEach(option => {
                option.disabled = false;
                option.style.color = '';
                option.style.backgroundColor = '';
            });
            
            // –û—Ç–∫–ª—é—á–∞–µ–º —Ç–æ–≥–æ, –∫—Ç–æ —É–∂–µ –æ—Ç–≤–µ—Ç–∏–ª
            if (selectedAnsweredManager) {
                Array.from(transferToManager.options).forEach(option => {
                    if (option.value === selectedAnsweredManager) {
                        option.disabled = true;
                        option.style.color = '#ccc';
                        option.style.backgroundColor = '#f5f5f5';
                    }
                });
                
                // –ï—Å–ª–∏ –≤ "–ù–∞ –∫–æ–≥–æ –ø–µ—Ä–µ–≤–µ–ª–∏" –≤—ã–±—Ä–∞–Ω —Ç–æ—Ç –∂–µ –º–µ–Ω–µ–¥–∂–µ—Ä, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                if (transferToManager.value === selectedAnsweredManager) {
                    transferToManager.value = '';
                }
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏ –ª–∏–Ω–∏–π
        document.addEventListener('DOMContentLoaded', function() {
            const firstManager = document.getElementById('internal_phone');
            const secondManager = document.querySelector('select[name="second_internal_phone"]');
            const firstLine = document.getElementById('line_id');
            const backupLine = document.querySelector('select[name="backup_line_id"]');
            
            if (firstManager) {
                firstManager.addEventListener('change', updateManagerAvailability);
            }
            if (secondManager) {
                secondManager.addEventListener('change', updateManagerAvailability);
            }
            if (firstLine) {
                firstLine.addEventListener('change', updateLineAvailability);
            }
            if (backupLine) {
                backupLine.addEventListener('change', updateLineAvailability);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≥—Ä—É–ø–ø—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤
            const groupSelects = [
                document.getElementById('internal_group_1'),
                document.getElementById('internal_group_2'),
                document.getElementById('internal_group_3'),
                document.getElementById('internal_group_4'),
                document.getElementById('answered_manager')
            ];
            
            groupSelects.forEach(select => {
                if (select) {
                    select.addEventListener('change', updateInternalGroupAvailability);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ª–∏–Ω–∏–π
            const incomingLine = document.getElementById('line_id');
            const mobileOutgoingLine = document.getElementById('mobile_outgoing_line');
            const step3MobileLine = document.getElementById('step3_mobile_line');
            
            if (incomingLine) {
                incomingLine.addEventListener('change', updateMobileLineAvailability);
            }
            if (mobileOutgoingLine) {
                mobileOutgoingLine.addEventListener('change', updateMobileLineAvailability);
            }
            if (step3MobileLine) {
                step3MobileLine.addEventListener('change', updateMobileLineAvailability);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –≤ –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏
            const answeredManager = document.getElementById('answered_manager');
            const transferToManager = document.getElementById('transfer_to_manager');
            
            if (answeredManager) {
                answeredManager.addEventListener('change', updateTransferManagerAvailability);
            }
            if (transferToManager) {
                transferToManager.addEventListener('change', updateTransferManagerAvailability);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const step3MobileManager = document.getElementById('step3_mobile_manager');
            if (step3MobileManager) {
                step3MobileManager.addEventListener('change', updateMobileAnswerDisplay);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ (—Ç–∏–ø 2-18)
            const simpleInternalSelects = ['simple_internal_1', 'simple_internal_2', 'simple_internal_3'];
            simpleInternalSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.addEventListener('change', updateSimpleInternalAvailability);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ–º–µ—Ä–æ–≤ (—Ç–∏–ø—ã 2-19 –¥–æ 2-22)
            const simpleInternal2Selects = ['simple_internal_2_1', 'simple_internal_2_2'];
            simpleInternal2Selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.addEventListener('change', updateSimpleInternal2Availability);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è Follow Me (—Ç–∏–ø—ã 2-23, 2-24)
            const lineSelect = document.getElementById('line');
            const followMeExternalLine = document.getElementById('follow_me_external_line');
            const followMeManager = document.getElementById('follow_me_manager');
            
            if (lineSelect) {
                lineSelect.addEventListener('change', updateFollowMeExternalLineAvailability);
            }
            if (followMeExternalLine) {
                followMeExternalLine.addEventListener('change', updateFollowMeExternalLineAvailability);
            }
            if (followMeManager) {
                followMeManager.addEventListener('change', updateMobileManagerVisibility);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∑–≤–æ–Ω–∫–æ–≤ (—Ç–∏–ø—ã 3-1, 3-2)
            const internalCaller = document.getElementById('internal_caller');
            const internalCallee = document.getElementById('internal_callee');
            
            if (internalCaller) {
                internalCaller.addEventListener('change', updateInternalCallAvailability);
            }
            if (internalCallee) {
                internalCallee.addEventListener('change', updateInternalCallAvailability);
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —á–ª–µ–Ω–æ–≤ –æ—Ç–¥–µ–ª–∞ (—Ç–∏–ø—ã 3-3, 3-4)
            const departmentMemberSelects = ['department_member_1', 'department_member_2', 'department_member_3', 'department_member_4'];
            departmentMemberSelects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.addEventListener('change', updateDepartmentMembersAvailability);
                }
            });
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const callTypeSelect = document.getElementById('call_type');
            if (callTypeSelect.value) {
                updateCallTypeDescription(callTypeSelect.value);
                updateFieldsVisibility(callTypeSelect.value);
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –∏ –ª–∏–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            setTimeout(updateManagerAvailability, 100);
            setTimeout(updateLineAvailability, 100);
            setTimeout(updateInternalGroupAvailability, 100);
            setTimeout(updateMobileLineAvailability, 100);
            setTimeout(updateMobileManagerVisibility, 100);
            setTimeout(updateTransferManagerAvailability, 100);
            setTimeout(updateSimpleInternalAvailability, 100);
            setTimeout(updateSimpleInternal2Availability, 100);
            setTimeout(updateFollowMeExternalLineAvailability, 100);
            setTimeout(updateInternalCallAvailability, 100);
            setTimeout(updateDepartmentMembersAvailability, 100);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–ª–∞–≥–æ–≤ —Å—Ç—Ä–∞–Ω
            initCountryFlags();
        });



        // –≠–º—É–ª—è—Ç–æ—Ä —Å–æ–±—ã—Ç–∏–π
        let emulatorState = {
            mode: null, // 'auto' | 'manual'
            currentStep: 0,
            events: [],
            isRunning: false,
            autoInterval: null,
            callData: null
        };

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UniqueId —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º
        function generateUniqueId(baseExample = "1757765248.0") {
            const currentUnixTime = Math.floor(Date.now() / 1000);
            const first7Digits = currentUnixTime.toString().substring(0, 7);
            const last3DigitsAndSuffix = baseExample.substring(7); // "248.0" –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
            return first7Digits + last3DigitsAndSuffix;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Bridge UUID
        function generateBridgeUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Channel ID (8 —Ü–∏—Ñ—Ä)
        function generateChannelId() {
            return Math.floor(Math.random() * 100000000).toString().padStart(8, '0');
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞
        function generateEventsForPattern(callTypeId, formData) {
            const events = [];
            const enterprise = formData.get('enterprise') || '0367';
            
            // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è (–ø–æ–∫–∞ –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–∏–º –¥–ª—è 0367)
            const token = enterprise === '0367' ? '375293332255' : '375293332255';
            
            const bridgeId = generateBridgeUUID();

            switch(parseInt(callTypeId)) {
                case 1: // 1-1: –ò—Å—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ - –æ—Ç–≤–µ—Ç–∏–ª–∏
                    // UniqueId –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –∏–∑ AlternativeAPIlogs –ø–∞—Ç—Ç–µ—Ä–Ω–∞ 1-1
                    const uniqueIds_1_1 = {
                        step1: generateUniqueId("1757765248.0"), // dial
                        step2: generateUniqueId("1757765249.1"), // new_callerid  
                        step3: "", // bridge_create - –ø—É—Å—Ç–æ–π
                        step4: generateUniqueId("1757765249.1"), // bridge
                        step5: generateUniqueId("1757765248.0"), // bridge
                        step6: generateUniqueId("1757765249.1"), // bridge_leave
                        step7: generateUniqueId("1757765248.0"), // bridge_leave
                        step8: "", // bridge_destroy - –ø—É—Å—Ç–æ–π
                        step9: generateUniqueId("1757765248.0")  // hangup
                    };
                    const phone = (formData.get('external_phone') || '').replace(/^\+/, ''); // –£–±–∏—Ä–∞–µ–º + –∫–∞–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º Asterisk
                    const managerRaw = formData.get('internal_phone');
                    const lineRaw = formData.get('line_id');
                    const manager = managerRaw || '150';
                    const trunk = lineRaw ? lineRaw.split(' - ')[0] : '0001363';
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ª–∏–Ω–∏–∏ (SIP –∏–ª–∏ GSM)
                    const isSipLine = lineRaw && lineRaw.includes('(SIP)');
                    // –î–ª—è SIP –ª–∏–Ω–∏–π –≤ Extensions –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å SIP trunk ID, –¥–ª—è GSM - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –Ω–æ–º–µ—Ä
                    const extensionsForHangup = isSipLine ? [trunk] : [manager];
                    
                    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                    console.log('Form data:', {
                        phone: phone,
                        managerRaw: managerRaw,
                        manager: manager,
                        lineRaw: lineRaw,
                        trunk: trunk
                    });

                    // 1. dial - –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞
                    events.push({
                        step: 1,
                        event: 'dial',
                        description: '–ò–Ω–∏—Ü–∏–∞—Ü–∏—è –∏—Å—Ö–æ–¥—è—â–µ–≥–æ –∑–≤–æ–Ω–∫–∞',
                        data: {
                            Phone: phone,
                            ExtTrunk: "",
                            ExtPhone: "",
                            Extensions: [manager],
                            UniqueId: uniqueIds_1_1.step1,
                            Token: token,
                            Trunk: trunk,
                            CallType: 1
                        }
                    });

                    // 2. new_callerid - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CallerID
                    events.push({
                        step: 2,
                        event: 'new_callerid',
                        description: '–£—Å—Ç–∞–Ω–æ–≤–∫–∞ CallerID',
                        data: {
                            CallerIDNum: phone,
                            Channel: `SIP/${trunk}-00000001`,
                            CallerIDName: "<–•–†–ï–ù>",
                            Context: "from-out-office",
                            UniqueId: uniqueIds_1_1.step2,
                            ConnectedLineNum: manager,
                            Token: token,
                            ConnectedLineName: manager,
                            Exten: phone
                        }
                    });

                    // 3. bridge_create - –°–æ–∑–¥–∞–Ω–∏–µ –º–æ—Å—Ç–∞
                    events.push({
                        step: 3,
                        event: 'bridge_create',
                        description: '–°–æ–∑–¥–∞–Ω–∏–µ –º–æ—Å—Ç–∞',
                        data: {
                            BridgeType: "",
                            BridgeUniqueid: bridgeId,
                            UniqueId: "",
                            BridgeCreator: "<–•–†–ï–ù>",
                            Token: token,
                            BridgeName: "<–•–†–ï–ù>",
                            BridgeNumChannels: "0",
                            BridgeTechnology: "simple_bridge"
                        }
                    });

                    // 4. bridge - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞
                    events.push({
                        step: 4,
                        event: 'bridge',
                        description: '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞',
                        data: {
                            CallerIDNum: phone,
                            Channel: `SIP/${trunk}-00000001`,
                            CallerIDName: "",
                            BridgeUniqueid: bridgeId,
                            UniqueId: uniqueIds_1_1.step4,
                            Exten: "",
                            ConnectedLineNum: manager,
                            Token: token,
                            ConnectedLineName: manager
                        }
                    });

                    // 5. bridge - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞
                    events.push({
                        step: 5,
                        event: 'bridge',
                        description: '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞',
                        data: {
                            CallerIDNum: manager,
                            Channel: `SIP/${manager}-00000000`,
                            CallerIDName: manager,
                            BridgeUniqueid: bridgeId,
                            UniqueId: uniqueIds_1_1.step5,
                            Exten: phone,
                            ConnectedLineNum: "<–•–†–ï–ù>",
                            Token: token,
                            ConnectedLineName: "<–•–†–ï–ù>"
                        }
                    });

                    // 6. bridge_leave - –í—ã—Ö–æ–¥ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞
                    events.push({
                        step: 6,
                        event: 'bridge_leave',
                        description: '–í—ã—Ö–æ–¥ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞',
                        data: {
                            CallerIDNum: phone,
                            Channel: `SIP/${trunk}-00000001`,
                            CallerIDName: "<–•–†–ï–ù>",
                            BridgeUniqueid: bridgeId,
                            UniqueId: uniqueIds_1_1.step6,
                            ConnectedLineNum: manager,
                            Token: token,
                            ConnectedLineName: manager,
                            BridgeNumChannels: "1"
                        }
                    });

                    // 7. bridge_leave - –í—ã—Ö–æ–¥ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞
                    events.push({
                        step: 7,
                        event: 'bridge_leave',
                        description: '–í—ã—Ö–æ–¥ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫–∞–Ω–∞–ª–∞',
                        data: {
                            CallerIDNum: manager,
                            Channel: `SIP/${manager}-00000000`,
                            CallerIDName: manager,
                            BridgeUniqueid: bridgeId,
                            UniqueId: uniqueIds_1_1.step7,
                            ConnectedLineNum: "<–•–†–ï–ù>",
                            Token: token,
                            ConnectedLineName: "<–•–†–ï–ù>",
                            BridgeNumChannels: "0"
                        }
                    });

                    // 8. bridge_destroy - –£–¥–∞–ª–µ–Ω–∏–µ –º–æ—Å—Ç–∞
                    events.push({
                        step: 8,
                        event: 'bridge_destroy',
                        description: '–£–¥–∞–ª–µ–Ω–∏–µ –º–æ—Å—Ç–∞',
                        data: {
                            BridgeType: "",
                            BridgeUniqueid: bridgeId,
                            UniqueId: "",
                            BridgeCreator: "<–•–†–ï–ù>",
                            Token: token,
                            BridgeName: "<–•–†–ï–ù>",
                            BridgeNumChannels: "0",
                            BridgeTechnology: "simple_bridge"
                        }
                    });

                    // 9. hangup - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞
                    const now = new Date();
                    const startTime = new Date(now.getTime() - 18000); // 18 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
                    const receivedTime = new Date(now.getTime() - 19000); // 19 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥
                    
                    events.push({
                        step: 9,
                        event: 'hangup',
                        description: '–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–∞',
                        data: {
                            Phone: phone,
                            StartTime: startTime.toISOString().replace('T', ' ').substring(0, 19),
                            Extensions: extensionsForHangup,
                            UniqueId: uniqueIds_1_1.step9,
                            DateReceived: receivedTime.toISOString().replace('T', ' ').substring(0, 19),
                            Token: token,
                            EndTime: now.toISOString().replace('T', ' ').substring(0, 19),
                            CallType: 1,
                            CallStatus: "2",
                            Trunk: trunk
                        }
                    });
                    break;

                case 2: // 1-2: –ò—Å—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ —Å –≤–Ω–µ—à–Ω–µ–π –∏–Ω–∏—Ü–∏–∞—Ü–∏–µ–π - –û–°–û–ë–´–ô –°–õ–£–ß–ê–ô!
                    // –î–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ 1-2 –ù–ï –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –∑–¥–µ—Å—å!
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ /api/test-call –∏ –æ–Ω —Å–∞–º —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ 27 —Å–æ–±—ã—Ç–∏–π
                    return []; // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ - —Å–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                    break;
                    
                default:
                    // –û–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ (–≤—Ä–µ–º–µ–Ω–Ω–æ)
                    events.push({
                        step: 1,
                        event: 'CALL_START',
                        description: `–ù–∞—á–∞–ª–æ –∑–≤–æ–Ω–∫–∞ —Ç–∏–ø–∞ ${callTypeId} (–ø–∞—Ç—Ç–µ—Ä–Ω –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω)`,
                        data: { 
                            call_type: callTypeId,
                            token: token,
                            note: "–ü–∞—Ç—Ç–µ—Ä–Ω –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –∑–≤–æ–Ω–∫–∞"
                        }
                    });
                    break;
            }
            
            return events;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –ª–æ–≥–µ
        function addEventToLog(event) {
            const eventsLog = document.getElementById('eventsLog');
            
            const timestamp = new Date().toLocaleTimeString();
            const eventDiv = document.createElement('div');
            eventDiv.style.marginBottom = '20px';
            eventDiv.style.paddingBottom = '20px';
            eventDiv.style.borderBottom = '2px solid #e9ecef';
            
            eventDiv.innerHTML = `
                <div style="font-size: 20px; color: #000; line-height: 1.2; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-weight: 500;">
                    <div>[${timestamp}] –®–∞–≥ ${event.step}: ${event.event}</div>
                    <div style="margin-top: 8px; font-size: 20px; color: #666; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-weight: 500;">
                        ${event.description}
                    </div>
                    <div style="margin-top: 12px; font-size: 20px; color: #333; background: #f8f9fa; padding: 15px; border-left: 4px solid #007bff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-weight: 500; white-space: pre-wrap; overflow-x: auto;">
${JSON.stringify(event.data, null, 2)}
                    </div>
                </div>
            `;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤ –Ω–∞—á–∞–ª–æ (–≤–≤–µ—Ä—Ö)
            eventsLog.insertBefore(eventDiv, eventsLog.firstChild);
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –Ω–∞–≤–µ—Ä—Ö –∫ –Ω–æ–≤–æ–º—É —Å–æ–±—ã—Ç–∏—é
            eventsLog.scrollTop = 0;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ –≤ –∂—É—Ä–Ω–∞–ª
        function addServerResponseToLog(status, responseData, eventType) {
            const eventsLog = document.getElementById('eventsLog');
            const responseDiv = document.createElement('div');
            responseDiv.style.cssText = `
                margin: 15px 0;
                padding: 15px;
                border-left: 4px solid ${status === 200 || status === 'OK' ? '#28a745' : status === 'ERROR' ? '#dc3545' : '#ffc107'};
                background-color: #f8f9fa;
                font-family: sans-serif;
                font-size: 20px;
                font-weight: 500;
                color: #333;
            `;
            
            const timestamp = new Date().toLocaleTimeString('ru-RU');
            const statusText = status === 'ERROR' ? '–û–®–ò–ë–ö–ê' : `HTTP ${status}`;
            const statusColor = status === 200 || status === 'OK' ? '#28a745' : status === 'ERROR' ? '#dc3545' : '#ffc107';
            
            responseDiv.innerHTML = `
                <div style="font-family: sans-serif; font-size: 20px; font-weight: 500; color: #666; margin-bottom: 10px;">
                    [${timestamp}] –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ ${eventType}: 
                    <span style="color: ${statusColor}; font-weight: 500;">${statusText}</span>
                </div>
                <div style="font-family: sans-serif; font-size: 20px; font-weight: 500; color: #333; margin: 5px 0; white-space: pre-wrap; background: #fff; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">${JSON.stringify(responseData, null, 2)}</div>
            `;
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ –∂—É—Ä–Ω–∞–ª–∞ (—Å–∞–º—ã–µ –Ω–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã —Å–≤–µ—Ä—Ö—É)
            eventsLog.insertBefore(responseDiv, eventsLog.firstChild);
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –Ω–∞–≤–µ—Ä—Ö –∫ –Ω–æ–≤–æ–º—É –æ—Ç–≤–µ—Ç—É
            eventsLog.scrollTop = 0;
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        async function sendEventToServer(event) {
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ bot.vochi.by
                const eventType = event.event.toLowerCase();
                const url = `https://bot.vochi.by/${eventType}`;
                
                // –ó–∞–º–µ–Ω—è–µ–º <–•–†–ï–ù> –Ω–∞ <unknown> –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const dataToSend = JSON.parse(JSON.stringify(event.data).replace(/<–•–†–ï–ù>/g, '<unknown>'));
                
                // –õ–æ–≥–∏—Ä—É–µ–º —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
                console.log('üöÄ –û–¢–ü–†–ê–í–õ–Ø–ï–ú –ù–ê –°–ï–†–í–ï–†:', JSON.stringify(dataToSend, null, 2));
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Token': event.data.Token
                    },
                    body: JSON.stringify(dataToSend)
                });
                
                const responseText = await response.text();
                let responseData;
                try {
                    responseData = JSON.parse(responseText);
                } catch {
                    responseData = { raw_response: responseText };
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç–≤–µ—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤ –∂—É—Ä–Ω–∞–ª
                addServerResponseToLog(response.status, responseData, eventType);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${responseText}`);
                }
                
                return { success: true, status: response.status, data: responseData };
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è:', error);
                // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ –≤ –∂—É—Ä–Ω–∞–ª  
                addServerResponseToLog('ERROR', { error: error.message }, event.event);
                // –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–º—É–ª—è—Ü–∏—é –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
                return { success: false, error: error.message };
            }
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞ —ç–º—É–ª—è—Ü–∏–∏
        async function executeEmulationStep() {
            if (emulatorState.currentStep >= emulatorState.events.length) {
                stopEmulation('completed');
                return;
            }
            
            const event = emulatorState.events[emulatorState.currentStep];
            
            // –õ–æ–≥–∏—Ä—É–µ–º —á—Ç–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è
            console.log('üìù –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–û –î–õ–Ø –ë–†–ê–£–ó–ï–†–ê:', JSON.stringify(event, null, 2));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ –ª–æ–≥–µ
            addEventToLog(event);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ–º —ç–º—É–ª—è—Ü–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–µ)
            try {
                await sendEventToServer(event);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–±—ã—Ç–∏—è:', error);
            }
            
            emulatorState.currentStep++;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            updateEmulatorStatus(`–®–∞–≥ ${emulatorState.currentStep}/${emulatorState.events.length}`, 'info');
            
            // –ï—Å–ª–∏ –∞–≤—Ç–æ-—Ä–µ–∂–∏–º –∏ –µ—Å—Ç—å –µ—â–µ —à–∞–≥–∏
            if (emulatorState.mode === 'auto' && emulatorState.currentStep < emulatorState.events.length) {
                emulatorState.autoInterval = setTimeout(executeEmulationStep, 2000);
            } else if (emulatorState.currentStep >= emulatorState.events.length) {
                stopEmulation('completed');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞
        function updateEmulatorStatus(message, type = 'info') {
            const statusElement = document.getElementById('emulatorCurrentStatus');
            const statusText = document.getElementById('statusText');
            
            if (statusElement) {
                statusElement.className = `badge bg-${type === 'info' ? 'primary' : type === 'danger' ? 'danger' : 'secondary'}`;
                statusElement.textContent = message;
            }
            
            if (statusText) {
                statusText.textContent = message;
            }
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–º—É–ª—è—Ü–∏–∏
        function stopEmulation(reason = 'stopped') {
            emulatorState.isRunning = false;
            
            if (emulatorState.autoInterval) {
                clearTimeout(emulatorState.autoInterval);
                emulatorState.autoInterval = null;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.getElementById('autoEmulateBtn').disabled = false;
            document.getElementById('manualEmulateBtn').disabled = false;
            document.getElementById('resetEmulateBtn').disabled = false;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            switch(reason) {
                case 'completed':
                    updateEmulatorStatus('–ó–∞–≤–µ—Ä—à–µ–Ω–æ', 'success');
                    break;
                case 'error':
                    updateEmulatorStatus('–û—à–∏–±–∫–∞', 'danger');
                    break;
                default:
                    updateEmulatorStatus('–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'secondary');
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫ —ç–º—É–ª—è—Ç–æ—Ä–∞
        document.getElementById('autoEmulateBtn').addEventListener('click', function() {
            startEmulation('auto');
        });

        document.getElementById('manualEmulateBtn').addEventListener('click', function() {
            if (!emulatorState.isRunning) {
                startEmulation('manual');
            } else {
                // –í —Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ - –≤—ã–ø–æ–ª–Ω—è–µ–º —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥
                executeEmulationStep();
            }
        });

        document.getElementById('resetEmulateBtn').addEventListener('click', function() {
            resetEmulation();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è intl-tel-input
        let phoneInputWidget = null;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —Å libphonenumber
        function validatePhoneNumber(number) {
            try {
                if (!number.startsWith('+')) return true; // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –Ω–æ–º–µ—Ä–∞
                const phoneNumber = libphonenumber.parsePhoneNumberFromString(number);
                return phoneNumber ? phoneNumber.isValid() : false;
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ ${number}:`, error);
                return false; // –°—á–∏—Ç–∞–µ–º –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º –ø—Ä–∏ –æ—à–∏–±–∫–µ
            }
        }

        // –ì–ï–ù–ï–†–ê–¶–ò–Ø —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–∞–ª–∏–¥–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º libphonenumber
        function generateRandomPhone(countryCode) {
            if (!window.libphonenumber) return '';

            const countryCodeUpper = countryCode.toUpperCase();
            const maxAttempts = 50; // –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            
            for (let attempt = 0; attempt < maxAttempts; attempt++) {
                try {
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –Ω–æ–º–µ—Ä
                    let nationalNumber = '';
                    
                    // –†–∞–∑–Ω—ã–µ –¥–ª–∏–Ω—ã –Ω–æ–º–µ—Ä–æ–≤ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ç—Ä–∞–Ω
                    const numberLength = {
                        'BY': 9,   // –ë–µ–ª–∞—Ä—É—Å—å: 9 —Ü–∏—Ñ—Ä
                        'RU': 10,  // –†–æ—Å—Å–∏—è: 10 —Ü–∏—Ñ—Ä 
                        'PL': 9,   // –ü–æ–ª—å—à–∞: 9 —Ü–∏—Ñ—Ä
                        'LT': 8,   // –õ–∏—Ç–≤–∞: 8 —Ü–∏—Ñ—Ä
                        'LV': 8,   // –õ–∞—Ç–≤–∏—è: 8 —Ü–∏—Ñ—Ä
                        'US': 10,  // –°–®–ê: 10 —Ü–∏—Ñ—Ä
                        'EE': 7,   // –≠—Å—Ç–æ–Ω–∏—è: 7 —Ü–∏—Ñ—Ä
                        'JP': 10,  // –Ø–ø–æ–Ω–∏—è: 10 —Ü–∏—Ñ—Ä
                        'FR': 9,   // –§—Ä–∞–Ω—Ü–∏—è: 9 —Ü–∏—Ñ—Ä
                        'IT': 9,   // –ò—Ç–∞–ª–∏—è: 9 —Ü–∏—Ñ—Ä
                        'ES': 9,   // –ò—Å–ø–∞–Ω–∏—è: 9 —Ü–∏—Ñ—Ä
                        'MD': 8,   // –ú–æ–ª–¥–æ–≤–∞: 8 —Ü–∏—Ñ—Ä
                        'KZ': 10,  // –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω: 10 —Ü–∏—Ñ—Ä
                        'AR': 10,  // –ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞: 10 —Ü–∏—Ñ—Ä
                        'AM': 8,   // –ê—Ä–º–µ–Ω–∏—è: 8 —Ü–∏—Ñ—Ä
                        'GE': 9    // –ì—Ä—É–∑–∏—è: 9 —Ü–∏—Ñ—Ä
                    };

                    const length = numberLength[countryCodeUpper] || 9;
                    
                    // –ü–µ—Ä–≤–∞—è —Ü–∏—Ñ—Ä–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å 0 –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å—Ç—Ä–∞–Ω
                    nationalNumber = (Math.floor(Math.random() * 9) + 1).toString();
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã
                    for (let i = 1; i < length; i++) {
                        nationalNumber += Math.floor(Math.random() * 10).toString();
                    }

                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–º–µ—Ä —á–µ—Ä–µ–∑ libphonenumber
                    const phoneNumber = libphonenumber.parsePhoneNumberFromString(nationalNumber, countryCodeUpper);
                    
                    if (phoneNumber && phoneNumber.isValid()) {
                        return phoneNumber.format('E.164');
                    }
                } catch (error) {
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏
                    continue;
                }
            }
            
            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
            return '';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –Ω–∞ —Ñ–ª–∞–≥–∏
        function initCountryFlags() {
            const flagButtons = document.querySelectorAll('.country-flag');
            flagButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const countryCode = this.getAttribute('data-country');
                    const randomPhone = generateRandomPhone(countryCode);
                    
                    if (randomPhone && phoneInputWidget) {
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä –≤ –≤–∏–¥–∂–µ—Ç
                        phoneInputWidget.setNumber(randomPhone);
                        
                        // –¢—Ä–∏–≥–≥–µ—Ä–∏–º —Å–æ–±—ã—Ç–∏–µ input –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
                        const phoneInput = document.getElementById('external_phone_input');
                        phoneInput.dispatchEvent(new Event('input'));
                        
                        // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                        this.style.background = '#28a745';
                        this.style.transform = 'scale(1.1)';
                        setTimeout(() => {
                            this.style.background = 'transparent';
                            this.style.transform = 'scale(1)';
                        }, 300);
                    }
                });
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const phoneInput = document.getElementById('external_phone_input');
            if (phoneInput && window.intlTelInput) {
                phoneInputWidget = window.intlTelInput(phoneInput, {
                    utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/20.3.0/js/utils.js",
                    nationalMode: false,      // –ù–æ–º–µ—Ä –≤—Å–µ–≥–¥–∞ –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
                    separateDialCode: true,   // –ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã –±—É–¥–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –Ω–æ–º–µ—Ä–∞
                    // –ë–µ–∑ –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç —Å—Ç—Ä–∞–Ω—É
                });

                // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                phoneInput.addEventListener('input', function() {
                    const phone = phoneInputWidget.getNumber();
                    if (phone === '') {
                        this.classList.remove('is-valid', 'is-invalid');
                        return;
                    }
                    
                    if (validatePhoneNumber(phone)) {
                        this.classList.remove('is-invalid');
                        this.classList.add('is-valid');
                    } else {
                        this.classList.remove('is-valid');
                        this.classList.add('is-invalid');
                    }
                });
            }
        });

        // –ó–∞–ø—É—Å–∫ —ç–º—É–ª—è—Ü–∏–∏
        function startEmulation(mode) {
            const form = document.getElementById('testForm');
            const formData = new FormData(form);
            const callTypeId = formData.get('call_type');
            const externalPhone = formData.get('external_phone');
            
            if (!callTypeId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∑–≤–æ–Ω–∫–∞');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–Ω–µ—à–Ω–∏–π –Ω–æ–º–µ—Ä –¥–ª—è —Ç–∏–ø–æ–≤ –∑–≤–æ–Ω–∫–æ–≤ –≥–¥–µ –æ–Ω –Ω—É–∂–µ–Ω
            const needsExternalPhone = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41];
            
            if (needsExternalPhone.includes(parseInt(callTypeId))) {
                // –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä –∏–∑ intl-tel-input –≤–∏–¥–∂–µ—Ç–∞
                const phoneNumber = phoneInputWidget ? phoneInputWidget.getNumber() : externalPhone;
                
                if (!phoneNumber || phoneNumber.trim() === '') {
                    alert('–í–≤–µ–¥–∏—Ç–µ –≤–Ω–µ—à–Ω–∏–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
                    document.getElementById('external_phone_input').focus();
                    return;
                }
                
                if (!validatePhoneNumber(phoneNumber.trim())) {
                    alert('–û—à–∏–±–∫–∞: –í–Ω–µ—à–Ω–∏–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤–≤–µ–¥–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞.');
                    document.getElementById('external_phone_input').focus();
                    return;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º formData —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º
                formData.set('external_phone', phoneNumber.trim());
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø –∑–≤–æ–Ω–∫–∞ - –¥–ª—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ 1-2 –æ—Å–æ–±–∞—è –ª–æ–≥–∏–∫–∞
            if (parseInt(callTypeId) === 2) {
                // –ü–∞—Ç—Ç–µ—Ä–Ω 1-2: –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ä–∞–∑—É –Ω–∞ API
                document.getElementById('eventsPanel').style.display = 'block';
                document.getElementById('emulatorStatus').style.display = 'block';
                updateEmulatorStatus('–û—Ç–ø—Ä–∞–≤–ª—è–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω 1-2 (27 —Å–æ–±—ã—Ç–∏–π)...', 'primary');
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏
                document.getElementById('autoEmulateBtn').disabled = true;
                document.getElementById('manualEmulateBtn').disabled = true;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ API
                executePattern1_2(formData);
                return;
            }
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
            emulatorState.events = generateEventsForPattern(callTypeId, formData);
            emulatorState.mode = mode;
            emulatorState.currentStep = 0;
            emulatorState.isRunning = true;
            emulatorState.callData = formData;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Å–æ–±—ã—Ç–∏–π
            document.getElementById('eventsPanel').style.display = 'block';
            document.getElementById('emulatorStatus').style.display = 'block';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            if (mode === 'auto') {
                document.getElementById('autoEmulateBtn').disabled = true;
                document.getElementById('manualEmulateBtn').disabled = true;
                updateEmulatorStatus('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º', 'primary');
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–π —à–∞–≥
                executeEmulationStep();
            } else {
                document.getElementById('autoEmulateBtn').disabled = true;
                document.getElementById('manualEmulateBtn').innerHTML = '<i class="fas fa-step-forward"></i> –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥';
                updateEmulatorStatus('–†—É—á–Ω–æ–π —Ä–µ–∂–∏–º - –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–∞', 'warning');
            }
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ 1-2
        async function executePattern1_2(formData) {
            try {
                addEventToLog({
                    step: 1,
                    event: 'PATTERN_1_2_START',
                    description: '–ó–∞–ø—É—Å–∫ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ 1-2 (27 —Å–æ–±—ã—Ç–∏–π)',
                    data: { note: '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π...' }
                });

                const response = await fetch('/api/test-call', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    addEventToLog({
                        step: 2,
                        event: 'PATTERN_1_2_SUCCESS',
                        description: `–ü–∞—Ç—Ç–µ—Ä–Ω 1-2 –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!`,
                        data: {
                            events_sent: result.details.events_sent,
                            unique_id: result.details.unique_id,
                            message: result.message
                        }
                    });
                    updateEmulatorStatus(`‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ! –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${result.details.events_sent} —Å–æ–±—ã—Ç–∏–π`, 'success');
                } else {
                    throw new Error(result.message || '–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ 1-2');
                }
            } catch (error) {
                addEventToLog({
                    step: 2,
                    event: 'PATTERN_1_2_ERROR',
                    description: '–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ 1-2',
                    data: { error: error.message }
                });
                updateEmulatorStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'danger');
            } finally {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                document.getElementById('autoEmulateBtn').disabled = false;
                document.getElementById('manualEmulateBtn').disabled = false;
                document.getElementById('manualEmulateBtn').innerHTML = '<i class="fas fa-cogs"></i> –†—É—á–Ω–∞—è';
            }
        }

        // –°–±—Ä–æ—Å —ç–º—É–ª—è—Ü–∏–∏
        function resetEmulation() {
            stopEmulation('reset');
            
            emulatorState = {
                mode: null,
                currentStep: 0,
                events: [],
                isRunning: false,
                autoInterval: null,
                callData: null
            };
            
            // –û—á–∏—â–∞–µ–º –ª–æ–≥
            clearEvents();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª–∏
            document.getElementById('eventsPanel').style.display = 'none';
            document.getElementById('emulatorStatus').style.display = 'none';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
            document.getElementById('manualEmulateBtn').innerHTML = '<i class="fas fa-step-forward"></i> –†—É—á–Ω–∞—è';
            updateEmulatorStatus('–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'secondary');
        }

        // –û—á–∏—Å—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
        function clearEvents() {
            const eventsLog = document.getElementById('eventsLog');
            eventsLog.innerHTML = '';
        }

        // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        function showResult(result) {
            const panel = document.getElementById('resultPanel');
            const content = document.getElementById('resultContent');
            
            const successIcon = result.success ? '‚úÖ' : '‚ùå';
            const statusClass = result.success ? 'text-success' : 'text-danger';
            
            let html = `
                <div class="row">
                    <div class="col-md-8">
                        <h6 class="${statusClass}">
                            ${successIcon} ${result.message}
                        </h6>
                        <p><strong>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID:</strong> ${result.details.unique_id}</p>
                        <p><strong>–°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:</strong> ${result.details.events_sent}/4</p>
                        <p><strong>–û—à–∏–±–æ–∫:</strong> ${result.details.events_failed}</p>
            `;
            
            if (result.details.errors && result.details.errors.length > 0) {
                html += `<p><strong>–û—à–∏–±–∫–∏:</strong></p><ul>`;
                result.details.errors.forEach(error => {
                    html += `<li class="text-danger">${error}</li>`;
                });
                html += `</ul>`;
            }
            
            html += `</div></div>`;
            
            content.innerHTML = html;
            panel.classList.add('show');
            
            // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            panel.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // –ü—Ä–µ–≤—å—é Telegram
        function previewTelegram() {
            const modal = new bootstrap.Modal(document.getElementById('telegramModal'));
            const preview = document.getElementById('telegramPreview');
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
            const formData = new FormData(document.getElementById('testForm'));
            const callType = parseInt(formData.get('call_type'));
            const externalPhone = formData.get('external_phone');
            const internalPhone = formData.get('internal_phone');
            const lineId = formData.get('line_id');
            const callStatus = parseInt(formData.get('call_status'));
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–µ–≤—å—é
            const manager = managers[internalPhone];
            const line = lines[lineId];
            const callTypeName = callTypes.find(ct => ct.id === callType)?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
            const statusText = callStatus === 2 ? '–£—Å–ø–µ—à–Ω—ã–π' : '–ù–µ—É–¥–∞—á–Ω—ã–π';
            const statusIcon = callStatus === 2 ? '‚úÖ' : '‚ùå';
            const callDirection = callType === 0 ? '–≤—Ö–æ–¥—è—â–∏–π' : (callType === 1 ? '–∏—Å—Ö–æ–¥—è—â–∏–π' : '–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π');
            
            let telegramText = `${statusIcon} ${statusText} ${callDirection} –∑–≤–æ–Ω–æ–∫\\n`;
            
            if (callType === 0) { // –í—Ö–æ–¥—è—â–∏–π
                telegramText += `${externalPhone}\\n`;
                telegramText += `${manager ? manager.name : `–î–æ–±.${internalPhone}`}\\n`;
            } else if (callType === 1) { // –ò—Å—Ö–æ–¥—è—â–∏–π  
                telegramText += `${externalPhone}\\n`;
                telegramText += `${manager ? manager.name : `–î–æ–±.${internalPhone}`}\\n`;
            } else { // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π
                telegramText += `${manager ? manager.name : `–î–æ–±.${internalPhone}`} ‚Üí ${externalPhone}\\n`;
            }
            
            telegramText += `üì°${line ? line.name : `–õ–∏–Ω–∏—è ${lineId}`}\\n`;
            telegramText += `‚åõ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: ${formData.get('duration_minutes')}:00\\n`;
            
            if (callStatus === 2) {
                telegramText += `üîâ–ó–∞–ø–∏—Å—å —Ä–∞–∑–≥–æ–≤–æ—Ä–∞`;
            }
            
            preview.innerHTML = `
                <div class="telegram-message" style="
                    background: #0088cc;
                    color: white;
                    padding: 15px;
                    border-radius: 15px;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
                    max-width: 400px;
                    margin: 0 auto;
                    white-space: pre-line;
                ">
                    ${telegramText.replace(/\\n/g, '\\n')}
                </div>
                <div class="text-center mt-3">
                    <small class="text-muted">
                        üí° –≠—Ç–æ –ø—Ä–µ–≤—å—é —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–±–æ–≥–∞—â–µ–Ω–∏–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
                    </small>
                </div>
            `;
            
            modal.show();
        }
    </script>
    
    <!-- International Telephone Input -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/20.3.0/js/intlTelInput.min.js"></script>
    <!-- libphonenumber for validation -->
    <script src="https://unpkg.com/libphonenumber-js@1.11.1/bundle/libphonenumber-js.min.js"></script>
</body>
</html>
