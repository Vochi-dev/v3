# Desk Service - Сервис-заглушка

## Обзор
Desk Service - это сервис-заглушка, созданный для будущего функционала системы Asterisk Webhook. Сервис работает на порту 8011 и предоставляет базовый API для тестирования и подготовки к внедрению дополнительной функциональности.

## Технические характеристики

- **Порт**: 8011
- **Технология**: FastAPI + Uvicorn
- **Автозапуск**: Интегрирован в all.sh
- **Логирование**: desk_service.log
- **PID файл**: .uvicorn_desk.pid

## Файлы сервиса

### Основные файлы
- `desk.py` - Основной код сервиса на Python
- `desk.sh` - Скрипт управления сервисом
- `desk_service.log` - Файл логов
- `.uvicorn_desk.pid` - PID файл запущенного процесса

## API Эндпоинты

### GET /
Корневой эндпоинт - возвращает HTML страницу рабочего стола
- **Параметр**: `enterprise` (опционально) - название предприятия
- **Пример**: `http://localhost:8011?enterprise=June`
- **Результат**: HTML страница с заголовком "Рабочий стол June"
- **Фавиконы**: Полная поддержка всех современных форматов
- **Дизайн**: Современный интерфейс с градиентным фоном

### GET /api
API эндпоинт - возвращает JSON информацию о сервисе
```json
{
    "service": "Desk Service",
    "status": "running", 
    "message": "Сервис-заглушка работает",
    "version": "1.0.0",
    "port": 8011,
    "timestamp": "2025-07-18T04:47:44.520419"
}
```

### GET /health
Проверка здоровья сервиса
```json
{
    "health": "healthy",
    "uptime": "0:00:11.441341",
    "service": "desk-service"
}
```

### GET /status
Получение статуса сервиса
```json
{
    "status": "active",
    "message": "Desk сервис работает нормально",
    "timestamp": "2025-07-18T04:47:44.520419",
    "version": "1.0.0"
}
```

### GET /info
Детальная информация о сервисе
```json
{
    "name": "Desk Service",
    "description": "Сервис-заглушка для будущего функционала",
    "version": "1.0.0",
    "port": 8011,
    "endpoints": ["/", "/health", "/status", "/info", "/ping"],
    "started_at": "2025-07-18T04:46:43.269675",
    "uptime_seconds": 13.272004
}
```

### GET /ping
Простой ping для проверки доступности
```json
{
    "ping": "pong",
    "timestamp": "2025-07-18T04:47:44.520419"
}
```

### POST /test
Тестовый эндпоинт для приема данных
```bash
curl -X POST http://localhost:8011/test \
     -H "Content-Type: application/json" \
     -d '{"test": "data"}'
```
```json
{
    "message": "Тестовый эндпоинт работает",
    "received_data": {"test": "data"},
    "timestamp": "2025-07-18T04:47:01.690032"
}
```

## Управление сервисом

### Команды desk.sh
```bash
# Запуск сервиса
./desk.sh start

# Остановка сервиса  
./desk.sh stop

# Перезапуск сервиса
./desk.sh restart

# Проверка статуса
./desk.sh status

# Просмотр логов
./desk.sh logs

# Тестирование
./desk.sh test
```

### Управление через all.sh
Сервис интегрирован в общую систему управления:
```bash
# Перезапуск всех сервисов (включая desk)
./all.sh restart

# Запуск всех сервисов
./all.sh start

# Остановка всех сервисов  
./all.sh stop
```

## Интеграция с системой

### Автозапуск
Сервис добавлен в список `SERVICES` в файле `all.sh`:
```bash
SERVICES=("admin" "dial" "111" "plan" "sms" "download" "goip" "desk")
```

### Интеграция с модалкой дашборда
В `app/templates/dashboard.html` добавлена кнопка "Рабочий стол":
- Занимает 50% ширины модалки (вторая половина от кнопки "Войти в админку")
- Зеленый цвет (#28a745)
- Автоматически передает имя предприятия в URL параметре `enterprise`
- Открывается в новой вкладке

### Передача параметров
```javascript
// JavaScript в модалке автоматически добавляет имя предприятия
const enterpriseName = encodeURIComponent(name);
window.open('http://' + window.location.hostname + ':8011?enterprise=' + enterpriseName, '_blank');
```

## Мониторинг

### Проверка работоспособности
```bash
# Проверка порта
netstat -tlnp | grep :8011

# HTTP проверка
curl http://localhost:8011/health

# Проверка процесса
ps aux | grep desk
```

### Логи
```bash
# Просмотр логов
tail -f desk_service.log

# Через скрипт управления
./desk.sh logs
```

## Будущее развитие

Данный сервис создан как заглушка для будущего функционала. Возможные направления развития:

1. **Интеграция с внешними системами** - API для работы с CRM, ERP
2. **Дополнительная обработка данных** - аналитика, отчеты  
3. **Webhook endpoints** - прием уведомлений от внешних сервисов
4. **Кэширование и буферизация** - промежуточное хранение данных
5. **Микросервисная архитектура** - разделение функций на отдельные сервисы

## Безопасность

- CORS настроен для разрешения всех источников (подходит для внутренней сети)
- Обработчики ошибок 404 и 500 настроены
- Логирование всех операций

## Зависимости

- FastAPI
- Uvicorn  
- Pydantic
- Python 3.x

---
**Создано**: 18 июля 2025  
**Версия**: 1.0.0  
**Статус**: ✅ Активно  
**Порт**: 8011 