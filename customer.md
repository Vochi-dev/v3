# Customers: –º–æ–¥–µ–ª—å –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Ç—Ä–µ–∫–µ—Ä –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

## –¶–µ–ª—å
–ï–¥–∏–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ (–ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É) —Å –±—ã—Å—Ç—Ä—ã–º–∏ –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏ –¥–ª—è Telegram/–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π –∫ mini‚ÄëCRM.

## –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞ (—Ç–∞–±–ª–∏—Ü–∞ `customers`)
–ö–ª—é—á: `(enterprise_number, phone_e164)` ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω —Å—Ç—Ä–æ–≥–æ –≤ E.164.

–ü–æ–ª—è:
- `id` bigint PK (serial/identity)
- `enterprise_number` text NOT NULL
- `phone_e164` text NOT NULL
- `first_seen_at` timestamptz
- `last_seen_at` timestamptz
- –°—á—ë—Ç—á–∏–∫–∏ –∏ —Å—Ç–∞—Ç—É—Å:
  - `calls_total_in` int DEFAULT 0
  - `calls_total_out` int DEFAULT 0
  - `calls_answered_in` int DEFAULT 0
  - `calls_answered_out` int DEFAULT 0
  - `calls_missed_in` int DEFAULT 0
  - `calls_missed_out` int DEFAULT 0
  - `last_call_at` timestamptz
  - `last_call_direction` text CHECK in ('in','out','internal','unknown')
  - `last_call_status` text CHECK in ('answered','missed','unknown')
  - `last_success_at` timestamptz NULL
  - `last_agent_internal` text NULL      # –∫—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ–≤–æ—Ä–∏–ª (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–¥)
  - `last_line` text NULL                # –ø–æ –∫–∞–∫–æ–π –≤–Ω–µ—à–Ω–µ–π –ª–∏–Ω–∏–∏
- Mini‚ÄëCRM –ø–æ–ª—è (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ):
  - `field1` varchar(100) NULL
  - `field2` varchar(100) NULL
  - `field3` varchar(100) NULL
  - `field4` varchar(100) NULL
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
  - `black_list` boolean DEFAULT false   # –ø—Ä–∞–≤–∏–ª–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–∏–º –æ—Ç–¥–µ–ª—å–Ω–æ
  - `meta` jsonb NULL                    # —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–µ –º–µ—Å—Ç–æ (—Ç–µ–≥–∏, –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
- –§–ò–û –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è:
  - `last_name` varchar(100) NULL
  - `first_name` varchar(100) NULL
  - `middle_name` varchar(100) NULL
  - `enterprise_name` varchar(200) NULL

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è/–∏–Ω–¥–µ–∫—Å—ã:
- UNIQUE (enterprise_number, phone_e164)
- btree (enterprise_number, last_call_at DESC)

## –ü–æ—Ç–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (live –∏ recovery)
–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚Äî —Å–æ–±—ã—Ç–∏–µ `hangup` (–∑–Ω–∞–µ–º –∏—Å—Ö–æ–¥ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å). –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–æ–≥–æ –ø—Ä–∏ `hangup`:
1) –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –Ω–æ–º–µ—Ä (—É–∂–µ –µ—Å—Ç—å).
2) UPSERT –≤ `customers` –ø–æ `(enterprise_number, phone_e164)`:
   - –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî INSERT —Å `first_seen_at = now()`;
   - –≤—Å–µ–≥–¥–∞: `last_seen_at = now()`, `last_call_at`, `last_call_direction`, `last_call_status`, `last_line`, `last_agent_internal`;
   - –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤ `*_in/*_out` –∏ `answered/missed`;
   - –µ—Å–ª–∏ —É—Å–ø–µ—à–Ω—ã–π –∑–≤–æ–Ω–æ–∫ ‚Äî `last_success_at = now()`.
3) –í–∞–∂–Ω–æ –¥–ª—è Telegram ¬´–¥–æ —ç—Ç–æ–≥–æ¬ª: –ø–µ—Ä–µ–¥ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–º –¥–µ–ª–∞–µ–º SELECT —Ç–µ–∫—É—â–∏—Ö —Å—á—ë—Ç—á–∏–∫–æ–≤; —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –∏ —Ç–æ–ª—å–∫–æ –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω—è–µ–º UPDATE/UPSERT.
4) –ò—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–±—ã—Ç–∏—è:
   - live (8000): –æ–±–Ω–æ–≤–ª—è–µ—Ç `customers` —Å—Ä–∞–∑—É –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ `hangup`;
   - recovery (8007): –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—É –∂–µ –ª–æ–≥–∏–∫—É UPSERT –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π. –î–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –Ω–æ–º–µ—Ä –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–∞ –Ω–∞—á–∞–ª–∞/–æ–∫–æ–Ω—á–∞–Ω–∏—è (–±–µ—Ä—É—Ç—Å—è –∏–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏—è).

## –ö–∞—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
- 8000 (start/dial/bridge/hangup):
  - –ø—Ä–∏ `hangup` ‚Äî —á—Ç–µ–Ω–∏–µ ¬´—Å—Ç–∞—Ä—ã—Ö¬ª —Å—á—ë—Ç—á–∏–∫–æ–≤ ‚Üí —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Telegram ‚Üí UPSERT –∞–≥—Ä–µ–≥–∞—Ç–æ–≤.
- 8007 (download/recovery):
  - –ø—Ä–∏ –¥–æ–∑–∞–ª–∏–≤–∫–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π `hangup` ‚Äî –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç–æ—Ç –∂–µ UPSERT (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ –ø–æ `(enterprise, phone, start/end)` –ª–∏–±–æ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É `UniqueId` —Å–æ–±—ã—Ç–∏—è).
- 8020: –ù–ï –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫—ç—à ¬´customer-facts¬ª (TTL 60‚Äì120—Å) –¥–ª—è —Ä–∞–∑–≥—Ä—É–∑–∫–∏ –ë–î –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö.

## –ü–æ–ª–∏—Ç–∏–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞
- –ù–∞ –≤—Ö–æ–¥–µ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ `incoming_transform` –¥–ª—è –ª–∏–Ω–∏–π; –≤ —Ç–∞–±–ª–∏—Ü—É `customers` –≤—Å–µ–≥–¥–∞ –ø–∏—à–µ–º E.164.

## –ü–æ–ª–∏—Ç–∏–∫–∞ –æ–±–æ–≥–∞—â–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è (–§–ò–û/–∫–æ–º–ø–∞–Ω–∏—è) - –û–ë–ù–û–í–õ–ï–ù–û 2025
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: –í–°–ï–ì–î–ê —Å–≤–µ–∂–∏–π –∑–∞–ø—Ä–æ—Å –∫ CRM (–±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω)
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è**: enterprise_name (–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏) ‚Üí –§–ò–û (–µ—Å–ª–∏ –∫–æ–º–ø–∞–Ω–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞)
- **–õ–æ–≥–∏–∫–∞ –æ–±–æ–≥–∞—â–µ–Ω–∏—è**: 
  - Live (8000): –ø—Ä–∏ `hangup` –¥–µ–ª–∞–µ—Ç—Å—è —Å–≤–µ–∂–∏–π –∑–∞–ø—Ä–æ—Å –∫ CRM —á–µ—Ä–µ–∑ integration_cache.py
  - –î–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ `customers` –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ Asterisk –¥–ª—è CallerID
  - Recovery (8007): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤
- **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∑—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `person_uid`, –≤—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
- **–ë–ï–ó –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**: –∫–∞–∂–¥—ã–π –∑–≤–æ–Ω–æ–∫ = —Å–≤–µ–∂–∏–π –∑–∞–ø—Ä–æ—Å –∫ CRM –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

## –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã –∫–ª–∏–µ–Ω—Ç–∞ (–±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–π)
–ò—Å—Ö–æ–¥–∏–º –∏–∑ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º—ã: –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –≤ `customers` = –æ–¥–∏–Ω –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (E.164). –°–≤—è–∑—å –Ω–æ–º–µ—Ä–æ–≤ –æ–¥–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑—É–µ–º —á–µ—Ä–µ–∑ –æ–±—â–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤ `meta`.

### –ö–ª—é—á–∏ –≤ `meta`
- (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏) `meta.uon_client_id`: ID –∫–ª–∏–µ–Ω—Ç–∞ –≤ U‚ÄëON. –†–∞–∑—Ä–µ—à–µ–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç (–µ–¥–∏–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤):
  - `meta.person_uid`: —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω—ã –≤–Ω—É—Ç—Ä–∏ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è; —Ñ–æ—Ä–º–∞—Ç `"<source>:<external_id>"` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–≤—è–∑—ã–≤–∞–Ω–∏–∏. –ù–µ –º–µ–Ω—è–µ—Ç—Å—è.
  - `meta.ids`: –æ–±—ä–µ–∫—Ç —Å–æ —Å–ø–∏—Å–∫–∞–º–∏ –≤–Ω–µ—à–Ω–∏—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    ```json
    { "uon": ["123"], "retail": ["456"], "phonebook": ["p-789"] }
    ```
  - `meta.primary_source`: `'uon' | 'retail' | 'phonebook' | 'manual'` ‚Äî –æ—Ç–∫—É–¥–∞ –±—Ä–∞—Ç—å –§–ò–û –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ.
  - (–æ–ø—Ü.) `meta.sources`: –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ `{ source, updated_at }` –¥–ª—è –∞—É–¥–∏—Ç–∞.

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –∏–∑ CRM (RetailCRM –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã)
- –ù–∞ –≤—Ö–æ–¥–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫ E.164.
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω—è–µ–º UPSERT –ø–æ `(enterprise_number, phone_e164)`:
  - –ø—Ä–∏ INSERT: –¥–æ–±–∞–≤–ª—è–µ–º –≤–Ω–µ—à–Ω–∏–π ID –≤ `meta.ids.<source>` (—Å–æ–∑–¥–∞—ë–º –º–∞—Å—Å–∏–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏);
    –µ—Å–ª–∏ `meta.person_uid` –ø—É—Å—Ç ‚Äî —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º `"<source>:<external_id>"` –∏–ª–∏ `"<source>_corporate:<company_id>"` –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö;
    –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –≥–ª–∞–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ ‚Äî –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–∞–≤–∏—Ç—å `meta.primary_source=<source>`.
  - –ø—Ä–∏ UPDATE: –º–µ—Ä–∂–∏–º `meta.ids.<source>` –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π; `meta.person_uid` –Ω–µ –º–µ–Ω—è–µ–º.
  - **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã**: –≤—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `person_uid` –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è
  - –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞/—á—Ç–µ–Ω–∏–µ `meta.uon_client_id`, –Ω–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî `meta.ids.uon`.

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –§–ò–û –∏–∑ CRM (–∞–∫—Ç—É–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ 2025)
- **–°–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –∫—ç—à–∞**: –∫–∞–∂–¥—ã–π –∑–≤–æ–Ω–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ CRM
- **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã**: —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç:
  - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ (`enterprise_name`) - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏
  - –§–ò–û –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–º–µ—Ä–∞
  - –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π `person_uid`
- **–ü—Ä–∞–≤–∏–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –§–ò–û**:
  - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –§–ò–û –∏–∑ CRM
  - `enterprise_name` –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏
  - –ù–µ–ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ CRM –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
- **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π**: `hangup` (live, 8000), `download` (8012) - –≤—Å–µ–≥–¥–∞ —á–µ—Ä–µ–∑ —Å–≤–µ–∂–∏–π API –∑–∞–ø—Ä–æ—Å

### –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- Live –ø–æ—Ç–æ–∫ `hangup` (8000) ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–æ—á–∫–∞ –∞–ø–¥–µ–π—Ç–∞.
- `download.py` (8012) –ø—Ä–∏ –¥–æ–∑–∞–ª–∏–≤–∫–µ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ ‚Äî –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç–æ—Ç –∂–µ –∞–ø–¥–µ–π—Ç (recovery).
- –í–µ–±—Ö—É–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (U‚ÄëON type 3/4, Retail –∞–Ω–∞–ª–æ–≥–∏, –±—É–¥—É—â–∞—è –∑–∞–ø–∏—Å–Ω–∞—è –∫–Ω–∏–∂–∫–∞) ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –§–ò–û/–Ω–æ–º–µ—Ä–∞ –≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–≤–æ–Ω–∫–æ–≤.

### –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- UPSERT –ø–æ `(enterprise_number, phone_e164)` —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –¥—É–±–ª–∏ –Ω–æ–º–µ—Ä–æ–≤.
- –ú–∞—Å—Å–æ–≤—ã–π –∞–ø–¥–µ–π—Ç –§–ò–û –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ —Ñ–∏–ª—å—Ç—Ä—É `person_uid` (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ) –ª–∏–±–æ –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É `meta.ids.<source>`; –æ–ø–µ—Ä–∞—Ü–∏—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞ (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–µ–º–∏ –∂–µ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏).
- –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–æ–¥–∏–º –∫ UTF‚Äë8, –æ–±—Ä–µ–∑–∞–µ–º –∏–∑–±—ã—Ç–æ—á–Ω—É—é –¥–ª–∏–Ω—É –ø–æ —Ä–∞–∑–º–µ—Ä–∞–º –∫–æ–ª–æ–Ω–æ–∫.

### –¢–µ—Å—Ç‚Äë–∫–µ–π—Å—ã
- –£ –∫–ª–∏–µ–Ω—Ç–∞ –¥–≤–∞ –Ω–æ–º–µ—Ä–∞ –≤ U‚ÄëON ‚Üí –æ–±–µ —Å—Ç—Ä–æ–∫–∏ —Å–æ–∑–¥–∞–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã, –§–ò–û –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ (–æ–¥–∏–Ω `person_uid`).
- –£ –∫–ª–∏–µ–Ω—Ç–∞ –æ–¥–∏–Ω –Ω–æ–º–µ—Ä –∏–∑ U‚ÄëON –∏ –≤—Ç–æ—Ä–æ–π –∏–∑ Retail ‚Üí –ø—Ä–∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏–∏ –ø–æ –≤–Ω–µ—à–Ω–∏–º ID —É –æ–±–æ–∏—Ö —Å—Ç—Ä–æ–∫ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `person_uid`; –§–ò–û –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –æ–±–µ–∏—Ö –ø—Ä–∏ –≥–ª–∞–≤–Ω–æ–º –∏—Å—Ç–æ—á–Ω–∏–∫–µ.
- –ò–∑–º–µ–Ω–∏–ª–∏ –§–ò–û –≤ U‚ÄëON ‚Üí –ø—Ä–∏—à—ë–ª webhook type 4 ‚Üí –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å —Ç–µ–º –∂–µ `person_uid` –æ–±–Ω–æ–≤–∏–ª–∏—Å—å.
- –ò—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–π ‚Üí –ø—É—Å—Ç—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–∏–ª–∏—Å—å, –Ω–µ–ø—É—Å—Ç—ã–µ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–ª–∏—Å—å.

## To‚ÄëDo (–º—É–ª—å—Ç–∏‚Äë–Ω–æ–º–µ—Ä–∞ –∏ –µ–¥–∏–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω—ã)
1) DDL –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é `customers.meta`.
2) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ø—Å–µ—Ä—Ç –∫–ª–∏–µ–Ω—Ç–∞ —Å –º–µ—Ä–∂–µ–º `meta.ids` –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π `meta.person_uid` (–µ—Å–ª–∏ –ø—É—Å—Ç):
   - –≤—Ö–æ–¥: `enterprise_number`, `phone_e164`, `source`, `external_id`, `fio`.
   - –ø—Ä–∞–≤–∏–ª–æ: UPSERT –ø–æ `(enterprise_number, phone_e164)`; merge JSONB –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π; –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –§–ò–û.
3) 8000 (live/hangup):
   - –≤—ã–∑—ã–≤–∞—Ç—å –∞–ø—Å–µ—Ä—Ç —Å–æ `source` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≥–ª–∞–≤–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏; –æ–±–Ω–æ–≤–ª—è—Ç—å –§–ò–û –ø–æ `person_uid`.
4) 8012 (download/recovery):
   - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –∞–ø—Å–µ—Ä—Ç –∏ –º–∞—Å—Å–æ–≤—ã–µ –∞–ø–¥–µ–π—Ç—ã –§–ò–û –ø–æ `person_uid`.
5) –í–µ–±—Ö—É–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (U‚ÄëON type 3/4 –∏ –¥–∞–ª–µ–µ):
   - –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å/–æ–±–Ω–æ–≤–ª—è—Ç—å `ids.<source>`, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å/—Å–æ—Ö—Ä–∞–Ω—è—Ç—å `person_uid` –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∞–ø–¥–µ–π—Ç–∏—Ç—å –§–ò–û.
6) –¢–µ—Å—Ç—ã SQL/–ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –º—ë—Ä–∂–∞ JSONB.

## –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è (backfill)
- –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π job: –ø—Ä–æ–π—Ç–∏ –ø–æ `calls` –∑–∞ –ø–µ—Ä–∏–æ–¥ ‚Üí –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª–æ–≥–∏—á–µ—Å–∫—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é, –∑–∞–ø–æ–ª–Ω–∏—Ç—å `customers`.
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–µ—à–∞–µ–º –ø–æ `last_call_at`/`last_success_at` (–±–µ—Ä—ë–º –º–∞–∫—Å–∏–º—É–º—ã).

## –¢–µ—Å—Ç-–∫–µ–π—Å—ã
- IN: —Å–µ—Ä–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –ø–æ –æ–¥–Ω–æ–º—É –Ω–æ–º–µ—Ä—É —Å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏/–æ—Ç–≤–µ—Ç–∞–º–∏ ‚Üí —Å—á—ë—Ç—á–∏–∫–∏ –∏ `last_*` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.
- OUT: –∏—Å—Ö–æ–¥—è—â–∏–µ –∫ —Ç–æ–º—É –∂–µ –Ω–æ–º–µ—Ä—É ‚Üí out‚Äë—Å—á—ë—Ç—á–∏–∫–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.
- Mixed: –≤—Ö–æ–¥—è—â–∏–π ‚Üí –∏—Å—Ö–æ–¥—è—â–∏–π ‚Üí –≤—Ö–æ–¥—è—â–∏–π.
- Recovery: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ `hangup` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).
- Blacklist: –ø–æ–ª–µ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏; –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ –ª–æ–º–∞–µ—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã.
- –ü–æ–ª—è field1..field4: CRUD –≤ –∞–¥–º–∏–Ω–∫–µ mini‚ÄëCRM (–≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á–∞—Ö).

## To‚ÄëDo
1) DDL: —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `customers` —Å –ø–æ–ª—è–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏, —á–µ–∫–∞–º–∏. [x]
2) 8000/hangup: SELECT —Ñ–∞–∫—Ç–æ–≤ ¬´–¥–æ —ç—Ç–æ–≥–æ¬ª + UPSERT –∞–≥—Ä–µ–≥–∞—Ç–æ–≤. [x]
3) 8007 (recovery): —Ç–æ—Ç –∂–µ UPSERT –Ω–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö `hangup`. [x]
4) (–û–ø—Ü.) 8020: GET `/customer-facts/{enterprise}/{phone}` (TTL) –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π. [ ]
5) Backfill –∏–∑ `calls` (—Å–∫—Ä–∏–ø—Ç –æ–¥–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞). [ ]
6) –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: –ø—Ä–æ—Å—Ç–∞—è –≤—ã–±–æ—Ä–∫–∞ ¬´—Ç–æ–ø –∫–ª–∏–µ–Ω—Ç–æ–≤ –∑–∞ N –¥–Ω–µ–π¬ª (SQL), –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π —Å `calls`. [ ]
7) –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ø—Ä–∞–≤–∏–ª–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ —á–∏—Ç–∞–µ–º ¬´–¥–æ —ç—Ç–æ–≥–æ¬ª, —Ñ–æ—Ä–º–∞—Ç—ã —Å—Ç–∞—Ç—É—Å–æ–≤. [ ]
8) –û–±–æ–≥–∞—â–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (live, 8000): –Ω–∞ `hangup` –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å fire‚Äëand‚Äëforget –∑–∞–ø—Ä–æ—Å –≤ 8020 –∑–∞ –ø—Ä–æ—Ñ–∏–ª–µ–º (–§–ò–û/enterprise_name). –ü–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ ‚Äî –æ–±–Ω–æ–≤–ª—è—Ç—å `customers` –∏, –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ message_id, –¥–µ–ª–∞—Ç—å edit —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –¢–µ–ª–µ–≥—Ä–∞–º (–¥–æ–±–∞–≤–ª—è—Ç—å ¬´–§–∞–º–∏–ª–∏—è –ò–º—è (–ö–æ–º–ø–∞–Ω–∏—è)¬ª). [ ]
9) 8020 (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π): —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å lookup –ø—Ä–æ—Ñ–∏–ª—è –≤ ¬´–≥–ª–∞–≤–Ω–æ–π¬ª –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å single‚Äëflight –ø–æ –∫–ª—é—á—É `(enterprise, phone)` –∏ –∫–æ—Ä–æ—Ç–∫–∏–º negative‚ÄëTTL (2‚Äì5 –º–∏–Ω). –î–æ–ª–≥–æ–∂–∏–≤—É—â–µ–≥–æ –∫—ç—à–∞ –Ω–µ –¥–µ—Ä–∂–∞—Ç—å; ¬´–∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã¬ª –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `customers`. [ ]
10) –û–±–æ–≥–∞—â–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (recovery, 8007/download): –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞/–ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤ –∏ –±–∞—Ç—á–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å 8020 (—Å RPS‚Äë–ª–∏–º–∏—Ç–æ–º). –û–±–Ω–æ–≤–ª—è—Ç—å `customers`. –¢–µ–ª–µ–≥—Ä–∞–º –ø—Ä–∏ recovery –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ `customers` –±–µ–∑ –æ–Ω–ª–∞–π–Ω‚Äë–∑–∞–ø—Ä–æ—Å–æ–≤. [ ]
11) –ü–æ–ª–∏—Ç–∏–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è: –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å ¬´–º–∞—Å—Å–∏–≤ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–≤–æ–Ω–∫–æ–≤¬ª. –í—Å–µ —Ñ–∞–∫—Ç—ã –ø–æ –∑–≤–æ–Ω–∫–∞–º —á–∏—Ç–∞–µ–º –∏–∑ –ë–î; –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫—ç—à –ø—Ä–æ—Ñ–∏–ª—è ‚Äî —Ç–æ–ª—å–∫–æ `customers`. –ù–∞ 8000 –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π single‚Äëflight LRU –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ –º–æ–º–µ–Ω—Ç —à–∫–≤–∞–ª–∞. [ ]
12) –ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å/—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –º–µ—Ç—Ä–∏–∫–∏ hit/miss 8020, –ª–∏–º–∏—Ç—ã –Ω–∞ –≤–Ω–µ—à–Ω–µ–µ API, backoff + circuit‚Äëbreaker, –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ –æ–±–æ–≥–∞—â–µ–Ω–∏—è; —Ä–µ—Ç—Ä–∞–∏ —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `customers`. [ ]

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –§–ò–û –∏–∑ RetailCRM
**–°—Ç–∞—Ç—É—Å**: –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û –ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–û

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–≤–æ–Ω–∫–æ–≤:
1) **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è `integration_cache.py`**:
   - ‚úÖ –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–≤–æ–Ω–∫–µ –¥–µ–ª–∞–µ—Ç—Å—è —Å–≤–µ–∂–∏–π –∑–∞–ø—Ä–æ—Å –∫ RetailCRM
   - ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
   - ‚úÖ –ò–∑–≤–ª–µ–∫–∞–µ—Ç –§–ò–û –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ –∏–∑ RetailCRM API
   - ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ –Ω–æ–º–µ—Ä–∞ –∫–æ–º–ø–∞–Ω–∏–∏ —á–µ—Ä–µ–∑ `person_uid`

2) **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è `smart.py`**:
   - ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –∫—ç—à–∞ –¥–ª—è CallerID
   - ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è: –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ ‚Üí –§–ò–û –∫–æ–Ω—Ç–∞–∫—Ç–∞
   - ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∏–º–µ–Ω–∏ –≤ Asterisk –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ

3) **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã RetailCRM**:
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ –ª—é–±–æ–º—É –Ω–æ–º–µ—Ä—É –∫–æ–Ω—Ç–∞–∫—Ç–∞
   - ‚úÖ –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π `person_uid`
   - ‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –§–ò–û –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞
   - ‚úÖ –û–±—â–µ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è –≤—Å–µ—Ö –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

4) **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**:
   - ‚úÖ –ü–æ–∏—Å–∫ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ –Ω–æ–º–µ—Ä—É –ª—é–±–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞
   - ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω–æ–º –∞–ø–ø–∞—Ä–∞—Ç–µ
   - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö –Ω–æ–º–µ—Ä–æ–≤ –∫–æ–º–ø–∞–Ω–∏–∏ –ø—Ä–∏ –∑–≤–æ–Ω–∫–µ
   - ‚úÖ –†–∞–±–æ—Ç–∞ –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è - –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–° –†–ï–ê–õ–ò–ó–ê–¶–ò–ò:
- ‚úÖ **–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã RetailCRM**: –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–æ–∏—Å–∫–∞ –∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è
- ‚úÖ **–ë–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω**: –∫–∞–∂–¥—ã–π –∑–≤–æ–Ω–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ CRM
- ‚úÖ **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –§–ò–û**: –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç–∞–∫—Ç –∏–º–µ–µ—Ç —Å–≤–æ–µ –§–ò–û –∏–∑ CRM
- ‚úÖ **–°–≤—è–∑—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `person_uid`**: –≤—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏ —Å–≤—è–∑–∞–Ω—ã –µ–¥–∏–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏**: –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É `enterprise_name`
- ‚úÖ **–û–±–æ–≥–∞—â–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**: –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–≤–æ–Ω–∫–µ

### üéØ –ü–†–û–ò–ó–í–û–î–°–¢–í–ï–ù–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´:
- **‚úÖ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç "VochiCRM"**: –≤—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã (+375296254070, +375296666666, +375295555555) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–≤—è–∑–∞–Ω—ã
- **‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ**: "VochiCRM | A1 1 | –¢–µ—Å—Ç–æ–≤—ã–π –º–∞–≥–∞–∑–∏–Ω 1"
- **‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –≤—Å–µ –Ω–æ–º–µ—Ä–∞ –∏–º–µ—é—Ç `person_uid: "retailcrm_corporate:123"` –∏ `enterprise_name: "VochiCRM"`
- **‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –§–ò–û**: –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç–∞–∫—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≤–æ–µ –§–ò–û ("–ú–µ–Ω–µ–¥–∂–µ—Ä –ü–µ—Ä–≤—ã–π", "–î–∏—Ä–µ–∫—Ç–æ—Ä –í—Ç–æ—Ä–æ–π" –∏ —Ç.–¥.)

### üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò:
1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ CallerID < 2 —Å–µ–∫—É–Ω–¥
2. **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å**: –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –∏–∑ CRM –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –≤ –∫–æ–º–ø–∞–Ω–∏–∏
4. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: fallback –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ CRM

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –í—Å–µ –¥–∞—Ç—ã/–≤—Ä–µ–º–µ–Ω–∞ ‚Äî UTC.
- –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `customers` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∞—Å—Ç—å—é –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –∑–∞–ø–∏—Å—å—é `calls`/—Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–æ–±—ã—Ç–∏—è `hangup` (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ), –ª–∏–±–æ —Å —Ä–µ—Ç—Ä–∞—è–º–∏ –ø—Ä–∏ —Å–±–æ–µ.
- –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å: —Ç–∞–±–ª–∏—Ü–∞ –∑–∞–º–µ—Ç–æ–∫ –ø–æ –∫–ª–∏–µ–Ω—Ç—É, —Å–≤—è–∑–∏ —Å –≤–Ω–µ—à–Ω–∏–º–∏ CRM, —Å–≤—è–∑–∏ ¬´–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ ‚Üí –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç`.
