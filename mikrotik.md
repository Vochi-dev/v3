# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Mikrotik –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è SIP-—Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**Mikrotik**: `91.149.128.210`  
**–î–∞—Ç–∞ —Ä–∞–±–æ—Ç—ã**: 20 –Ω–æ—è–±—Ä—è 2025  
**–¶–µ–ª—å**: –û–±–µ—Å–ø–µ—á–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö SIP-—Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º Asterisk –≤ —Å–µ—Ç–∏ `10.88.10.x`

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ WireGuard VPN (–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ó–ê–î–ê–ß–ê)

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ—Å—Ç–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å VPN-—Ç—É–Ω–Ω–µ–ª—å

**–ü—Ä–∏—á–∏–Ω–∞**: 
- –ú–∞—Å–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ WireGuard –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Å `/24` –Ω–∞ `/32`
- –®–ª—é–∑ `10.55.10.1` —Å—Ç–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ú–∞—Ä—à—Ä—É—Ç—ã —Å—Ç–∞–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏

**–†–µ—à–µ–Ω–∏–µ**:
```bash
# –ò–∑–º–µ–Ω–∏–ª–∏ –º–∞—Å–∫—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ /24
/interface wireguard set wg-vochi address=10.55.10.20/24

# –î–æ–±–∞–≤–∏–ª–∏ persistent-keepalive
/interface wireguard peers set [find] persistent-keepalive=25s

# –£–¥–∞–ª–∏–ª–∏ —Å—Ç–∞—Ä—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã
/ip route remove [find comment="Static route to 10.88.10.0/24"]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –°–≤—è–∑–Ω–æ—Å—Ç—å —Å —Å–µ—Ç—å—é `10.88.10.0/24` –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞

**–§–∞–π–ª—ã –±—ç–∫–∞–ø–æ–≤**:
- `/root/Downloads/mikrotik_wireguard_restoration_report.md` (–¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç)

---

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ç–æ—Ä–∏—á–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤

**–ó–∞–¥–∞—á–∞**: –ü–æ–¥–∫–ª—é—á–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ "–∑–∞—à–∏—Ç—ã–º–∏" –∞–¥—Ä–µ—Å–∞–º–∏ —Ä–æ—É—Ç–µ—Ä–∞

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–µ—Ç–∏**:
```bash
/ip address add address=192.168.100.1/24 interface=bridge-local
/ip address add address=192.168.0.1/24 interface=bridge-local
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–æ—É—Ç–µ—Ä–æ–≤

---

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–æ–≤ –¥–ª—è SIP (DNAT)

**–ó–∞–¥–∞—á–∞**: –ü—Ä–æ–±—Ä–æ—Å–∏—Ç—å –≤–Ω–µ—à–Ω–∏–µ –ø–æ—Ä—Ç—ã –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä—ã Asterisk

#### –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:

**–•–æ—Å—Ç 1**: `10.88.10.19:50156`
```bash
/ip firewall nat add chain=dstnat action=dst-nat \
  protocol=udp dst-port=50367 \
  to-addresses=10.88.10.19 to-ports=50156 \
  comment="SIP to 10.88.10.19"
```
- –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç: `91.149.128.210:50367`
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π: `10.88.10.19:50156`
- RTP –¥–∏–∞–ø–∞–∑–æ–Ω: `10000-20000`

**–•–æ—Å—Ç 2**: `10.88.10.18:50625`
```bash
/ip firewall nat add chain=dstnat action=dst-nat \
  protocol=udp dst-port=50201 \
  to-addresses=10.88.10.18 to-ports=50625 \
  comment="SIP to 10.88.10.18"
```
- –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç: `91.149.128.210:50201`
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π: `10.88.10.18:50625`
- RTP –¥–∏–∞–ø–∞–∑–æ–Ω: `10000-50000`

#### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

**–û—Ç–∫–ª—é—á—ë–Ω SIP ALG** (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è SIP!):
```bash
/ip firewall service-port set sip disabled=yes
```

**Firewall –ø—Ä–∞–≤–∏–ª–∞**: –ü—Ä–æ–≤–µ—Ä–∏–ª–∏, —á—Ç–æ –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ —Ä–∞–∑—Ä–µ—à—ë–Ω

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ SIP-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–≤–æ–Ω–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è

**–§–∞–π–ª—ã –±—ç–∫–∞–ø–æ–≤**:
- `/root/Downloads/mikrotik_backup_before_sip_portforward.backup`
- `/root/Downloads/mikrotik_backup_after_sip_portforward.backup`

---

## ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∑–≤—É–∫

### –°–∏–º–ø—Ç–æ–º—ã:
- –£–¥–∞–ª—ë–Ω–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω —Å–ª—ã—à–∏—Ç –Ω–∞—Å ‚úÖ
- –ú—ã –ù–ï —Å–ª—ã—à–∏–º —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –∞–±–æ–Ω–µ–Ω—Ç–∞ ‚ùå

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö Asterisk –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `externip` –≤–º–µ—Å—Ç–æ `externaddr`

**–ü—Ä–æ–±–ª–µ–º–∞**:
```ini
# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Ç–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):
externip=46.216.180.89

# Asterisk –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ SDP:
c=IN IP4 46.216.180.89
m=audio 12345 RTP/AVP 0 8

# –£–¥–∞–ª—ë–Ω–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç RTP –Ω–∞:
46.216.180.89:12345  ‚Üê –≠—Ç–æ –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –∞–¥—Ä–µ—Å!
```

**–†–µ—à–µ–Ω–∏–µ**:
```ini
# –ü–†–ê–í–ò–õ–¨–ù–û:
externaddr=91.149.128.210:50201

# Asterisk –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤ SDP:
c=IN IP4 91.149.128.210:50201

# –£–¥–∞–ª—ë–Ω–Ω—ã–π —Ç–µ–ª–µ—Ñ–æ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç RTP –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å ‚úÖ
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:

**–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É externip –∏ externaddr**:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|----------|-------------------|
| `externip` | –ö–æ–≥–¥–∞ –≤–Ω–µ—à–Ω–∏–π –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π **–ø–æ—Ä—Ç—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ** |
| `externaddr` | –ö–æ–≥–¥–∞ –≤–Ω–µ—à–Ω–∏–π –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π **–ø–æ—Ä—Ç—ã –†–ê–ó–ù–´–ï** |

–í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ:
- –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç: `50201` (–Ω–∞ Mikrotik)
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç: `50625` (–Ω–∞ Asterisk)
- **–ü–æ—Ä—Ç—ã –†–ê–ó–ù–´–ï** ‚Üí –Ω—É–∂–µ–Ω `externaddr`!

---

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ó–ê–í–¢–†–ê

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Asterisk

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–¥–∞–ª—ë–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Mikrotik:

#### –•–æ—Å—Ç: 10.88.10.18

**–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** (`/etc/asterisk/sip.conf`):
```ini
bindport=50625
;externip=46.216.180.89
;externaddr=46.216.180.89:50625
localnet=192.168.1.0/24
nat=force_rport,comedia
directmedia=no
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å**:
```ini
bindport=50625
externaddr=91.149.128.210:50201  ‚Üê –î–û–ë–ê–í–ò–¢–¨ (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å)
# externip=46.216.180.89         ‚Üê –£–î–ê–õ–ò–¢–¨ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å)
localnet=192.168.1.0/24
nat=force_rport,comedia
directmedia=no
rtpstart=10000
rtpend=50000
```

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π**:
```bash
ssh root@10.88.10.18 -p 5059
asterisk -rx "sip reload"
```

#### –•–æ—Å—Ç: 10.88.10.19

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å**:
```ini
bindport=50156
externaddr=91.149.128.210:50367  ‚Üê –î–û–ë–ê–í–ò–¢–¨
# externip=...                   ‚Üê –£–î–ê–õ–ò–¢–¨ —Å—Ç–∞—Ä—É—é —Å—Ç—Ä–æ–∫—É
localnet=10.88.10.0/24
nat=force_rport,comedia
directmedia=no
rtpstart=10000
rtpend=20000
```

---

### 2. –ü—Ä–æ–±—Ä–æ—Å RTP-–ø–æ—Ä—Ç–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω)

**–í–ê–ñ–ù–û**: –°–Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º –±–µ–∑ –ø—Ä–æ–±—Ä–æ—Å–∞ RTP!

Asterisk —Å `nat=force_rport,comedia` **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç** –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à—ë–ª RTP –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—É–¥–∞ –∂–µ –æ—Ç–≤–µ—Ç.

**–ï—Å–ª–∏ –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∑–≤—É–∫ –ù–ï –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç** –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è `externaddr`, —Ç–æ–≥–¥–∞ –Ω–∞—Å—Ç—Ä–æ–∏–º –ø—Ä–æ–±—Ä–æ—Å RTP:

```bash
# –î–ª—è 10.88.10.18 (RTP 10000-50000):
/ip firewall nat add chain=dstnat action=dst-nat \
  protocol=udp dst-port=10000-50000 \
  to-addresses=10.88.10.18 to-ports=10000-50000 \
  comment="RTP to 10.88.10.18"

# –î–ª—è 10.88.10.19 (RTP 10000-20000):
/ip firewall nat add chain=dstnat action=dst-nat \
  protocol=udp dst-port=10000-20000 \
  to-addresses=10.88.10.19 to-ports=10000-20000 \
  comment="RTP to 10.88.10.19"
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –®–∏—Ä–æ–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω –ø–æ—Ä—Ç–æ–≤ –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å—É–∑–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω—ã.

---

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ß–µ–∫-–ª–∏—Å—Ç –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**:

#### –õ–æ–∫–∞–ª—å–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ (–≤ –æ—Ñ–∏—Å–µ –∫–ª–∏–µ–Ω—Ç–∞):
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π ‚Üí –õ–æ–∫–∞–ª—å–Ω—ã–π (–æ–±–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Å–µ—Ç–∏ `192.168.1.x`)
- [ ] –õ–æ–∫–∞–ª—å–Ω—ã–π ‚Üí –í–Ω–µ—à–Ω–∏–π (—Ç–µ–ª–µ—Ñ–æ–Ω –≤ –æ—Ñ–∏—Å–µ –∑–≤–æ–Ω–∏—Ç –Ω–∞—Ä—É–∂—É)
- [ ] –í–Ω–µ—à–Ω–∏–π ‚Üí –õ–æ–∫–∞–ª—å–Ω—ã–π (–≤—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –≤ –æ—Ñ–∏—Å–µ)

#### –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ (—á–µ—Ä–µ–∑ Mikrotik):
- [ ] SIP-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç?
- [ ] –ò—Å—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è?
- [ ] **–î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –≥–æ–ª–æ—Å**:
  - [ ] –ú—ã —Å–ª—ã—à–∏–º —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –∞–±–æ–Ω–µ–Ω—Ç–∞
  - [ ] –£–¥–∞–ª—ë–Ω–Ω—ã–π –∞–±–æ–Ω–µ–Ω—Ç —Å–ª—ã—à–∏—Ç –Ω–∞—Å

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

**–ù–∞ Asterisk**:
```bash
asterisk -rx "sip show peers"      # –°—Ç–∞—Ç—É—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
asterisk -rx "sip show peer 200"   # –î–µ—Ç–∞–ª–∏ peer (–∑–∞–º–µ–Ω–∏—Ç–µ 200)
asterisk -rx "core show channels"  # –ê–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
```

**–õ–æ–≥–∏ –∑–≤–æ–Ω–∫–∞**:
```bash
tail -f /var/log/asterisk/full | grep "SIP/200"
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ SDP**:
```bash
tcpdump -i any -nn port 50201 -A | grep -E "(c=IN|m=audio)"
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —Ö–æ—Å—Ç—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ù–æ–≤—ã–π —Ö–æ—Å—Ç** (—Ç–æ—Ç, —á—Ç–æ —Å `externaddr=46.216.180.89:50625` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω):
- IP –≤ —Å–µ—Ç–∏: `10.88.10.???` (–Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å)
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç: `50625`
- –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç: `50202` (—Å–≤–æ–±–æ–¥–µ–Ω)
- RTP –¥–∏–∞–ø–∞–∑–æ–Ω: `10000-50000`

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è Mikrotik**:
```bash
/ip firewall nat add chain=dstnat action=dst-nat \
  protocol=udp dst-port=50202 \
  to-addresses=10.88.10.??? to-ports=50625 \
  comment="SIP to 10.88.10.???"
```

---

## üìö –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ—Ä—Ç—ã:

| –í–Ω–µ—à–Ω–∏–π –ø–æ—Ä—Ç | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Ö–æ—Å—Ç | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ—Ä—Ç | RTP –¥–∏–∞–ø–∞–∑–æ–Ω | –°—Ç–∞—Ç—É—Å |
|--------------|----------------|-----------------|--------------|--------|
| 50367 | 10.88.10.19 | 50156 | 10000-20000 | ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω |
| 50201 | 10.88.10.18 | 50625 | 10000-50000 | ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω |
| 50202 | 10.88.10.??? | 50625 | 10000-50000 | ‚è≥ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |

### –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ Asterisk:

```
/etc/asterisk/sip.conf          - –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è SIP
/etc/asterisk/rtp.conf          - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ RTP (–¥–∏–∞–ø–∞–∑–æ–Ω –ø–æ—Ä—Ç–æ–≤)
/var/log/asterisk/full          - –ü–æ–ª–Ω—ã–π –ª–æ–≥ Asterisk
/var/log/asterisk/messages      - –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫:

**–ù–∞ Asterisk**:
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
asterisk -rx "sip show settings" | grep -E "(externaddr|externip|localnet)"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å RTP –¥–∏–∞–ø–∞–∑–æ–Ω:
asterisk -rx "rtp show settings"
```

**–ù–∞ Mikrotik**:
```bash
# –ü–æ–∫–∞–∑–∞—Ç—å NAT –ø—Ä–∞–≤–∏–ª–∞:
/ip firewall nat print where chain=dstnat

# –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
/ip firewall connection print where protocol=udp

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å WireGuard:
/interface wireguard peers print stats
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –û –ª–æ–∫–∞–ª—å–Ω—ã—Ö –∑–≤–æ–Ω–∫–∞—Ö:

**–ù–ï –ë–ï–°–ü–û–ö–û–ò–¢–¨–°–Ø** - –ª–æ–∫–∞–ª—å–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ (–≤–Ω—É—Ç—Ä–∏ –æ—Ñ–∏—Å–∞ –∫–ª–∏–µ–Ω—Ç–∞) **–ù–ï –ü–û–°–¢–†–ê–î–ê–Æ–¢**!

**–ü–æ—á–µ–º—É**:
```ini
localnet=192.168.1.0/24  ‚Üê Asterisk –∑–Ω–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω–∞—è —Å–µ—Ç—å
```

**–õ–æ–≥–∏–∫–∞ Asterisk**:
- –ï—Å–ª–∏ IP –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤—Ö–æ–¥–∏—Ç –≤ `localnet` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–ª–æ–∫–∞–ª—å–Ω—ã–π IP**
- –ï—Å–ª–∏ IP –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ù–ï –≤—Ö–æ–¥–∏—Ç –≤ `localnet` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **externaddr**

### –û –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö:

**–ù–ï –ú–ï–ù–Ø–¢–¨** –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Ä–æ—É—Ç–µ—Ä–∞—Ö!

–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤ –Ω–∞ —Å–≤–æ—ë–º —Ä–æ—É—Ç–µ—Ä–µ –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ - **–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å**.

–ù–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ Mikrotik - —ç—Ç–æ **–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç** –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è —É–¥–∞–ª—ë–Ω–Ω–æ **–ë–ï–ó** –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≤–æ–µ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞.

### –û SIP ALG:

**–í–°–ï–ì–î–ê –û–¢–ö–õ–Æ–ß–ê–¢–¨** SIP ALG –Ω–∞ –ª—é–±–æ–º —Ä–æ—É—Ç–µ—Ä–µ!

SIP ALG –ø—ã—Ç–∞–µ—Ç—Å—è "–ø–æ–º–æ—á—å" SIP-—Ç—Ä–∞—Ñ–∏–∫—É, –Ω–æ –æ–±—ã—á–Ω–æ —Ç–æ–ª—å–∫–æ –ª–æ–º–∞–µ—Ç –µ–≥–æ:
- –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç SIP-–∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –ü–æ—Ä—Ç–∏—Ç SDP
- –°–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å NAT

---

## üîê –î–æ—Å—Ç—É–ø—ã

**Mikrotik**: `91.149.128.210`
- –õ–æ–≥–∏–Ω: `Vochi`
- –ü–∞—Ä–æ–ª—å: `***–°–ö–†–´–¢–û***`

**Asterisk —Å–µ—Ä–≤–µ—Ä—ã**: `10.88.10.x`
- –ü–æ—Ä—Ç SSH: `5059`
- –õ–æ–≥–∏–Ω: `root`
- –ü–∞—Ä–æ–ª—å: `5atx9Ate@pbx`

---

## üìÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞ | –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ | –§–∞–π–ª –±—ç–∫–∞–ø–∞ |
|------|-------------|-------------|
| 20.11.2025 | –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω WireGuard | `mikrotik_wireguard_restoration_report.md` |
| 20.11.2025 | –î–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ç–æ—Ä–∏—á–Ω—ã–µ IP | - |
| 20.11.2025 | –ù–∞—Å—Ç—Ä–æ–µ–Ω DNAT –¥–ª—è SIP (50367, 50201) | `mikrotik_backup_after_sip_portforward.backup` |
| 20.11.2025 | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å externip/externaddr | - |

---

## ‚úÖ TODO –Ω–∞ –∑–∞–≤—Ç—Ä–∞

1. [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `sip.conf` –Ω–∞ —Ö–æ—Å—Ç–µ `10.88.10.18` (externaddr)
2. [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `sip.conf` –Ω–∞ —Ö–æ—Å—Ç–µ `10.88.10.19` (externaddr)
3. [ ] –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å SIP –Ω–∞ –æ–±–æ–∏—Ö —Ö–æ—Å—Ç–∞—Ö (`sip reload`)
4. [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∑–≤—É–∫
5. [ ] –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–±—Ä–æ—Å RTP
6. [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–æ–≤—ã–π —Ö–æ—Å—Ç (—É—Ç–æ—á–Ω–∏—Ç—å IP)
7. [ ] –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞** üéØ




